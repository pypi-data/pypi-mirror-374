# https://scikit-build-core.readthedocs.io/en/latest/
# https://github.com/pybind/scikit_build_example/blob/master/pyproject.toml
#
# Build python package locally with (potentially export CXX=/usr/bin/...):
# python -m pipx run build
#
# (or for source distribution only: python -m pipx run build --sdist)
#
# Either install locally with
# python -m pip install ./dist/pbf-[...].whl
#
# ... or upload to TestPyPi (use __token__ as name and then paste the generated token as password)
# python -m twine upload --repository testpypi ./dist/pbf-[...].[VERSION]*
#
# (install with:)
# (python -m pip install --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple pbf)
#
# ... or upload to PyPi 
# python -m twine upload ./dist/pbf-[...].[VERSION]*

[build-system]
requires = ["scikit-build-core"]#, "pybind11"]
build-backend = "scikit_build_core.build"

[project]
name = "pbf"
version = "0.2.0"
authors = [
  { name="Philipp Kopp" }, #, email="name@example.com"
  { name="Massimo Carraturo" },
]
description = "A work-in-progress powder bed fusion simulation library."
#readme = "README.md"
#requires-python = ">=3.7"
classifiers = [
    "License :: OSI Approved :: MIT License",
#    "Programming Language :: Python :: 3",
#    "Operating System :: OS Independent",
]

#[project.urls]
#Homepage = "https://gitlab.com/phmkopp/mlhp"
#Issues = "https://github.com/phmkopp/mlhp/issues"

#[tool.scikit-build]
#wheel.py-api = "py3"
#cmake.targets = ["pymlhpcore"]

# https://cibuildwheel.pypa.io/en/stable/options/#build-skip
[tool.cibuildwheel]
skip = "cp36-* cp37-* pp* *-win32 *-manylinux_i686"

[tool.scikit-build.cmake.define]
BUILD_SHARED_LIBS="OFF"
MLHP_TEST_CPP="OFF"
MLHP_TEST_PYTHON="OFF"
MLHP_DEBUG_CHECKS="OFF"
MLHP_INDEX_SIZE_CELLS="32"
MLHP_INDEX_SIZE_DOFS="64"
MLHP_PYTHON="ON"
PBF_TESTS="OFF"

# # ====== Windows + Visual Studio ========
# [tool.scikit-build.cmake.define]
# BUILD_SHARED_LIBS="OFF"
# PBF_ENABLE_TESTS="OFF"
# PBF_ENABLE_PYTHONBINDINGS="ON"

# # ====== Windows + MinGW + g++ ========
# [tool.scikit-build]
# cmake.args = ["-G=MinGW Makefiles"]
# 
# [tool.scikit-build.cmake.define]
# BUILD_SHARED_LIBS="OFF"
# PBF_ENABLE_TESTS="OFF"
# PBF_ENABLE_PYTHONBINDINGS="ON"
# MLHP_ALL_OPTIMIZATIONS="OFF"
# CMAKE_CXX_FLAGS="-Ofast -mavx2"
