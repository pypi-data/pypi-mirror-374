commit fe9d0061c413f8fb8c529b18b592b04170850ded
Author: Philip Yang <Philip.Yang@amd.com>
Date:   Mon Feb 10 09:42:31 2025 -0500

    drm/amdkfd: debugfs hang_hws skip GPU with MES
    
    debugfs hang_hws is used by GPU reset test with HWS, for MES this crash
    the kernel with NULL pointer access because dqm->packet_mgr is not setup
    for MES path.
    
    Skip GPU with MES for now, MES hang_hws debugfs interface will be
    supported later.
    
    Signed-off-by: Philip Yang <Philip.Yang@amd.com>
    Reviewed-by: Kent Russell <kent.russell@amd.com>
    Reviewed-by: Felix Kuehling <felix.kuehling@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>

diff --git a/drivers/gpu/drm/amd/amdkfd/kfd_device.c b/drivers/gpu/drm/amd/amdkfd/kfd_device.c
index 095e73790dc4..b9c82be6ce13 100644
--- a/drivers/gpu/drm/amd/amdkfd/kfd_device.c
+++ b/drivers/gpu/drm/amd/amdkfd/kfd_device.c
@@ -1604,6 +1604,11 @@ int kfd_debugfs_hang_hws(struct kfd_node *dev)
 		return -EINVAL;
 	}
 
+	if (dev->kfd->shared_resources.enable_mes) {
+		dev_err(dev->adev->dev, "Inducing MES hang is not supported\n");
+		return -EINVAL;
+	}
+
 	return dqm_debugfs_hang_hws(dev->dqm);
 }
 
