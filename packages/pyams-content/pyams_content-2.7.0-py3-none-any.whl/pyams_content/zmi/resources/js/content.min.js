"use strict";window.$===void 0&&(window.$=MyAMS.$);const content={TinyMCE:{initEditor:(e,t)=>{const n=window.tinyMCE;n!==void 0&&(t.external_plugins=$.extend({},t.external_plugins,{pyams_link:"/--static--/pyams_content/js/tinymce/internal-link/plugin.js",pyams_headers:"/--static--/pyams_content/js/tinymce/headers/plugin.js"}),t.style_formats=[{title:"Headers",items:[{title:"H3 header",format:"h3"},{title:"H4 header",format:"h4"}]},{title:"Blocs",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strike-through",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"sourcecode",format:"code"}]},{title:"Align",items:[{title:"Left",icon:"align-left",format:"alignleft"},{title:"Center",icon:"align-center",format:"aligncenter"},{title:"Right",icon:"align-right",format:"alignright"}]}],t.menubar&&(t.menu=$.extend({},t.menu,{insert:{title:"Insert",items:"link pyams_link inserttable | charmap emoticons hr | pagebreak nonbreaking anchor | insertdatetime"}})),t.toolbar1&&(t.toolbar1="undo redo | pastetext | header-h3 header-h4 styleselect | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent"),t.toolbar2&&(t.toolbar2="forecolor backcolor | charmap pyams_link link | fullscreen preview print | code"))}},tree:{switchVisibleElement:(e,t)=>{const l=t.node_id,s=$(`tr[data-ams-tree-node-id="${l}"]`),i=$(s.parents("table")),d=$("thead",i),o=$(`th[data-ams-column-name="visible"]`,d),a=o.index(),r=$("i",$(`td:nth-child(${a+1})`,s)),c=$(`[data-ams-tree-node-id="${s.data("ams-tree-node-parent-id")}"]`);let n;if(c.get(0).tagName==="TR"){const e=$("i",$(`td:nth-child(${a+1})`,c));n=e.attr("class")}else n=i.data("ams-visible")?"":"text-danger";t.state===!0?r.replaceWith(`<i class="${o.data("ams-icon-on")} ${n}"></i>`):r.replaceWith(`<i class="${o.data("ams-icon-off")} ${n}"></i>`)}},widget:{treeview:{selectFolder:(e,t)=>{const n=$(e.target);n.siblings('input[type="hidden"]').val(t.id)},unselectFolder:(e)=>{const n=$(e.target);n.siblings('input[type="hidden"]').val(null)}}},pictograms:{initManagerSelection:function(){const e=$(this),t=$('input[type="hidden"]',$(".selected-pictograms",e)).listattr("value");return{selected:JSON.stringify(t)}},switchPictogram:e=>{$("i",e.currentTarget).tooltip("hide");let t=$(e.currentTarget);t.hasClass("pictogram")||(t=t.parents(".pictogram"));const n=$("input",t),s=t.parents(".pictograms"),o=s.parents(".pictograms-manager");if(s.hasClass("available-pictograms")){const e=n.attr("data-ams-pictogram-name");n.removeAttr("data-ams-pictogram-name").attr("name",e),$("a.action i",t).replaceWith($("<i></i>").addClass("fa fa-fw fa-arrow-left hint opaque baseline").attr("data-ams-hint-gravity","se").attr("data-ams-hint-offset","3")),$(".selected-pictograms",o).append(t)}else{const e=n.attr("name");n.removeAttr("name").attr("data-ams-pictogram-name",e),$("a.action i",t).replaceWith($("<i></i>").addClass("fa fa-fw fa-arrow-right hint opaque baseline").attr("data-ams-hint-gravity","se").attr("data-ams-hint-offset","3")),$(".available-pictograms",o).append(t)}},endDrag:(e,t)=>{$(t.source).remove()}},paragraphs:{switchEditor:(e,t)=>{const i=t&&t.object_id?t.object_id:null,o=i?$(".switcher-parent",$(`tr[id="${i}"]`)):$(e.currentTarget),s=$(".switcher",o),n=o.siblings(".editor");s.hasClass("expanded")?MyAMS.core.clearContent(n).then(()=>{n.empty(),s.html('<i class="far fa-plus-square"></i>').removeClass("expanded")}):(s.html('<i class="fas fa-spinner fa-spin"></i>'),MyAMS.require("ajax","helpers").then(()=>{const e=o.parents("tr"),t=e.data("ams-element-name"),i=e.parents("table"),a=i.data("ams-location");MyAMS.ajax.post(`${a}/get-paragraph-editor.json`,{object_name:t}).then(e=>{const s=e[t];s&&(n.html(s),MyAMS.core.initContent(n).then(()=>{MyAMS.helpers.scrollTo("#content",n,{offset:-15})}))}).finally(()=>{s.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}))},switchAllEditors:e=>{const n=$(e.currentTarget),t=$(".switcher",n),s=n.parents("table"),o=$("tbody",s);t.hasClass("expanded")?($("tr",o).each((e,t)=>{const n=$(".editor",t);MyAMS.core.clearContent(n).then(()=>{n.empty(),$(".switcher",t).html('<i class="far fa-plus-square"></i>').removeClass("expanded")})}),t.html('<i class="far fa-plus-square"></i>').removeClass("expanded")):(t.html('<i class="fas fa-spinner fa-spin"></i>'),MyAMS.require("ajax","helpers").then(()=>{const e=s.data("ams-location");MyAMS.ajax.post(`${e}/get-paragraphs-editors.json`).then(e=>{for(const[s,i]of Object.entries(e)){const t=$(`tr[data-ams-element-name="${s}"]`,o),n=$(".switcher",t);if(!n.hasClass("expanded")){const e=$(".editor",t);e.html(i),MyAMS.core.initContent(e).then(()=>{n.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}}}).finally(()=>{t.html('<i class="far fa-minus-square"></i>').addClass("expanded")})}))},refreshTitle:(e,t)=>{const n=$(`tr[data-ams-element-name="${t.element_name}"]`);n.attr("data-ams-url")?$("td.title",n).text(t.title):$("span.title",n).text(t.title)}},galleries:{sortMedias:(e)=>{const n=$(e.target),s=n.data("ams-location"),o=$(".media-thumbnail",n).listattr("data-ams-element-name");MyAMS.require("ajax","alert","i18n").then(()=>{MyAMS.ajax.post(`${s}/set-medias-order.json`,{order:o.join(";")}).then(e=>{MyAMS.alert.smallBox({status:"success",message:MyAMS.i18n.DATA_UPDATED,icon:"fa-info-circle"})})})},switchVisibleMedia:(e)=>{const n=$(e.currentTarget),s=n.html(),o=n.parents(".media-thumbnail"),i=n.parents(".gallery"),a=i.data("ams-location");n.html('<i class="fas fa-fw fa-spinner fa-spin"></i>'),MyAMS.require("ajax").then(()=>{MyAMS.ajax.post(`${a}/switch-media-visibility.json`,{object_name:o.data("ams-element-name"),attribute_name:"visible"}).then(e=>{e.status==="success"&&(e.state?n.html('<i class="far fa-fw fa-eye"></i>'):n.html('<i class="far fa-fw fa-eye-slash text-danger"></i>'))}).catch(()=>{n.html(s)})})},removeMedia:(e)=>{const n=$(e.currentTarget).parents(".media-thumbnail"),s=n.parents(".gallery"),o=s.data("ams-location");MyAMS.require("ajax","alert","i18n","helpers").then(()=>{MyAMS.alert.bigBox({status:"danger",icon:"fas fa-bell",title:MyAMS.i18n.WARNING,message:MyAMS.i18n.CONFIRM_REMOVE,successLabel:MyAMS.i18n.CONFIRM,cancelLabel:MyAMS.i18n.BTN_CANCEL}).then(e=>{if(e!=="success")return;MyAMS.ajax.post(`${o}/remove-media.json`,{object_name:n.data("ams-element-name")}).then(e=>{e.status==="success"?(n.remove(),e.handle_json&&MyAMS.ajax.handleJSON(e)):MyAMS.ajax.handleJSON(e)})})})}},review:{timer:null,interval:3e4,init:()=>{$(document).off("update-comments.ams.content").on("update-comments.ams.content",(e,{count:t})=>{const n=$('a[href="#review-comments.html"]',$("nav"));n.exists()&&$(".badge",n).text(t)});const e=MyAMS.content.review;e.timer=setTimeout(e.getComments,e.interval)},initPage:()=>{MyAMS.require("helpers").then(()=>{const e=$("#review-messages-view"),t=$("li",e).last();e.exists()&&MyAMS.helpers.scrollTo(e,t)})},getComments:()=>{MyAMS.require("ajax","helpers").then(()=>{const t=MyAMS.content.review,n=$('a[href="#review-comments.html"]',$("nav")),e=$(".badge",n);MyAMS.ajax.get("get-comments.json",{count:e.text()||"0"}).then(({status:n,comments:s,count:o})=>{if(o!==parseInt(e.text())&&(e.removeClass("bg-info").addClass("bg-danger scaled"),e.text(o),setTimeout(()=>{e.removeClass("bg-danger scaled").addClass("bg-info")},1e4)),s){const t=$("#review-messages-view"),e=$("#review-messages");for(const t of s)e.append($(t));MyAMS.helpers.scrollTo(t,$("li",e).last())}t.timer=setTimeout(t.getComments,t.interval)})})}},thesaurus:{changeThesaurus:e=>{const n=$(e.currentTarget).parents("form"),o=$('select[name$=".widgets.thesaurus_name"]',n),s=o.val(),t=$('select[name$=".widgets.extract_name"]',n),i=t.data("select2");t.empty(),t.select2("data",null),i.results.clear(),s&&MyAMS.require("ajax").then(()=>{MyAMS.ajax.get(`${window.location.origin}/api/thesaurus/extracts`,{thesaurus_name:s}).then(e=>{$("<option />").attr("id","form-widgets-extract_name-novalue").attr("value","--NOVALUE--").text(MyAMS.i18n.NO_SELECTED_VALUE).appendTo(t),$(e.results).each((e,n)=>{$("<option />").attr("id",`form-widgets-extract_name-${e}`).attr("value",n.id).text(n.text).appendTo(t)}),t.val("--NOVALUE--").trigger("change")})})}}};window.MyAMS&&(MyAMS.config.modules.push("content"),MyAMS.content=content,console.debug("MyAMS: content module loaded..."))