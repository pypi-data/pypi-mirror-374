import json
import subprocess


SCENARIOS = {
    "wrong_choice_blank": ["", "4"],
    "wrong_choice_0": ["0", "4"],
    "wrong_choice": ["5", "4"],
    "wrong_choice_negative": ["-5", "4"],
    "wrong_choice_character": ["abc", "4"],
    "wrong_choice_character_negative": ["abc-5", "4"],
    "wrong_choice_character_too_much": ["abc2000", "4"],
    "wrong_choice_float": ["100.50", "4"],
    "wrong_choice_float_negative": ["-100.50", "4"],
    "good_choice_float_too_much": ["2000.50", "20", "4"],
    "wrong_choice_float_char": ["abc.50", "4"],
    "wrong_choice_float_char_negative": ["abc.-100", "4"],
    "wrong_choice_float_char_too_much": ["abc.2000", "4"],
    "good_choice_float_overflow": ["10000000000000000000", "4"],
    "wrong_choice_float_overflow_negative": ["-10000000000000000000", "4"],
    "wrong_choice_float_overflow_character": ["abc10000000000000000000", "4"],
    "wrong_choice_float_overflow_character_negative": ["abc-10000000000000000000", "4"],
    "wrong_choice_float_overflow_character_too_much": ["abc20000000000000000000", "4"],
    "wrong_choice_float_overflow_character_too_much_negative": [
        "abc-20000000000000000000",
        "4",
    ],
    "view_balance": ["1", "4"],
    "credit_100": ["2", "100", "1", "4"],
    "debit_50": ["3", "50", "1", "4"],
    "debit_too_much": ["3", "2000", "1", "4"],
    "debit_0": ["3", "0", "1", "4"],
    "debit_negative": ["3", "-100", "1", "4"],
    "debit_character": ["3", "abc", "1", "4"],
    "debit_character_negative": ["3", "abc-100", "1", "4"],
    "debit_character_too_much": ["3", "abc2000", "1", "4"],
    "debit_float": ["3", "100.50", "1", "4"],
    "debit_float_negative": ["3", "-100.50", "1", "4"],
    "debit_float_too_much": ["3", "2000.50", "1", "4"],
    "debit_float_char": ["3", "abc.50", "1", "4"],
    "debit_float_char_negative": ["3", "abc.-100", "1", "4"],
    "debit_float_char_too_much": ["3", "abc.2000", "1", "4"],
    "debit_float_overflow": ["3", "10000000000000000000", "1", "4"],
    "credit_0": ["2", "0", "1", "4"],
    "credit_negative": ["2", "-100", "1", "4"],
    "credit_too_much": ["2", "2000", "1", "4"],
    "credit_character": ["2", "abc", "1", "4"],
    "credit_character_negative": ["2", "abc-100", "1", "4"],
    "credit_character_too_much": ["2", "abc2000", "1", "4"],
    "credit_float": ["2", "100.50", "1", "4"],
    "credit_float_negative": ["2", "-100.50", "1", "4"],
    "credit_float_too_much": ["2", "2000.50", "1", "4"],
    "credit_float_char": ["2", "abc.50", "1", "4"],
    "credit_float_char_negative": ["2", "abc.-100", "1", "4"],
    "credit_float_char_too_much": ["2", "abc.2000", "1", "4"],
    "credit_overflow": [
        "2",
        "100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        "1",
        "4",
    ],
    "credit_float_overflow": ["2", "10000000000000000000", "1", "4"],
    # "credit_display_bug": ["2", "999999", "1", "4"],
    # "debit_display_bug": ["3", "999999", "1", "4"],
    "exit": ["4"],
}


def run_cobol(inputs):
    process = subprocess.Popen(
        ["./accountsystem"],
        stdin=subprocess.PIPE,
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
        text=True,
    )
    stdout, _ = process.communicate("\n".join(inputs))
    return stdout


def main():
    golden_master = {}
    i = 1
    for name, inputs in SCENARIOS.items():
        print(f"{i} - Running test: {name}")
        output = run_cobol(inputs)
        golden_master[name] = {"inputs": inputs, "output": output}
        i += 1
        print(f"Test {i} done")
    with open("golden_master.json", "w") as f:
        json.dump(golden_master, f, indent=2)


if __name__ == "__main__":
    main()
