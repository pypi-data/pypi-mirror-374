<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>causara</title>
    <link href="https://fonts.googleapis.com/css2?family=Wix+Madefor+Display:wght@400;500;700&display=swap" rel="stylesheet">

    <style>

        *:focus {
            outline: none;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 94vh;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            font-size: 0.95vw;
        }

        .container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .item {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        textarea:focus {
          outline: none;
        }

        .file-loader {
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.2);
            left: 2%;
            top: 2%;
            width: 65%;
            height: 5%;
        }
        .file-loader button {
            position: absolute;
            left: 0px;
            font-size: 0.95vw;
            background: #DF6F65;
            color: #fff;
            border-radius: 4px;
            padding: 12px 40px;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
        }
        .file-loader button:hover {
            background-color: #db564b;
        }

        .status-log {
            background-color: white;
            left: 2%;
            top: 11%;
            width: 28%;
            height: 40%;
            overflow-y: auto;
            padding: 10px;
        }
        .status-log textarea {
            left: 5%;
            top: 5%;
            width: 90%;
            height: 90%;
            resize: none;
            border: none;
            background-color: white;
            font-family: 'Wix Madefor Display', sans-serif;
            font-size: 0.95vw;
            text-align: left;
        }

        .model-description {
            background-color: white;
            left: 32%;
            top: 35%;
            width: 33%;
            height: 34%;
            overflow-y: auto;
            font-size: 0.95vw;
            color: #444;
        }
        .model-description textarea {
            left: 5%;
            top: 5%;
            width: 90%;
            height: 90%;
            resize: none;
            border: none;
            background-color: white;
            font-family: 'Wix Madefor Display', sans-serif;
            font-size: 0.95vw;
            color: black;
            text-align: left;
            padding-right: 10px;
        }

        .solution-list {
            background-color: white;
            left: 2%;
            top: 54%;
            width: 28%;
            height: 45%;
            overflow-y: auto;
        }
        .solution-list ul {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            list-style: none;
            padding: 0;
            margin: 0;
            width: 90%;
            padding-right: 20px;
            padding-left: 10px;
            padding-bottom: 10px;
            padding-top: 10px;
        }
        .solution-list ul li {
            word-wrap: break-word;
            white-space: normal;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            font-size: 0.95vw;
            color: #444;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .solution-list ul li:hover {
            background-color: #f5e4e1;
        }

        .drag-drop {
            background-color: #f7f8fa;
            left: 32%;
            top: 11%;
            width: 33%;
            height: 21%;
            border: 2px dashed #ccc;
            color: #666;
        }

        .parameter-settings {
            background-color: white;
            left: 32%;
            top: 72%;
            width: 33%;
            height: 27%;
            color: #444;
            overflow-y: auto;
            float: top;
        }
        .parameter-settings ul {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
        }
        .parameter-settings .row {
            display: flex;
            align-items: center;
            margin-top: 1%;
        }
        .parameter-settings label {
            width: 250px; /* Fixed width for all labels */
            text-align: right;
            margin-right: 30px;
            font-size: 0.95vw;
            color: #444;
        }
        .parameter-settings input {
            flex-grow: 1; /* Ensures inputs take up all remaining space */
            padding: 6px;
            font-size: 0.95vw;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 75px;
            margin-top: 3px;
            width: 95px;
        }

        .action-buttons {
            position: absolute;
            right: 0;
            text-align: right;
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.2);
            left: 70%;
            top: 2%;
            width: 28%;
            height: 5%;
            display: flex;
            align-items: center;
            position: relative;
        }
        .action-buttons button {
            position: absolute;
            right: 60px;
            text-align: right;
            font-size: 0.95vw;
            background: #DF6F65;
            color: #fff;
            border-radius: 4px;
            padding: 12px 40px;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
            margin-left: 5px;
        }
        .action-buttons button:hover {
            background-color: #db564b;
        }
        .action-buttons .back-button {
            position: absolute;
            border-radius: 999px;
            right: 0;
            background-color: #f0f2f5;
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: right;
            padding: 2px;
            margin-left: 15px;
        }
        .action-buttons .back-button:hover {
            background-color: lightgray;
        }
        .action-buttons .back-button img {
            width: 37px;
            height: 37px;
        }
        .action-buttons .solve-button {
            margin-right: 10px;
        }

        .adjust-model {
            background-color: white;
            left: 67%;
            top: 11%;
            width: 31%;
            height: 49%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .adjust-model textarea {
            width: 90%;
            height: 75%;
            margin-bottom: 20px;
            font-size: 0.95vw;
            font-family: 'Wix Madefor Display', sans-serif;
            border-radius: 8px;
            padding: 15px;
        }
        .adjust-model button {
            font-size: 0.95vw;
            background: #DF6F65;
            color: #fff;
            border-radius: 4px;
            padding: 12px 40px;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
        }
        .adjust-model button:hover {
            background: #db564b;
        }

        .solution-list h2,
        .adjust-history h2,
        .model-description h2,
        .parameter-settings h2 {
            z-index: 1;
            flex-shrink: 0; /* Prevent the header from shrinking */
        }

        .adjust-history {
            background-color: white;
            left: 67%;
            top: 63%;
            width: 31%;
            height: 36%;
            overflow-y: auto;
        }
        .adjust-history ul {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            list-style: none;
            padding: 0;
            margin: 0;
            padding: 10px;
            padding-left: 0;
            width: 100%;
        }
        .adjust-history ul li {
            word-wrap: break-word;
            white-space: normal;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            margin-bottom: -35px;
            margin-right: 15px;
            margin-left: 15px;
        }
        .adjust-history ul li p {
            display: flex;
            align-items: center;
            width: 84%;
            height: 4.6vh;
            padding: 8px;
            padding-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            font-size: 0.95vw;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #444;
        }
        .adjust-history ul li p:hover {
            background-color: #f5e4e1;
            cursor: pointer;
        }
        .adjust-history ul li img {
            width: 4.6vh;
            height: 4.6vh;
            float: right;
            padding: 11px;
            cursor: pointer;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .adjust-history ul li img:hover {
            background-color: lightgray;
        }

        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 75px;
            height: 75px;
            animation: spin 2s linear infinite;
        }
        #spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9998;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

    </style>

    <script>

        function callStartLoadModelForm() {
            window.pywebview.api.start_load_model_form();
        }

        function open_prev_solution(i) {
            window.pywebview.api.open_prev_solution(i);
        }

        function run_read_script(i) {
            window.pywebview.api.run_read_script();
        }

        function callStartSolveModelForm() {
            window.pywebview.api.start_solve_model_form();
        }

        function delete_adjustment(hashed_name_to_delete) {
            window.pywebview.api.delete_adjustment(hashed_name_to_delete);
        }

        function select_adjustment(hashed_name_to_select) {
            window.pywebview.api.select_adjustment(hashed_name_to_select);
        }

        function callAdjustModel() {
            const adjustmentPrompt = document.getElementById('adjustment_prompt_textfield').value;
            window.pywebview.api.adjust_model(adjustmentPrompt);
        }

        function openProblemFile() {
            pywebview.api.load_p_with_file_dialog().then(response => {
                    if (response) {
                        alert(response);
                    }});
        }

        function handleDragOver(event) {
            event.preventDefault();
        }

        function handleFileDrop(event) {
            event.preventDefault();
            const file = event.dataTransfer.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64DataUrl = e.target.result;
                pywebview.api.load_p(file.name, base64DataUrl)
                .then(response => {
                    if (response) {
                        alert(response);
                    }});
            };
            reader.readAsDataURL(file);
        }

        function showSpinner() {
            document.getElementById('spinner').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function hideSpinner() {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

    </script>

</head>
<body>
    <div class="container">
        <div class="item file-loader">
            <button onclick="openProblemFile()">Load problem from file</button>
            <button onclick="run_read_script()" style="left: 27%;" id="runScriptButton">Run script</button>
        </div>
        <div class="item status-log">
            <textarea id="status_log" spellcheck="false" readonly placeholder="Status Log">[INFO] Model successfully loaded</textarea>
        </div>
        <div class="item solution-list">
            <h2 style="width: 100%; text-align: center; margin-left: 0; margin-bottom: 15px; font-size: 1.2vw;; color: #3b3a38;">Previously solved problems</h2>
            <ul>
            </ul>
        </div>
        <div class="item drag-drop"
             ondragover="handleDragOver(event)"
             ondrop="handleFileDrop(event)">Drag & Drop (*.xlsx, *.csv, *.pkl, *.yaml, *.json)</div>
        <div class="item model-description">
            <h2 style="width: 100%; text-align: center; margin-left: 0; margin-bottom: 15px; font-size: 1.2vw;; color: #3b3a38;">Model description</h2>
            <textarea id="description" spellcheck="false" readonly placeholder=""></textarea>
        </div>
        <div class="item parameter-settings">
            <h2 style="width: 100%; text-align: center; margin-left: 0; margin-bottom: 15px; font-size: 1.2vw; 16px; color: #3b3a38;">Solver parameters</h2>
            <ul>
                <div class="row">
                <label for="time_limit">Time limit (in seconds):</label>
                <input id="time_limit" type="number" value="10">
            </div>
            <div class="row">
                <label for="numSolutions">Number of solutions:</label>
                <input id="numSolutions" type="number" value="3">
            </div>
            <div class="row">
                <label for="poolGap">PoolGap parameter:</label>
                <input id="poolGap" type="number" value="1.0">
            </div>
            </ul>
        </div>
        <div class="item action-buttons">
            <button id="solve_model_button" class="solve-button" onclick="callStartSolveModelForm()">Solve</button>
            <button class="back-button" onclick="callStartLoadModelForm()"><img src="Images/back.svg" alt="Back"></button>
        </div>
        <div class="item adjust-model">
            <textarea id="adjustment_prompt_textfield" spellcheck="false" placeholder="Prompt for adjusting the model"></textarea>
            <button onclick="callAdjustModel()" id="adjust_button">Adjust Model</button>
        </div>
        <div class="item adjust-history">
            <h2 style="width: 100%; text-align: center; margin-left: 0; margin-bottom: 15px; font-size: 1.2vw; color: #3b3a38;">Previous adjustments</h2>
            <ul>

            </ul>
        </div>
    </div>

    <div id="overlay"></div>
    <div id="spinner">
        <div class="loader"></div>
    </div>

</body>
</html>
