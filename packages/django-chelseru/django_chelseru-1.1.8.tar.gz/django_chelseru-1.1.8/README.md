# django-chelseru

ุจุณุชูู ุฌูฺฏู ุจุฑุง **ฺฏูพโุฒู ููุฒูุงู (WebSocket)**ุ **ุฑุงุณุชโุขุฒูุง ูพุงูฺฉ (OTP)** ู **ูุฑุณุชุงุฏู ูพุงูฺฉ** ุจุง ุงุฑโุฏููุฏูโูุง ุงุฑุงู.

**ููุณูุฏู:** Sobhan Bahman Rashnu

---

## ููุฑุณุช ูุทุงูุจ

- [ูฺฺฏโูุง](#ูฺฺฏูุง)
- [ูุตุจ](#ูุตุจ)
- [ูพุดโูุงุฒูุง ู ุงูุฒูุฏู ุจู ุชูุธูุงุช](#ูพุดูุงุฒูุง-ู-ุงูุฒูุฏู-ุจู-ุชูุธูุงุช)
- [ูพฺฉุฑุจูุฏ](#ูพฺฉุฑุจูุฏ)
- [ุชุนุฑู ุขุฏุฑุณโูุง (URLs)](#ุชุนุฑู-ุขุฏุฑุณูุง-urls)
- [ููุทูโูุง ูพุงุงู API](#ููุทููุง-ูพุงุงู-api)
  - [/api/otp/send/ โ ูุฑุณุชุงุฏู ุฑูุฒ ฺฉโุจุงุฑูุตุฑู](#apiotpsend--ูุฑุณุชุงุฏู-ุฑูุฒ-ฺฉุจุงุฑูุตุฑู)
  - [/api/authenticate/ โ ุฑุงุณุชโุขุฒูุง ุจุง OTP ู ุฏุฑุงูุช JWT](#apiauthenticate--ุฑุงุณุชุงูุฒูุง-ุจุง-otp-ู-ุฏุฑุงูุช-jwt)
  - [/api/message/send/ โ ูุฑุณุชุงุฏู ูพุงูฺฉ](#apimessagesend--ูุฑุณุชุงุฏู-ูพุงูฺฉ)
  - [/api/sessions/ โ ููุฑุณุช ูุดุณุชโูุง ูุนุงู](#apisessions--ููุฑุณุช-ูุดุณุชูุง-ูุนุงู)
- [ูุฏูโูุง](#ูุฏููุง)

---

## ูฺฺฏโูุง

- ๐ฑ **ุฑุงุณุชโุขุฒูุง ูพุงูฺฉ (OTP):** ุชููุฏ ู ูุฑุณุชุงุฏู ุฑูุฒ ฺฉโุจุงุฑูุตุฑู ู ุงุนุชุจุงุฑุณูุฌ ุงูู.
- ๐ฌ **ฺฏูพโุฒู ููุฒูุงู:** ูพุงูโุฑุณุงู ููุฒูุงู ุจุฑ ูพุงูู **WebSocket/Channels**.
- โ๏ธ **ูุฑุณุชุงุฏู ูพุงูฺฉ:** ูพุดุชุจุงู ุงุฒ ุงุฑโุฏููุฏูโูุง ูุงูโุขุดูุง ุงุฑุงู.

---

## ูุตุจ

```bash
pip install django-chelseru
```

---

## ูพุดโูุงุฒูุง ู ุงูุฒูุฏู ุจู ุชูุธูุงุช

`INSTALLED_APPS` ุฑุง ุฏุฑ `settings.py` ุจูโุฑูุฒ ฺฉูุฏ:

```python
INSTALLED_APPS = [
    # ...
    'channels',
    'rest_framework',
    'rest_framework_simplejwt',
    'drfchelseru',
    # ...
]
```

> ูฺฉุชู: ุจุฑุง ูุงุจูุชโูุง ููุฒูุงู (WebSocket) ูพุฑูฺูู ุดูุง ุจุงุฏ ุจุง **ASGI** ุงุฌุฑุง ุดูุฏ (ูุงููุฏ `daphne` ุง `uvicorn`).

---

## ูพฺฉุฑุจูุฏ

ูุงฺูโูุงููู `DJANGO_CHELSERU` ุฑุง ุฏุฑ `settings.py` ุจูุฒุงุฏ ู ุจุฑ ุงุณุงุณ ูุงุฒ ุฎูุฏ ุณูุงุฑุดโุณุงุฒ ฺฉูุฏ:

```python
DJANGO_CHELSERU = {
    'AUTH': {
        'AUTH_METHOD': 'OTP',  # ุฑูุดโูุง ูพุดุชุจุงูโุดุฏู: OTP, PASSWD
        'AUTH_SERVICE': 'rest_framework_simplejwt',  # ูุนูุงู: rest_framework_simplejwt
        'OPTIONS': {
            'OTP_LENGTH': 8,                 # ูพุดโูุฑุถ: 8
            'OTP_EXPIRE_PER_MINUTES': 4,     # ูพุดโูุฑุถ: 4
            'OTP_SMS_TEMPLATE_ID': 1,        # ุดูุงุณูู ูุงูุจ ูพุงูฺฉ OTP
        },
    },
    'SMS': {
        'SMS_SERVICE': 'PARSIAN_WEBCO_IR',  # PARSIAN_WEBCO_IR, MELI_PAYAMAK_COM, KAVENEGAR_COM
        'SETTINGS': {
            'PARSIAN_WEBCO_IR_API_KEY': '',
            'MELI_PAYAMAK_COM_USERNAME': '',
            'MELI_PAYAMAK_COM_PASSWORD': '',
            'MELI_PAYAMAK_COM_FROM': '',
            'KAVENEGAR_COM_API_KEY': 'YOUR_KAVENEGAR_API_KEY',
            'KAVENEGAR_COM_FROM': 'YOUR_KAVENEGAR_FROM_NUMBER',
        },
        'TEMPLATES': {
            'T1': 1,
            'T2': 2,
            # ...
        },
    },
}
```

**ุฑุงูููุง:**

- `AUTH_METHOD`: ุฑูุด ุฑุงุณุชโุขุฒูุง (ุจุฑุง ูพุงูฺฉ ุงุฒ `'OTP'` ุงุณุชูุงุฏู ฺฉูุฏ).
- `OTP_LENGTH`: ุทูู ุฑูุฒ ฺฉโุจุงุฑูุตุฑู.
- `OTP_EXPIRE_PER_MINUTES`: ูุฏุช ุงุนุชุจุงุฑ ุฑูุฒ (ุจู ุฏููู).
- `OTP_SMS_TEMPLATE_ID`: ุดูุงุณูู ูุงูุจ ูพุงูฺฉ ฺฉู ุจุฑุง OTP ุจูุฑูโฺฏุฑ ูโุดูุฏ.
- `SMS_SERVICE`: ุงูุชุฎุงุจ ุงุฑโุฏููุฏูู ูพุงูฺฉ.
- `SETTINGS`: ููุงุฏุฑ ุฏุณุชุฑุณ ุงุฑโุฏููุฏูู ุงูุชุฎุงุจโุดุฏู.
- `TEMPLATES`: ูฺฏุงุดุช ฺฉูุฏูุง ุฏูุฎูุงู ุจู ุดูุงุณูู ูุงูุจโูุง.

---

## ุชุนุฑู ุขุฏุฑุณโูุง (URLs)

ุฏุฑ `urls.py`:

```python
from django.urls import path, include

urlpatterns = [
    # ...
    path('api/', include('drfchelseru.urls')),
    # ...
]
```

---

## ููุทูโูุง ูพุงุงู API

| ูุณุฑ                 | ุดุฑุญ                                                | ุฑูุด  |
| -------------------- | -------------------------------------------------- | ---- |
| `/api/otp/send/`     | ูุฑุณุชุงุฏู ุฑูุฒ ฺฉโุจุงุฑูุตุฑู ุจู ุดูุงุฑูู ููุฑุงู             | POST |
| `/api/authenticate/` | ุฑุงุณุชโุขุฒูุง ฺฉุงุฑุจุฑ ุจุง OTP ู ุฏุฑุงูุช ุชูฺฉูโูุง JWT    | POST |
| `/api/sessions/`     | ููุฑุณุช ู ูุฏุฑุช ูุดุณุชโูุง ูุนุงู ฺฉุงุฑุจุฑ (ูุงุฒููุฏ ุงุญุฑุงุฒ) | GET  |
| `/api/message/send/` | ูุฑุณุชุงุฏู ูพุงูฺฉ ุจุง ุงุฑโุฏููุฏูู ูพฺฉุฑุจูุฏโุดุฏู          | POST |

---

### `/api/otp/send/` โ ูุฑุณุชุงุฏู ุฑูุฒ ฺฉโุจุงุฑูุตุฑู

**ุฑูุด:** `POST`\
**ุดุฑุญ:** ฺฉ OTP ุจู ุดูุงุฑูู ููุฑุงู ฺฉุงุฑุจุฑ ูุฑุณุชุงุฏู ูโุดูุฏ.

**ุจุฏููู ุฏุฑุฎูุงุณุช:**

| ููุฏ            | ููุน   | ุดุฑุญ                | ููููู         |
| --------------- | ----- | ------------------ | ------------- |
| `mobile_number` | `str` | ุดูุงุฑูู ููุฑุงู ฺฉุงุฑุจุฑ | `09121234567` |

**ูููููู ุฏุฑุฎูุงุณุช:**

```http
POST /api/otp/send/ HTTP/1.1
Content-Type: application/json

{
  "mobile_number": "09121234567"
}
```

**ูพุงุณุฎโูุง ููฺฉู:**

- `200 OK`
  ```json
  { "details": "The OTP code was sent correctly." }
  ```
- `400 Bad Request` โ ุณุงุฎุชุงุฑ ูุงุฏุฑุณุช `mobile_number`
- `409 Conflict`
  ```json
  { "details": "An OTP code has already been sent. Please wait X seconds before trying again." }
  ```
- `500 Internal Server Error` โ ุฎุทุง ุฏุฑ ฺฉุงุฑฺฏุฐุงุฑ

---

### `/api/authenticate/` โ ุฑุงุณุชโุขุฒูุง ุจุง OTP ู ุฏุฑุงูุช JWT

**ุฑูุด:** `POST`\
**ุดุฑุญ:** ุงุนุชุจุงุฑุณูุฌ ฺฉุงุฑุจุฑ ุจุง OTPุ ุฏุฑ ุตูุฑุช ููููุชุ ุชูฺฉูโูุง `access` ู `refresh` ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ.

**ุจุฏููู ุฏุฑุฎูุงุณุช:**

| ููุฏ            | ููุน   | ุดุฑุญ                         | ููููู         |
| --------------- | ----- | --------------------------- | ------------- |
| `mobile_number` | `str` | ุดูุงุฑูู ููุฑุงู ฺฉุงุฑุจุฑ          | `09121234567` |
| `code`          | `str` | ุฑูุฒ ฺฉโุจุงุฑูุตุฑู ุฏุฑุงูุชโุดุฏู   | `12345678`    |
| `group`         | `int` | (ุงุฎุชุงุฑ) ุดูุงุณูู ฺฏุฑูู ฺฉุงุฑุจุฑ | `1`           |

**ูููููู ุฏุฑุฎูุงุณุช:**

```http
POST /api/authenticate/ HTTP/1.1
Content-Type: application/json

{
  "mobile_number": "09121234567",
  "code": "12345678",
  "group": 1
}
```

**ูพุงุณุฎโูุง ููฺฉู:**

- `200 OK`
  ```json
  { "access": "...", "refresh": "..." }
  ```
- `401 Unauthorized`
  ```json
  { "error": "The code sent to this mobile number was not found." }
  ```
- `400 Bad Request` โ ููุฏูุง ุงูุฒุงู ูุงูพุฏุง/ูุงูุนุชุจุฑ
- `500 Internal Server Error` โ ุฎุทุง ุฏุฑ ฺฉุงุฑฺฏุฐุงุฑ

---

### `/api/message/send/` โ ูุฑุณุชุงุฏู ูพุงูฺฉ

**ุฑูุด:** `POST`\
**ุดุฑุญ:** ูุฑุณุชุงุฏู ูพุงูฺฉ ุณูุงุฑุด ุจุง ุงุฑโุฏููุฏูู ูพฺฉุฑุจูุฏโุดุฏู.

**ุจุฏููู ุฏุฑุฎูุงุณุช:**

| ููุฏ            | ููุน   | ุดุฑุญ                                            | ููููู           |
| --------------- | ----- | ---------------------------------------------- | --------------- |
| `mobile_number` | `str` | ุดูุงุฑูู ููุฑุงู ฺฏุฑูุฏู                            | `09121234567`   |
| `message_text`  | `str` | ูุชู ูพุงู (ุญุฏุงฺฉุซุฑ ฒนฐ ููุณู)                    | `Hello, World!` |
| `template_id`   | `int` | (ุจุฑุง ุจุฑุฎ ุงุฑโุฏููุฏูโูุง ูุงููุฏ ูพุงุฑุณุงู ุงูุฒุงู) | `1`             |

**ูููููู ุฏุฑุฎูุงุณุช:**

```http
POST /api/message/send/ HTTP/1.1
Content-Type: application/json

{
  "mobile_number": "09121234567",
  "message_text": "Hello, World!",
  "template_id": 1
}
```

**ูพุงุณุฎโูุง ููฺฉู:**

- `200 OK`
  ```json
  { "details": "The Message was sent correctly." }
  ```
- `400 Bad Request` โ ุฎุทุงูุง ุงุนุชุจุงุฑุณูุฌ ููุฏูุง
- `401 Unauthorized` โ ุงุญุฑุงุฒ ุงูุฌุงู ูุดุฏู
- `500 Internal Server Error` โ ุฎุทุง ุฏุฑ ฺฉุงุฑฺฏุฐุงุฑ
- `502 Bad Gateway` โ ุฎุทุง ุจุงุฒฺฏุดุช ุงุฒ ุงุฑโุฏููุฏูู ูพุงูฺฉ

---

### `/api/sessions/` โ ููุฑุณุช ูุดุณุชโูุง ูุนุงู

**ุฑูุด:** `GET`\
**ุดุฑุญ:** ูููู ูุดุณุชโูุง ูุนุงู ฺฉุงุฑุจุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ูุงุฒููุฏ **ุงุญุฑุงุฒ ููุช** (`IsAuthenticated`).

**ุณุฑุจุฑฺฏโูุง ูุงุฒู:**

| ุณุฑุจุฑฺฏ           | ููุฏุงุฑ                        |
| --------------- | ---------------------------- |
| `Authorization` | `Bearer <your_access_token>` |

**ูููููู ุฏุฑุฎูุงุณุช:**

```http
GET /api/sessions/ HTTP/1.1
Authorization: Bearer <your_access_token>
```

---

## ูุฏูโูุง

ุงู ุจุณุชู ฺฉ ูุฏู **Session** ุจุฑุง ูุฏุฑุช ูุดุณุชโูุง ูุนุงู ฺฉุงุฑุจุฑุงู ูุฑุงูู ูโฺฉูุฏ.\
ุงุฒ ุทุฑู ููุทูู ูพุงุงู `/api/sessions/` ูโุชูุงูุฏ ูุดุณุชโูุง ุฑุง ูุดุงูุฏู/ูุฏุฑุช ฺฉูุฏ.