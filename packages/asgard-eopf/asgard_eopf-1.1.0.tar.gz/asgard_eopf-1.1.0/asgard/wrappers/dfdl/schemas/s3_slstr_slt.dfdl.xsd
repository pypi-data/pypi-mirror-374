<xs:schema
  xmlns:sp="urn:spacePacket"
  xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns="http://www.esa.int/safe/sentinel-1.0/"
  targetNamespace="http://www.esa.int/safe/sentinel-1.0/">
  <xs:import namespace="urn:spacePacket" schemaLocation="SpacePacketFormat.dfdl.xsd"/>
  <xs:annotation>
    <xs:appinfo source="http://www.ogf.org/dfdl/">
      <dfdl:format ref="sp:SpacePacketFormat"/>
    </xs:appinfo>
  </xs:annotation>
  <xs:element name="isp" type="ispType"/>
  <xs:complexType name="ispType">
    <xs:sequence>
      <xs:element name="primaryHeader" type="sp:mainHeaderType"/>
      <xs:element name="secondaryHeader" type="sp:dataFieldHeaderType"/>
      <xs:element name="sourceData" type="slstrType"/>
      <xs:element name="errorControl" type="sp:crcType"/>
    </xs:sequence>
  </xs:complexType>

  <!-- === slstrType === -->
  <xs:complexType name="slstrType">
    <xs:sequence>
      <xs:element name="header" type="slstrHeader"/>
      <xs:element name="data" type="slstrData"/>
    </xs:sequence>
  </xs:complexType>

  <!-- === slstrHeader === -->
  <xs:complexType name="slstrHeader">
    <xs:sequence>
      <xs:element name="SCAN_SYNC_COUNTER" type="sp:uint16"/>
      <xs:element name="DPM_MODE" type="sp:uint8"/>
      <xs:element name="VALIDITY" type="sp:uint8"/>
      <xs:element name="TARGET_ID" type="sp:uint8"/>
      <xs:element name="TARGET_FIRST_ACQ" type="sp:uint16"/>
      <xs:element name="TARGET_LENGTH" type="sp:uint16"/>
    </xs:sequence>
  </xs:complexType>

  <!-- === slstrData === -->
  <xs:complexType name="slstrData">
    <xs:choice dfdl:choiceDispatchKey="{xs:string(../../primaryHeader/PCAT)}">
      <xs:element name="band" type="slstrBandArray" dfdl:choiceBranchKey="0 1 2 3 4 5 6 7 8 9 10"/>
      <xs:element name="scanpos" type="slstrScanEncoderArray" dfdl:choiceBranchKey="11"/>
      <xs:element name="hk" type="slstrHKArray" dfdl:choiceBranchKey="12"/>
    </xs:choice>
  </xs:complexType>

  <!-- === slstrScanEncoderArray === -->
  <xs:complexType name="slstrScanEncoderArray">
    <xs:sequence>
      <xs:element name="array" type="slstrScanEncoder" minOccurs="0" maxOccurs="4000"
                  dfdl:occursCountKind="expression"
                  dfdl:occursCount="{../../../header/TARGET_LENGTH}"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="slstrScanEncoder">
    <xs:sequence>
        <xs:element name="nad" type="sp:bit32" dfdl:length="24"/>
        <xs:element name="obl" type="sp:bit32" dfdl:length="24"/>
        <xs:element name="flip" type="sp:int16"/>
    </xs:sequence>
  </xs:complexType>

  <!-- === slstrBandArray === -->
  <xs:complexType name="slstrBandArray">
    <xs:sequence>
      <xs:element name="array" type="sp:uint16" minOccurs="0" maxOccurs="40000"
                  dfdl:occursCountKind="expression"
                  dfdl:occursCount="{(../../../../primaryHeader/packetLength - 22) idiv 2}"/>
    </xs:sequence>
  </xs:complexType>

  <xs:complexType name="slstrHKArray">
    <xs:sequence>
      <xs:element name="array" type="sp:hexBytes" dfdl:length="997"/>
    </xs:sequence>
  </xs:complexType>

</xs:schema>
