FROM python:3.12-slim

# Always set non-interactive mode for Debian-based images
ENV DEBIAN_FRONTEND=noninteractive

# Install apt packages (e.g., git, build tools, system libs)
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    git \
    curl \
    libssl-dev \
    ca-certificates \
    python3 python3-venv python3-pip \
    xvfb


WORKDIR /app

RUN apt update && apt install -y git
# RUN apt install python3 python3-pip -y
RUN git clone --recurse-submodules https://github.com/mikelma/craftium.git
WORKDIR /app/craftium
RUN apt install -y g++ make libc6-dev cmake libpng-dev libjpeg-dev libgl1-mesa-dev libsqlite3-dev \
libogg-dev libvorbis-dev libopenal-dev libcurl4-gnutls-dev libfreetype6-dev zlib1g-dev libgmp-dev \
libjsoncpp-dev libzstd-dev libluajit-5.1-dev gettext libsdl2-dev \
libpython3-dev \
minetest \ 
&& rm -rf /var/lib/apt/lists/*

RUN pip install --upgrade pip
RUN pip install --upgrade setuptools

RUN pip install .

RUN pip install portal loguru gymnasium

WORKDIR /app

COPY env_main.py .

CMD ["python", "env_main.py"]

