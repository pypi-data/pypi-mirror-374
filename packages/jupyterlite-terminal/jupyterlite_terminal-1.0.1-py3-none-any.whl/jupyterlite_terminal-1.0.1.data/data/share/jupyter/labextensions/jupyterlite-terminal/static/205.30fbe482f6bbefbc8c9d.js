"use strict";(self.webpackChunk_jupyterlite_terminal=self.webpackChunk_jupyterlite_terminal||[]).push([[205],{205:(e,t,s)=>{s.r(t),s.d(t,{Aliases:()=>i.D,Argument:()=>n.ef,BaseShell:()=>v,BaseShellWorker:()=>O.g,BooleanArgument:()=>n.C8,BorderTable:()=>x.Ju,BufferedOutput:()=>S.j,CommandArguments:()=>a.k,ConsoleOutput:()=>y,ControlCharacter:()=>F.hE,DummyInput:()=>E.X,DummyOutput:()=>b.y,ExitCode:()=>m.y,ExternalEnvironment:()=>I,ExternalInput:()=>w,ExternalOutput:()=>C,FileInput:()=>k.z,FileOutput:()=>T.M,HorizontalSpacerType:()=>x.Df,InputAll:()=>N.S,InputFlag:()=>F.tc,JavaScriptInput:()=>A._,LocalFlag:()=>F.Uq,OptionalStringArgument:()=>n.BT,OutputFlag:()=>F.OJ,PathType:()=>U.y,Pipe:()=>M.n,PipeInput:()=>B.J,PositionalArguments:()=>n.Tl,PositionalPathArguments:()=>n.ET,RedirectOutput:()=>R,Shell:()=>P,ShellManager:()=>V,SubcommandArguments:()=>a.s,Table:()=>x.XI,TerminalInput:()=>W.d,TerminalOutput:()=>L.m,Termios:()=>F.Gc,VerticalSpacerType:()=>x.tZ,ansi:()=>r.Q,delay:()=>p.cb,parse:()=>D.qg,tokenize:()=>$.q});var i=s(7450),r=s(9399),n=s(2199),a=s(5874),o=s(7262),l=s(4602),h=s(9017);class c{constructor(){}async disable(){this._enabled&&(this._enabled=!1,this._clear())}dispose(){this._isDisposed||(this._isDisposed=!0)}async enable(){this._enabled=!0}get enabled(){return this._enabled}get isDisposed(){return this._isDisposed}registerSendStdinNow(e){this._sendStdinNow=e}_enabled=!1;_isDisposed=!1;_sendStdinNow}var d=s(763);class u extends c{constructor(){super();const e=Int32Array.BYTES_PER_ELEMENT,t=d.X.maxChars+3;this._sharedArrayBuffer=new SharedArrayBuffer(t*e),this._intArray=new Int32Array(this._sharedArrayBuffer,0,t),this._intArray[d.X.MAIN]=0,this._intArray[d.X.WORKER]=0}async disable(){if(this._enabled){if(this._disabling=!0,this._readSentCount!==this._readCount){const e=this._loadFromSharedArrayBuffer();let t="";for(const s of e)t+=String.fromCharCode(s);this._sendStdinNow(t)}for(;this._readBuffer.length>0;)this._sendStdinNow(this._readBuffer.shift());await super.disable(),this._disabling=!1}}get sharedArrayBuffer(){return this._sharedArrayBuffer}async push(e){if(!this._enabled)throw new Error("SharedArrayBufferMainIO.push when disabled");e.length>d.X.maxChars&&console.log(`String '${e}' is too long to buffer`),this._readBuffer.push(e),this._readBufferCount++,this._disabling||this._readCount!==this._readSentCount||this._storeInSharedArrayBuffer()}_afterRead(){this._readCount=Atomics.load(this._intArray,1),this._readCount===this._readSentCount&&this._readBufferCount>this._readSentCount&&this._storeInSharedArrayBuffer()}_clear(){this._intArray[d.X.MAIN]=0,this._intArray[d.X.WORKER]=0,this._readCount=0,this._readBuffer=[],this._readBufferCount=0,this._readSentCount=0}_loadFromSharedArrayBuffer(){const e=Atomics.load(this._intArray,d.X.LENGTH),t=[];for(let s=0;s<e;s++)t.push(Atomics.load(this._intArray,d.X.START+s));return t}_storeInSharedArrayBuffer(){const e=this._readBuffer.shift();this._readSentCount++;const t=e.length;Atomics.store(this._intArray,d.X.LENGTH,t);for(let s=0;s<t;s++)Atomics.store(this._intArray,d.X.START+s,e.charCodeAt(s));Atomics.store(this._intArray,d.X.MAIN,this._readSentCount),Atomics.notify(this._intArray,d.X.MAIN,1);const{async:s,value:i}=Atomics.waitAsync(this._intArray,d.X.WORKER,this._readCount);s?i.then(()=>this._afterRead()):this._afterRead()}_disabling=!1;_intArray;_readBuffer=[];_readBufferCount=0;_readCount=0;_readSentCount=0;_sharedArrayBuffer}var _=s(8301),p=s(3291);class f extends c{constructor(e,t,s){super(),this._utils=new _.F(e,t,s)}async disable(){if(this._enabled){for(const e of this._readBuffer)this._sendStdinNow(e);this._readBuffer="",await super.disable()}}async push(e){if(!this._enabled)throw new Error("ServiceWorkerMainIO.push when disabled");void 0!==this._stdinPromise?(this._stdinPromise.resolve(e),this._stdinPromise=void 0):this._readBuffer+=e}_clear(){void 0!==this._stdinPromise&&(this._stdinPromise.reject("stdin no longer required"),this._stdinPromise=void 0),this._readBuffer=""}async handleStdin(e){if(!this._enabled)throw new Error("ServiceWorkerMainIO.handleStdin when disabled");const{test:t,timeoutMs:s}=e;if(t)return{text:"ok:"+e.shellId};if(this._readBuffer.length>0){const e=this._readBuffer;return this._readBuffer="",{text:e}}const i=new o.PromiseDelegate;return s>0&&(0,p.cb)(s).then(()=>i.resolve("")),this._stdinPromise=i,{text:await i.promise}}async testWithTimeout(e){if(!this._enabled)throw new Error("ServiceWorkerMainIO.testWithTimeout when disabled");const t=this._utils.getStdinAsync(0,!0),s=new Promise(t=>setTimeout(()=>t(null),e)),i=await Promise.race([t,s]);return null===i?(console.warn("Timeout accessing service worker"),!1):i==="ok:"+this._utils.shellId||(console.warn("Error accessing service worker"),!1)}_readBuffer="";_stdinPromise;_utils}class g{packageName;moduleName;outputCallback;constructor(e,t,s){this.packageName=e,this.moduleName=t,this.outputCallback=s}dispose(){this._isDisposed||(this.stop(),this._isDisposed=!0)}get isDisposed(){return this._isDisposed}start(){void 0!==this._intervalId&&this.stop(),this._intervalId=setInterval(this._callback.bind(this),this._delayMs)}stop(){void 0!==this._intervalId&&(clearTimeout(this._intervalId),this._intervalId=void 0,this._callbackCount=0,this._displayed&&this.outputCallback(r.Q.eraseEndLine+r.Q.showCursor),this._displayed=!1)}_callback(){if(this._callbackCount<this._initialIgnore);else if(this._displayed){const e=this._dots[(this._callbackCount-this._initialIgnore)%this._dots.length];this.outputCallback(e+r.Q.cursorLeft(1))}else{const e=` downloading wasm module '${this.moduleName}'`,t=e.length;this.outputCallback(r.Q.hideCursor+this._dots[0]+e+r.Q.cursorLeft(t+1)),this._displayed=!0}this._callbackCount++}_callbackCount=0;_delayMs=100;_dots="⠇⠋⠙⠸⠴⠦";_initialIgnore=3;_intervalId;_isDisposed=!1;_displayed=!1}var m=s(3482);class I extends Map{delete(e){return void 0===this._changed&&(this._changed=new Set),this._changed.add(e),super.delete(e)}get changed(){if(void 0===this._changed)return;const e={};return this._changed.forEach(t=>e[t]=this.get(t)),e}set(e,t){return void 0===this._changed&&(this._changed=new Set),this._changed.add(e),super.set(e,t),this}_changed}class w{callback;constructor(e,t){this.callback=e,this._isTerminal=t}isTerminal(){return this._isTerminal}async readAsync(e){return this.callback(e)}_isTerminal}class C{callback;constructor(e,t){this.callback=e,this._supportsAnsiEscapes=t}flush(){}supportsAnsiEscapes(){return this._supportsAnsiEscapes}write(e){this.callback(e)}_supportsAnsiEscapes}class v{options;constructor(e){this.options=e,this._shellId=e.shellId??o.UUID.uuid4(),void 0!==this.options.shellManager&&this.options.shellManager.registerShell(this._shellId,this,this._serviceWorkerHandleStdin.bind(this)),this._initialize()}async callExternalCommand(e,t,s,i,r,n){const a=this._externalCommands.get(e);if(void 0===a)return{exitCode:m.y.CANNOT_FIND_COMMAND};const{command:o}=a,l=new I(Object.entries(s)),h={name:e,args:t,environment:l,stdin:new w(e=>this._remote.externalInput(e),i),stdout:new C(e=>this._remote.externalOutput(e,!1),r),stderr:new C(e=>this._remote.externalOutput(e,!0),n)};return{exitCode:await o(h),environmentChanges:l.changed}}async callExternalTabComplete(e,t){const s=this._externalCommands.get(e);if(void 0===s)return console.warn("'{name} is not a registered external command"),{};const{tabComplete:i}=s;return void 0===i?(console.warn("External command '{name} does not support tab completion"),{}):await i({name:e,args:t})}dispose(){this._isDisposed||(console.log("Cockle Shell disposed"),this._isDisposed=!0,this._remote=void 0,this._worker.terminate(),void 0!==this._downloadTracker&&(this._downloadTracker.dispose(),this._downloadTracker=void 0),void 0!==this._sharedArrayBufferMainIO&&(this._sharedArrayBufferMainIO.dispose(),this._sharedArrayBufferMainIO=void 0),void 0!==this._serviceWorkerMainIO&&(this._serviceWorkerMainIO.dispose(),this._serviceWorkerMainIO=void 0),this._mainIO=void 0,this._disposed.emit())}get disposed(){return this._disposed}downloadWasmModuleCallback(e,t,s){s?(void 0!==this._downloadTracker&&this._downloadTracker.dispose(),this._downloadTracker=new g(e,t,this.options.outputCallback),this._downloadTracker.start()):void 0!==this._downloadTracker&&e===this._downloadTracker.packageName&&t===this._downloadTracker.moduleName&&this._downloadTracker.stop()}async exitCode(){return await(this._remote?.exitCode)??1}get isDisposed(){return this._isDisposed}async enableBufferedStdinCallback(e){this.isDisposed||(e?await(this._mainIO?.enable()):await(this._mainIO?.disable()))}async input(e){this.isDisposed||(this._mainIO?.enabled?await this._mainIO.push(e):await this._remote.input(e))}get ready(){return this._ready.promise}async setSize(e,t){this.isDisposed||await this._remote.setSize(e,t)}get shellId(){return this._shellId}async start(){this.isDisposed||(await this.ready,await this._remote.start())}async themeChange(e){await(this._remote?.themeChange(e))}async _initialize(){const e=window.crossOriginIsolated;e&&(this._sharedArrayBufferMainIO=new u);let t=!1;if(void 0!==this.options.browsingContextId){this._serviceWorkerMainIO=new f(this.options.baseUrl,this.options.browsingContextId,this.shellId),await this._serviceWorkerMainIO.enable();const e=await this._serviceWorkerMainIO.testWithTimeout(1e3);await this._serviceWorkerMainIO.disable(),e?(console.log("Service worker supports terminal stdin"),t=!0):(console.log("Service worker does not support terminal stdin"),this._serviceWorkerMainIO.dispose(),this._serviceWorkerMainIO=void 0)}if(!e&&!t){let e="ERROR: Terminal needs either SharedArrayBuffer or ServiceWorker available.";return console.error(e),(this.options.color??1)&&(e=r.Q.styleBoldRed+e+r.Q.styleReset),this.options.outputCallback(e),void this.dispose()}this._mainIO=this._sharedArrayBufferMainIO??this._serviceWorkerMainIO,this.options.externalCommands?.forEach(e=>this._externalCommands.set(e.name,e)),this._worker=this.initWorker(this.options),this._initRemote(this.options).then(this._ready.resolve.bind(this._ready))}async _initRemote(e){this._remote=(0,h.LV)(this._worker);const t=this._sharedArrayBufferMainIO?.sharedArrayBuffer??void 0,s=void 0!==this._serviceWorkerMainIO,i=e.externalCommands?.map(e=>({name:e.name,hasTabComplete:void 0!==e.tabComplete}));await this._remote.initialize({shellId:this.shellId,color:e.color??!0,mountpoint:e.mountpoint,wasmBaseUrl:e.wasmBaseUrl,baseUrl:e.baseUrl,browsingContextId:e.browsingContextId,aliases:e.aliases??{},environment:e.environment??{},externalCommandConfigs:i??[],sharedArrayBuffer:t,supportsServiceWorker:s,initialDirectories:e.initialDirectories,initialFiles:e.initialFiles},(0,h.BX)(this.callExternalCommand.bind(this)),(0,h.BX)(this.callExternalTabComplete.bind(this)),(0,h.BX)(this.downloadWasmModuleCallback.bind(this)),(0,h.BX)(this.enableBufferedStdinCallback.bind(this)),(0,h.BX)(e.outputCallback),(0,h.BX)(this._setMainIO.bind(this)),(0,h.BX)(this.dispose.bind(this))),void 0!==this._sharedArrayBufferMainIO&&this._sharedArrayBufferMainIO.registerSendStdinNow(this._remote.input),void 0!==this._serviceWorkerMainIO&&this._serviceWorkerMainIO.registerSendStdinNow(this._remote.input)}async _serviceWorkerHandleStdin(e){if(void 0!==this._serviceWorkerMainIO)return await this._serviceWorkerMainIO.handleStdin(e);throw new Error("No serviceWorker handleStdin exists")}_setMainIO(e){const t=this._mainIO;if("sab"===e&&void 0!==this._sharedArrayBufferMainIO)this._mainIO=this._sharedArrayBufferMainIO;else{if("sw"!==e||void 0===this._serviceWorkerMainIO)throw new Error(`Cannot set MainIO to '${e}'`);this._mainIO=this._serviceWorkerMainIO}t?.disable()}_disposed=new l.Signal(this);_isDisposed=!1;_ready=new o.PromiseDelegate;_shellId;_worker;_remote;_externalCommands=new Map;_serviceWorkerMainIO;_sharedArrayBufferMainIO;_mainIO;_downloadTracker}var O=s(6515),S=s(5670);class y{flush(){}supportsAnsiEscapes(){return!1}write(e){console.log(e)}}var E=s(312),b=s(2251),k=s(2958),T=s(5981),N=s(1315),A=s(1203),M=s(4207),B=s(952);class R extends S.j{constructor(e){super(),this.target=e}flush(){this.data.forEach(e=>this.target.write(e)),this.clear(),this.target.flush()}target}var W=s(8316),L=s(7703),x=s(585),D=s(7497);class P extends v{options;constructor(e){super(e),this.options=e}initWorker(e){return console.log("Cockle Shell.initWorker"),new Worker(new URL(s.p+s.u(63),s.b),{type:void 0})}}var X=s(3694);class H{baseUrl;shellManager;constructor(e,t){this.baseUrl=e,this.shellManager=t,this._browsingContextId=o.UUID.uuid4(),this._broadcastChannel=new BroadcastChannel("/cockle/service-worker"),this._broadcastChannel.addEventListener("message",this._onBroadcastMessage),this._initialize().catch(console.warn)}get enabled(){return null!==this._registration}get browsingContextId(){return this._browsingContextId}get ready(){return this._ready.promise}async _initialize(){const{serviceWorker:e}=navigator;let t=null;if(e){if(e.controller){const s=e.controller.scriptURL;await this._unregisterOldServiceWorkers(s),t=await e.getRegistration(s)||null,console.info("JupyterLite ServiceWorker was already registered")}if(!t&&e)try{console.info("Registering new ServiceWorker"),t=await e.register(new URL(s(5466),s.b),{type:"module"}),console.info("ServiceWorker successfully registered")}catch(e){console.warn(e),console.warn(`JupyterLite ServiceWorker registration unexpectedly failed: ${e}`)}this._setRegistration(t),t?(this._ready.resolve(void 0),setTimeout(this._pingServiceWorker,2e4)):this._ready.reject(void 0)}else console.warn("ServiceWorkers not supported in this browser")}_onBroadcastMessage=async e=>{const{browsingContextId:t,data:s,pathname:i}=e.data;if(t!==this._browsingContextId)return;if(!i.includes("/api/stdin/terminal"))return;const r=await this.shellManager.handleStdin(s);this._broadcastChannel.postMessage({response:r,browsingContextId:this._browsingContextId})};async _pingServiceWorker(){const e=await fetch("/api/service-worker-heartbeat");"ok"===await e.text()&&setTimeout(this._pingServiceWorker,2e4)}_setRegistration(e){this._registration=e}async _unregisterOldServiceWorkers(e){const t=`${e}-version`,s=localStorage.getItem(t);if(s&&s!==X.Z||!s){console.info("New version, unregistering existing service workers.");const e=await navigator.serviceWorker.getRegistrations();await Promise.all(e.map(e=>e.unregister())),console.info("All existing service workers have been unregistered.")}localStorage.setItem(t,X.Z)}_registration=null;_ready=new o.PromiseDelegate;_broadcastChannel;_browsingContextId}class V{async handleStdin(e){const{shellId:t}=e,s=this._shells.get(t);return void 0===s?{error:`Unrecognised shellId ${t}`}:await s(e)}async installServiceWorker(e){return void 0===this._serviceWorkerManager?(this._serviceWorkerManager=new H(e,this),await this._serviceWorkerManager.ready,await(0,p.cb)(100),this._serviceWorkerManager.browsingContextId):(console.warn("Service Worker already installed"),this._serviceWorkerManager.browsingContextId)}registerShell(e,t,s){if(""===e)throw new Error("shellId not set");if(this._shells.has(e))throw new Error(`Duplicate shellId: ${e}`);this._shells.set(e,s),t.disposed.connect(()=>this._shells.delete(e))}shellIds(){return[...this._shells.keys()]}_shells=new Map;_serviceWorkerManager}var U=s(955),F=s(4133),$=s(9685)},585:(e,t,s)=>{s.d(t,{Df:()=>i,Ju:()=>h,XI:()=>l,tZ:()=>r});var i,r,n=s(9399),a=s(3291);!function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"}(i||(i={})),function(e){e[e.LEFT=0]="LEFT",e[e.INNER=1]="INNER",e[e.RIGHT=2]="RIGHT"}(r||(r={}));class o{options;constructor(e){this.options=e}addHeaderRow(e){this._headerRows.push(e),this._updateColumnWidths(e)}addRow(e){this._rows.push(e),this._updateColumnWidths(e)}static defaultColorByColumn(){return new Map([[1,n.Q.styleBrightBlue],[2,n.Q.styleBrightPurple],[3,n.Q.styleGreen],[4,n.Q.styleYellow]])}*lines(){const{sortByColumn:e}=this.options;if(void 0!==e){const t=(s,i,r)=>{const n=e[s];return i[n]<r[n]?-1:i[n]>r[n]?1:e.length>s+1?t(s+1,i,r):0};this._rows.sort((e,s)=>t(0,e,s))}const t=this._columnWidths.length,s=this.horizontalSpacer(i.TOP);void 0!==s&&(yield(0,a.BO)(s));for(const e of this._headerRows){let s="";for(let i=0;i<t;i++){s+=this.verticalSpacer(0===i?r.LEFT:r.INNER);const t=e[i]??"";s+=t+" ".repeat(this._columnWidths[i]-t.length)}s+=this.verticalSpacer(r.RIGHT),yield(0,a.BO)(s)}if(this._headerRows.length>0){const e=this.horizontalSpacer(i.MIDDLE);void 0!==e&&(yield(0,a.BO)(e))}for(const e of this._rows){let s="";for(let i=0;i<t;i++){s+=this.verticalSpacer(0===i?r.LEFT:r.INNER);const t=e[i]??"";if(t){const e=this.options.colorByColumn?.get(i);s+=void 0!==e?e+t+n.Q.styleReset:t}s+=" ".repeat(this._columnWidths[i]-t.length)}s+=this.verticalSpacer(r.RIGHT),yield(0,a.BO)(s)}const o=this.horizontalSpacer(i.BOTTOM);void 0!==o&&(yield(0,a.BO)(o))}write(e,t="",s="\n"){for(const i of this.lines())e.write(t+i+s)}_updateColumnWidths(e){const t=e.map(e=>e.length),s=Math.min(this._columnWidths.length,t.length);for(let e=0;e<s;e++)this._columnWidths[e]=Math.max(this._columnWidths[e],t[e]);t.length>s&&this._columnWidths.push(...t.slice(s))}_columnWidths=[];_headerRows=[];_rows=[]}class l extends o{constructor(e={}){super(e);const t=e.spacerSize??2;this._spacer=" ".repeat(t),this._spacersAtEnds=e.spacersAtEnds??!1}horizontalSpacer(e){if(e===i.MIDDLE){const e=this._columnWidths.reduce((e,t)=>e+t)+this._totalSeparatorSize();return"─".repeat(e)}}verticalSpacer(e){return e===r.INNER||this._spacersAtEnds?this._spacer:""}_totalSeparatorSize(){let e=this._columnWidths.length-1;return this._spacersAtEnds&&(e+=2),e*this._spacer.length}_spacer;_spacersAtEnds}class h extends o{constructor(e={}){super(e)}horizontalSpacer(e){const t=(e=>{switch(e){case i.TOP:return"╭┬╮";case i.MIDDLE:return"├┼┤";case i.BOTTOM:return"╰┴╯"}})(e);return t[0]+this._columnWidths.map(e=>"─".repeat(e+2)).join(t[1])+t[2]}verticalSpacer(e){return e===r.LEFT?"│ ":e===r.RIGHT?" │":" │ "}}},2199:(e,t,s)=>{s.d(t,{BT:()=>a,C8:()=>n,ET:()=>l,Tl:()=>o,ef:()=>r});var i=s(7095);class r{shortName;longName;description;constructor(e,t,s){this.shortName=e,this.longName=t,this.description=s}get isSet(){return this._isSet}get name(){return this.shortName?this.shortName:this.longName}get prefixedName(){return this.shortName?`-${this.shortName}`:`--${this.longName}`}parse(e,t){return this.set(),t}set(){this._isSet=!0}_isSet=!1}class n extends r{constructor(e,t,s){super(e,t,s)}}class a extends n{constructor(e,t,s){super(e,t,s)}get string(){return this._string}parse(e,t){return this.set(),t.length>0&&!t[0].startsWith("-")&&(this._string=t.shift()),t}_string}class o extends r{options;constructor(e={}){super("","",""),this.options=e;const{max:t,min:s}=e;if(void 0!==s){if(s<0)throw new i.$g("Negative min for positional arguments");if(void 0!==t&&t<s)throw new i.$g("max must be greater than min for positional arguments")}}get length(){return this._strings.length}parse(e,t){this._strings.push(e),this.set();for(const e of t){if(e.startsWith("-"))throw new i.$g("Cannot have named argument after positional arguments");this._strings.push(e)}return[]}get strings(){return this._strings}_strings=[]}class l extends o{options;constructor(e={}){super(e),this.options=e}}},3291:(e,t,s)=>{async function i(e=10){await new Promise(t=>setTimeout(t,e))}function r(e,t){return`${e=e.replace(/\/+$/,"")}/${t=t.replace(/^\/+/,"")}`}function n(e,t=0){if(e.length<1)return"";const s=Math.min(...e.map(e=>e.length)),i=e[0];let r=t;for(;r<s&&e.every(e=>e[r]===i[r]);)r++;return i.slice(0,r)}function a(e){return e.replace(/\s+$/,"")}function o(e,t){if(e.length<1)return[];if(t<1)return[e.join("  ")];const s=e.length,i=Math.max(...e.map(e=>e.length)),r=Math.min(Math.floor(t/(i+2)),s),n=Math.ceil(s/r),a=[];for(let t=0;t<n;++t){let o="";for(let a=0;a<r;++a){const r=a*n+t;if(r>=s)continue;const l=e[r];o+=l,r+n<s&&(o+=" ".repeat(i+2-l.length))}a.push(o)}return a}s.d(t,{BO:()=>a,Il:()=>n,cb:()=>i,oq:()=>r,tp:()=>o})},4133:(e,t,s)=>{var i,r,n,a;s.d(t,{Gc:()=>o,OJ:()=>r,Uq:()=>n,hE:()=>a,tc:()=>i}),function(e){e[e.ISTRIP=32]="ISTRIP",e[e.INLCR=64]="INLCR",e[e.IGNCR=128]="IGNCR",e[e.ICRNL=256]="ICRNL",e[e.IUCLC=512]="IUCLC",e[e.IXON=1024]="IXON",e[e.IXANY=2048]="IXANY",e[e.IMAXBEL=8192]="IMAXBEL",e[e.IUTF8=16384]="IUTF8"}(i||(i={})),function(e){e[e.OPOST=1]="OPOST",e[e.OLCUC=2]="OLCUC",e[e.ONLCR=4]="ONLCR",e[e.OCRNL=8]="OCRNL",e[e.ONOCR=16]="ONOCR",e[e.ONLRET=32]="ONLRET",e[e.TABDLY=6144]="TABDLY"}(r||(r={})),function(e){e[e.ISIG=1]="ISIG",e[e.ICANON=2]="ICANON",e[e.ECHO=8]="ECHO",e[e.ECHOE=16]="ECHOE",e[e.ECHOK=32]="ECHOK",e[e.ECHONL=64]="ECHONL",e[e.NOFLSH=128]="NOFLSH",e[e.ECHOCTL=512]="ECHOCTL",e[e.ECHOPRT=1024]="ECHOPRT",e[e.ECHOKE=2048]="ECHOKE",e[e.IEXTEN=32768]="IEXTEN"}(n||(n={})),function(e){e[e.VINTR=0]="VINTR",e[e.VQUIT=1]="VQUIT",e[e.VERASE=2]="VERASE",e[e.VKILL=3]="VKILL",e[e.VEOF=4]="VEOF",e[e.VTIME=5]="VTIME",e[e.VMIN=6]="VMIN",e[e.VSWTCH=7]="VSWTCH",e[e.VSTART=8]="VSTART",e[e.VSTOP=9]="VSTOP",e[e.VSUSP=10]="VSUSP",e[e.VEOL=11]="VEOL",e[e.VREPRINT=12]="VREPRINT",e[e.VDISCARD=13]="VDISCARD",e[e.VWERASE=14]="VWERASE",e[e.VLNEXT=15]="VLNEXT",e[e.VEOL2=16]="VEOL2"}(a||(a={}));class o{constructor(){this.setDefaultShell()}clone(){return{c_iflag:this.c_iflag,c_oflag:this.c_oflag,c_cflag:this.c_cflag,c_lflag:this.c_lflag,c_cc:[...this.c_cc]}}log(e){const t=(e,t,s)=>{const i=[];for(const[t,r]of Object.entries(e).filter(([e,t])=>e[0].match(/\D/)))(s&r)>0&&i.push(t);return`  ${t} = ${s} 0x${s.toString(16)} = ${i.join(" ")}`},s=["Cockle "+e+":"];s.push(t(i,"c_iflag",this.c_iflag)),s.push(t(r,"c_oflag",this.c_oflag)),s.push(`  c_cflag = ${this.c_cflag} 0x${this.c_cflag.toString(16)}`),s.push(t(n,"c_lflag",this.c_lflag)),s.push(`  c_cc = ${this.c_cc}`),console.debug(s.join("\n"))}set(e){this.c_iflag=e.c_iflag,this.c_oflag=e.c_oflag,this.c_cflag=e.c_cflag,this.c_lflag=e.c_lflag,this.c_cc=[...e.c_cc],this.log("Termios set")}setDefaultShell(){this.setDefaultWasm(),this.c_oflag|=r.ONOCR}setDefaultWasm(){this.c_iflag=i.IUTF8|i.IMAXBEL|i.IXON|i.ICRNL,this.c_oflag=r.OPOST|r.ONLCR,this.c_cflag=191,this.c_lflag=n.IEXTEN|n.ECHOKE|n.ECHOCTL|n.ECHOK|n.ECHOE|n.ECHO|n.ICANON|n.ISIG,this.c_cc=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}setRawMode(){this.c_iflag&=~(i.ISTRIP|i.INLCR|i.IGNCR|i.ICRNL|i.IXON),this.c_oflag&=~r.OPOST,this.c_lflag&=~(n.ECHO|n.ECHONL|n.ICANON|n.ISIG|n.IEXTEN)}c_iflag=0;c_oflag=0;c_cflag=0;c_lflag=0;c_cc=[]}},5466:()=>{const e=new BroadcastChannel("/cockle/service-worker");self.addEventListener("install",function(e){self.skipWaiting()}),self.addEventListener("activate",function(e){e.waitUntil(self.clients.claim())}),self.addEventListener("fetch",async function(t){const{request:s}=t,i=new URL(s.url),r=i.pathname;if("/api/service-worker-heartbeat"!==r){if(r.endsWith("/api/stdin/terminal")){const r=async function(t,s){const i=await t.json(),r=new Promise(t=>{const s=r=>{const n=r.data;if(n.browsingContextId!==i.browsingContextId)return;const a=n.response;t(new Response(JSON.stringify(a))),e.removeEventListener("message",s)};e.addEventListener("message",s)});return i.pathname=s.pathname,e.postMessage(i),await r}(s,i);t.respondWith(r)}}else t.respondWith(new Response("ok"))})}}]);