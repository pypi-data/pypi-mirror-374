import{d as te,r as f,u as fe,s as ve,v as we,x as ge,y as be,z as D,c as k,b as o,e,A as E,j as d,B as he,C as ye,g as c,w as a,i as X,n as q,t as m,m as Pe,D as je,E as g,F as Ce,q as u,G as xe,H as Y,I as ke,J as Ve,K as Ie,L as Ne,M as ee,h as Se,N as Te,O as Re,o as P}from"./index-DeXzsHYB.js";import{_ as Ue}from"./logo@2x-bo-eMEnk.js";import{u as ze}from"./project-pakq9IUW.js";import{v as Be,a as De}from"./validator-D9zwvgt-.js";import{g as Ee}from"./all-DeDzFpLI.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const qe={class:"header"},Fe={class:"header-center"},$e={key:0,class:"project-info"},Le={class:"truncate-name"},Ae={key:1,class:"project-name-edit"},Me={class:"header-right"},Je={class:"action-buttons-group"},Ke={key:1,class:"button-divider"},Ge={class:"user-info"},He={class:"user-name"},Oe={class:"user-avatar"},Ze={class:"version-text"},Qe={class:"dialog-footer"},We={class:"queue-container"},Xe={class:"queue-section"},Ye={class:"section-header running"},et={class:"header-content"},tt={class:"table-container"},at={class:"queue-section"},st={class:"section-header pending"},ot={class:"header-content"},lt={class:"table-container"},nt=te({__name:"Head",setup(se){var G,H;const F=f(((G=window.RUNTIME_CONFIG)==null?void 0:G.VERSION)||"v1.0.0"),V=Se(),T=Re(),b=fe(),y=ve(),v=we(),{currentProject:n}=ge(y),$=f(((H=b.userInfo)==null?void 0:H.username)||"未登录"),oe=be(()=>{const s=$.value;return!s||s==="未登录"?"?":/[\u4e00-\u9fa5]/.test(s)?s.charAt(0):s.charAt(0).toUpperCase()}),j=f(!1),p=f(""),L=f();D(()=>n.value,s=>{s||(j.value=!1,p.value="")},{immediate:!0}),D(()=>T.path,s=>{s==="/user/list"&&n.value&&y.clearCurrentProject()},{immediate:!0});const le=s=>Be(s,t=>{p.value=t}),ne=()=>{var r,x;if(((r=b.userInfo)==null?void 0:r.username)==="admin"){g.warning("管理员账号无权访问项目页面");return}const s=v.isUploading,t=v.showUploadingTip;s&&t?ee.confirm("当前有上传任务正在进行中，离开页面将中断上传。是否确认离开？","提示",{confirmButtonText:"确认离开",cancelButtonText:"取消",type:"warning"}).then(()=>{var w;v.setShowUploadingTip(!1),v.resetFilterConditions(),v.resetAnalysisFilterConditions(),y.clearCurrentProject(),v.clearProjectSampleState(Number(((w=n.value)==null?void 0:w.id)||"")),V.push("/project")}).catch(()=>{}):(v.resetFilterConditions(),v.resetAnalysisFilterConditions(),y.clearCurrentProject(),v.resetFilterParams(),v.clearProjectSampleState(Number(((x=n.value)==null?void 0:x.id)||"")),V.push("/project"))},re=()=>{var s,t;((s=n.value)==null?void 0:s.username)==((t=b.userInfo)==null?void 0:t.username)&&n.value&&(j.value=!0,p.value=n.value.name,je(()=>{var r;(r=L.value)==null||r.focus()}))},A=async()=>{var s;if(!n.value||!p.value.trim()){j.value=!1,p.value=((s=n.value)==null?void 0:s.name)||"";return}if(p.value===n.value.name){j.value=!1;return}if(le(p.value))try{const{data:t}=await ze({project_id:Number(n.value.id),name:p.value.trim()});t.code===200?(y.updateCurrentProject({...n.value,name:p.value.trim()}),g.success("项目名称修改成功")):(g.error(t.msg||"项目名称修改失败"),p.value=n.value.name)}catch(t){g.error((t==null?void 0:t.message)||"项目名称修改失败"),p.value=n.value.name}finally{j.value=!1}},de=async()=>{try{await ee.confirm("确认退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await b.logout(),y.clearCurrentProject(),V.push("/"),g.success("已退出登录")}catch(s){y.clearCurrentProject(),g.error((s==null?void 0:s.message)||"退出失败，请重试")}}catch{}},C=f(!1),R=f(!1),I=f([]),N=f([]),U=f(),_=f({oldPassword:"",newPassword:"",confirmPassword:""}),ie={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度应为 6-20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{6,20}$/,message:"密码必须包含大小写字母、数字和特殊字符,不能有空格/中文",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(s,t,r)=>{De(t,_.value.newPassword,r)},trigger:"blur"}]},ue=()=>{C.value=!0},M=async()=>{U.value&&await U.value.validate(async s=>{var t;if(s)try{const{oldPassword:r,newPassword:x}=_.value;if(!((t=b.userInfo)!=null&&t.id))throw new Error("用户未登录，请先登录");const{data:w}=await Te({user_id:b.userInfo.id,old_password:r,new_password:x});w.code==200?(g.success("密码修改成功"),C.value=!1,_.value={oldPassword:"",newPassword:"",confirmPassword:""}):g.error(w.msg||"密码修改失败")}catch(r){g.error((r==null?void 0:r.message)||"密码修改失败")}})};D(C,s=>{s||(_.value={oldPassword:"",newPassword:"",confirmPassword:""})});const ce=()=>{R.value=!0,Ee().then(s=>{N.value=s.data.data.running,I.value=s.data.data.pending})},J=s=>({train:"模型训练",eval:"模型评估",export:"模型导出"})[s]||s,K=s=>({train:"",eval:"",export:""})[s]||"";return(s,t)=>{var Q,W;const r=c("el-icon"),x=c("el-tooltip"),w=c("el-input"),S=c("el-button"),z=c("el-dropdown-item"),pe=c("el-dropdown-menu"),me=c("el-dropdown"),B=c("el-form-item"),_e=c("el-form"),O=c("el-dialog"),h=c("el-tag"),i=c("el-table-column"),Z=c("el-table");return P(),k("div",qe,[t[17]||(t[17]=o("div",{class:"header-left"},[o("img",{src:Ue,alt:"Logo",class:"logo"})],-1)),o("div",Fe,[d(n)?(P(),k("div",$e,[j.value?(P(),k("div",Ae,[e(w,{disabled:d(n).username!=((W=d(b).userInfo)==null?void 0:W.username),modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),size:"small",class:"name-edit-input",placeholder:"输入项目名称",onBlur:A,onKeyup:X(A,["enter"]),maxlength:100,"show-word-limit":!0,ref_key:"nameInputRef",ref:L},null,8,["disabled","modelValue"])])):(P(),k("div",{key:0,class:"project-name",onClick:re},[he(e(r,{class:"edit-icon"},{default:a(()=>[e(d(Ce))]),_:1},512),[[ye,d(n).username==((Q=d(b).userInfo)==null?void 0:Q.username)]]),e(x,{content:d(n).name,placement:"bottom","show-after":500,"hide-after":500},{default:a(()=>[o("span",Le,m(d(n).name),1)]),_:1},8,["content"])])),o("div",{class:q(["project-type",{"detection-type":d(n).type_abbreviation==="DET","segmentation-type":d(n).type_abbreviation==="SEG","classification-type":d(n).type_abbreviation==="CLS","instance-type":d(n).type_abbreviation==="INS"}])},m(d(n).type_full),3)])):E("",!0)]),o("div",Me,[o("div",Je,[d(n)?(P(),Pe(S,{key:0,text:"",class:"header-action-btn",onClick:ne},{default:a(()=>[e(r,null,{default:a(()=>[e(d(xe))]),_:1}),t[7]||(t[7]=u(" 返回项目管理 "))]),_:1})):E("",!0),d(n)?(P(),k("div",Ke)):E("",!0),e(S,{text:"",class:"header-action-btn",onClick:ce},{default:a(()=>[e(r,null,{default:a(()=>[e(d(Y))]),_:1}),t[8]||(t[8]=u(" 排队状况 "))]),_:1})]),e(me,{trigger:"click"},{dropdown:a(()=>[e(pe,null,{default:a(()=>[e(z,{onClick:ue},{default:a(()=>[e(r,null,{default:a(()=>[e(d(Ve))]),_:1}),t[9]||(t[9]=u(" 修改密码 "))]),_:1}),e(z,{onClick:de},{default:a(()=>[e(r,null,{default:a(()=>[e(d(Ie))]),_:1}),t[10]||(t[10]=u(" 退出登录 "))]),_:1}),e(z,{divided:"",disabled:""},{default:a(()=>[o("span",Ze,"版本号："+m(F.value),1)]),_:1})]),_:1})]),default:a(()=>[o("div",Ge,[o("span",He,m($.value),1),o("div",Oe,m(oe.value),1),e(r,{class:"arrow-icon"},{default:a(()=>[e(d(ke))]),_:1})])]),_:1})]),e(O,{modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=l=>C.value=l),title:"修改密码",width:"450px","close-on-click-modal":!1,class:"password-dialog","destroy-on-close":""},{footer:a(()=>[o("div",Qe,[e(S,{onClick:t[4]||(t[4]=l=>C.value=!1)},{default:a(()=>t[11]||(t[11]=[u("取消")])),_:1}),e(S,{type:"primary",onClick:M},{default:a(()=>t[12]||(t[12]=[u("确认")])),_:1})])]),default:a(()=>[e(_e,{ref_key:"passwordFormRef",ref:U,model:_.value,rules:ie,"label-width":"100px",onKeyup:X(M,["enter"])},{default:a(()=>[e(B,{label:"原密码",prop:"oldPassword"},{default:a(()=>[e(w,{modelValue:_.value.oldPassword,"onUpdate:modelValue":t[1]||(t[1]=l=>_.value.oldPassword=l),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1}),e(B,{label:"新密码",prop:"newPassword"},{default:a(()=>[e(w,{modelValue:_.value.newPassword,"onUpdate:modelValue":t[2]||(t[2]=l=>_.value.newPassword=l),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),e(B,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[e(w,{modelValue:_.value.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=l=>_.value.confirmPassword=l),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(O,{title:"任务排队状况",modelValue:R.value,"onUpdate:modelValue":t[6]||(t[6]=l=>R.value=l),width:"1000px","close-on-click-modal":!1,class:"queue-status-dialog"},{default:a(()=>[o("div",We,[o("div",Xe,[o("div",Ye,[o("div",et,[e(r,{class:"status-icon"},{default:a(()=>[e(d(Y))]),_:1}),t[13]||(t[13]=o("span",{class:"section-title"},"运行中",-1)),e(h,{type:"success",size:"small",round:""},{default:a(()=>[u(m(N.value.length),1)]),_:1})])]),o("div",tt,[e(Z,{data:N.value,"show-header":N.value.length>0,"max-height":"300",class:"queue-table","empty-text":"暂无运行中的任务"},{default:a(()=>[e(i,{prop:"project_id",label:"项目ID",width:"120"},{default:a(({row:l})=>[e(h,{size:"small",effect:"plain"},{default:a(()=>[u(m(l.project_id),1)]),_:2},1024)]),_:1}),e(i,{prop:"job_id",label:"任务ID",width:"120"},{default:a(({row:l})=>[e(h,{size:"small",type:"primary",effect:"plain"},{default:a(()=>[u(m(l.job_id),1)]),_:2},1024)]),_:1}),e(i,{prop:"project_name",label:"项目名"}),e(i,{prop:"job_name",label:"任务名"}),e(i,{prop:"user",label:"用户"}),e(i,{prop:"job_type",label:"任务类型","min-width":"140"},{default:a(({row:l})=>[e(h,{size:"small",type:K(l.job_type),effect:"light",class:q(`job-type-${l.job_type}`)},{default:a(()=>[u(m(J(l.job_type)),1)]),_:2},1032,["type","class"])]),_:1}),e(i,{label:"状态",width:"100"},{default:a(()=>t[14]||(t[14]=[o("div",{class:"status-indicator running"},[o("div",{class:"status-dot"}),o("span",null,"运行中")],-1)])),_:1})]),_:1},8,["data","show-header"])])]),o("div",at,[o("div",st,[o("div",ot,[e(r,{class:"status-icon"},{default:a(()=>[e(d(Ne))]),_:1}),t[15]||(t[15]=o("span",{class:"section-title"},"等待中",-1)),e(h,{type:"warning",size:"small",round:""},{default:a(()=>[u(m(I.value.length),1)]),_:1})])]),o("div",lt,[e(Z,{data:I.value,"show-header":I.value.length>0,"max-height":"300",class:"queue-table","empty-text":"暂无等待中的任务"},{default:a(()=>[e(i,{prop:"project_id",label:"项目ID",width:"120"},{default:a(({row:l})=>[e(h,{size:"small",effect:"plain"},{default:a(()=>[u(m(l.project_id),1)]),_:2},1024)]),_:1}),e(i,{prop:"job_id",label:"任务ID",width:"120"},{default:a(({row:l})=>[e(h,{size:"small",type:"primary",effect:"plain"},{default:a(()=>[u(m(l.job_id),1)]),_:2},1024)]),_:1}),e(i,{prop:"project_name",label:"项目名"}),e(i,{prop:"job_name",label:"任务名"}),e(i,{prop:"user",label:"用户"}),e(i,{prop:"job_type",label:"任务类型","min-width":"140"},{default:a(({row:l})=>[e(h,{size:"small",type:K(l.job_type),effect:"light",class:q(`job-type-${l.job_type}`)},{default:a(()=>[u(m(J(l.job_type)),1)]),_:2},1032,["type","class"])]),_:1}),e(i,{label:"状态",width:"100"},{default:a(()=>t[16]||(t[16]=[o("div",{class:"status-indicator pending"},[o("div",{class:"status-dot"}),o("span",null,"等待中")],-1)])),_:1})]),_:1},8,["data","show-header"])])])])]),_:1},8,["modelValue"])])}}}),rt=ae(nt,[["__scopeId","data-v-8b661e88"]]),dt={class:"main-layout"},it={class:"main-content"},ut=te({__name:"MainLayout",setup(se){return(F,V)=>{const T=c("router-view");return P(),k("div",dt,[e(rt),o("div",it,[e(T)])])}}}),gt=ae(ut,[["__scopeId","data-v-f2df2166"]]);export{gt as default};
//# sourceMappingURL=MainLayout-B3lR9WJE.js.map
