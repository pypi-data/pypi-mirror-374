import{d as ae,r as g,u as fe,s as ve,v as we,x as ge,y as ye,z as B,c as k,b as o,e,A as E,j as i,B as be,C as he,g as p,w as a,i as Y,n as q,t as _,m as Pe,D as je,E as b,F as Ce,q as c,G as Se,H as ee,I as xe,J as Ie,K as Ne,L as ke,M as te,h as Ve,N as Te,O as Fe,o as S}from"./index-o9GSe-j3.js";import{_ as Re}from"./logo@2x-bo-eMEnk.js";import{u as Ue}from"./project-AUnovL9V.js";import{v as ze,a as De}from"./validator-da1ShlCT.js";import{g as Be}from"./all-Bn4xrjUW.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"header"},qe={class:"header-center"},$e={key:0,class:"project-info"},Je={class:"truncate-name"},Le={key:1,class:"project-name-edit"},Ae={class:"header-right"},Oe={class:"action-buttons-group"},Ke={key:1,class:"button-divider"},Me={class:"user-info"},Ge={class:"user-name"},He={class:"user-avatar"},Ze={class:"version-text"},Qe={class:"dialog-footer"},We={class:"queue-container"},Xe={class:"queue-section"},Ye={class:"section-header running"},et={class:"header-content"},tt={class:"table-container"},at={class:"queue-section"},st={class:"section-header pending"},ot={class:"header-content"},lt={class:"table-container"},nt=ae({__name:"Head",setup(oe){var G,H;const $=g(((G=window.RUNTIME_CONFIG)==null?void 0:G.VERSION)||"v1.0.0"),V=Ve(),R=Fe(),h=fe(),j=ve(),y=we(),{currentProject:n}=ge(j),J=g(((H=h.userInfo)==null?void 0:H.username)||"未登录"),le=ye(()=>{const s=J.value;return!s||s==="未登录"?"?":/[\u4e00-\u9fa5]/.test(s)?s.charAt(0):s.charAt(0).toUpperCase()}),x=g(!1),m=g(""),L=g();B(()=>n.value,s=>{s||(x.value=!1,m.value="")},{immediate:!0}),B(()=>R.path,s=>{s==="/user/list"&&n.value&&j.clearCurrentProject()},{immediate:!0});const ne=s=>ze(s,t=>{m.value=t}),re=()=>{var r,N;if(((r=h.userInfo)==null?void 0:r.username)==="admin"){b.warning("管理员账号无权访问项目页面");return}const s=y.isUploading,t=y.showUploadingTip;if(s&&t)te.confirm("当前有上传任务正在进行中，离开页面将中断上传。是否确认离开？","提示",{confirmButtonText:"确认离开",cancelButtonText:"取消",type:"warning"}).then(()=>{var d;y.setShowUploadingTip(!1),y.resetFilterConditions(),y.resetAnalysisFilterConditions();try{const f="sample",v=localStorage.getItem(f);if(v){const C=JSON.parse(v);C.filterConditions&&delete C.filterConditions,C.analysisFilterConditions&&delete C.analysisFilterConditions,localStorage.setItem(f,JSON.stringify(C))}}catch(f){console.warn("清理持久化筛选条件失败:",f)}j.clearCurrentProject(),y.clearProjectSampleState(Number(((d=n.value)==null?void 0:d.id)||"")),V.push("/project")}).catch(()=>{});else{y.resetFilterConditions(),y.resetAnalysisFilterConditions();try{const d="sample",f=localStorage.getItem(d);if(f){const v=JSON.parse(f);v.filterConditions&&delete v.filterConditions,v.analysisFilterConditions&&delete v.analysisFilterConditions,localStorage.setItem(d,JSON.stringify(v))}}catch(d){console.warn("清理持久化筛选条件失败:",d)}j.clearCurrentProject(),y.resetFilterParams(),y.clearProjectSampleState(Number(((N=n.value)==null?void 0:N.id)||"")),V.push("/project")}},ie=()=>{var s,t;((s=n.value)==null?void 0:s.username)==((t=h.userInfo)==null?void 0:t.username)&&n.value&&(x.value=!0,m.value=n.value.name,je(()=>{var r;(r=L.value)==null||r.focus()}))},A=async()=>{var s;if(!n.value||!m.value.trim()){x.value=!1,m.value=((s=n.value)==null?void 0:s.name)||"";return}if(m.value===n.value.name){x.value=!1;return}if(ne(m.value))try{const{data:t}=await Ue({project_id:Number(n.value.id),name:m.value.trim()});t.code===200?(j.updateCurrentProject({...n.value,name:m.value.trim()}),b.success("项目名称修改成功")):(b.error(t.msg||"项目名称修改失败"),m.value=n.value.name)}catch(t){b.error((t==null?void 0:t.message)||"项目名称修改失败"),m.value=n.value.name}finally{x.value=!1}},de=async()=>{try{await te.confirm("确认退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await h.logout(),j.clearCurrentProject(),V.push("/"),b.success("已退出登录")}catch(s){j.clearCurrentProject(),b.error((s==null?void 0:s.message)||"退出失败，请重试")}}catch{}},I=g(!1),U=g(!1),T=g([]),F=g([]),z=g(),w=g({oldPassword:"",newPassword:"",confirmPassword:""}),ue={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度应为 6-20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{6,20}$/,message:"密码必须包含大小写字母、数字和特殊字符,不能有空格/中文",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(s,t,r)=>{De(t,w.value.newPassword,r)},trigger:"blur"}]},ce=()=>{I.value=!0},O=async()=>{z.value&&await z.value.validate(async s=>{var t;if(s)try{const{oldPassword:r,newPassword:N}=w.value;if(!((t=h.userInfo)!=null&&t.id))throw new Error("用户未登录，请先登录");const{data:d}=await Te({user_id:h.userInfo.id,old_password:r,new_password:N});d.code==200?(b.success("密码修改成功"),I.value=!1,w.value={oldPassword:"",newPassword:"",confirmPassword:""}):b.error(d.msg||"密码修改失败")}catch(r){b.error((r==null?void 0:r.message)||"密码修改失败")}})};B(I,s=>{s||(w.value={oldPassword:"",newPassword:"",confirmPassword:""})});const pe=()=>{U.value=!0,Be().then(s=>{F.value=s.data.data.running,T.value=s.data.data.pending})},K=s=>({train:"模型训练",eval:"模型评估",export:"模型导出"})[s]||s,M=s=>({train:"",eval:"",export:""})[s]||"";return(s,t)=>{var W,X;const r=p("el-icon"),N=p("el-tooltip"),d=p("el-input"),f=p("el-button"),v=p("el-dropdown-item"),C=p("el-dropdown-menu"),me=p("el-dropdown"),D=p("el-form-item"),_e=p("el-form"),Z=p("el-dialog"),P=p("el-tag"),u=p("el-table-column"),Q=p("el-table");return S(),k("div",Ee,[t[17]||(t[17]=o("div",{class:"header-left"},[o("img",{src:Re,alt:"Logo",class:"logo"})],-1)),o("div",qe,[i(n)?(S(),k("div",$e,[x.value?(S(),k("div",Le,[e(d,{disabled:i(n).username!=((X=i(h).userInfo)==null?void 0:X.username),modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l),size:"small",class:"name-edit-input",placeholder:"输入项目名称",onBlur:A,onKeyup:Y(A,["enter"]),maxlength:100,"show-word-limit":!0,ref_key:"nameInputRef",ref:L},null,8,["disabled","modelValue"])])):(S(),k("div",{key:0,class:"project-name",onClick:ie},[be(e(r,{class:"edit-icon"},{default:a(()=>[e(i(Ce))]),_:1},512),[[he,i(n).username==((W=i(h).userInfo)==null?void 0:W.username)]]),e(N,{content:i(n).name,placement:"bottom","show-after":500,"hide-after":500},{default:a(()=>[o("span",Je,_(i(n).name),1)]),_:1},8,["content"])])),o("div",{class:q(["project-type",{"detection-type":i(n).type_abbreviation==="DET","segmentation-type":i(n).type_abbreviation==="SEG","classification-type":i(n).type_abbreviation==="CLS","instance-type":i(n).type_abbreviation==="INS"}])},_(i(n).type_full),3)])):E("",!0)]),o("div",Ae,[o("div",Oe,[i(n)?(S(),Pe(f,{key:0,text:"",class:"header-action-btn",onClick:re},{default:a(()=>[e(r,null,{default:a(()=>[e(i(Se))]),_:1}),t[7]||(t[7]=c(" 返回项目管理 "))]),_:1})):E("",!0),i(n)?(S(),k("div",Ke)):E("",!0),e(f,{text:"",class:"header-action-btn",onClick:pe},{default:a(()=>[e(r,null,{default:a(()=>[e(i(ee))]),_:1}),t[8]||(t[8]=c(" 排队状况 "))]),_:1})]),e(me,{trigger:"click"},{dropdown:a(()=>[e(C,null,{default:a(()=>[e(v,{onClick:ce},{default:a(()=>[e(r,null,{default:a(()=>[e(i(Ie))]),_:1}),t[9]||(t[9]=c(" 修改密码 "))]),_:1}),e(v,{onClick:de},{default:a(()=>[e(r,null,{default:a(()=>[e(i(Ne))]),_:1}),t[10]||(t[10]=c(" 退出登录 "))]),_:1}),e(v,{divided:"",disabled:""},{default:a(()=>[o("span",Ze,"版本号："+_($.value),1)]),_:1})]),_:1})]),default:a(()=>[o("div",Me,[o("span",Ge,_(J.value),1),o("div",He,_(le.value),1),e(r,{class:"arrow-icon"},{default:a(()=>[e(i(xe))]),_:1})])]),_:1})]),e(Z,{modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=l=>I.value=l),title:"修改密码",width:"450px","close-on-click-modal":!1,class:"password-dialog","destroy-on-close":""},{footer:a(()=>[o("div",Qe,[e(f,{onClick:t[4]||(t[4]=l=>I.value=!1)},{default:a(()=>t[11]||(t[11]=[c("取消")])),_:1}),e(f,{type:"primary",onClick:O},{default:a(()=>t[12]||(t[12]=[c("确认")])),_:1})])]),default:a(()=>[e(_e,{ref_key:"passwordFormRef",ref:z,model:w.value,rules:ue,"label-width":"100px",onKeyup:Y(O,["enter"])},{default:a(()=>[e(D,{label:"原密码",prop:"oldPassword"},{default:a(()=>[e(d,{modelValue:w.value.oldPassword,"onUpdate:modelValue":t[1]||(t[1]=l=>w.value.oldPassword=l),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1}),e(D,{label:"新密码",prop:"newPassword"},{default:a(()=>[e(d,{modelValue:w.value.newPassword,"onUpdate:modelValue":t[2]||(t[2]=l=>w.value.newPassword=l),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),e(D,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[e(d,{modelValue:w.value.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=l=>w.value.confirmPassword=l),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Z,{title:"任务排队状况",modelValue:U.value,"onUpdate:modelValue":t[6]||(t[6]=l=>U.value=l),width:"1000px","close-on-click-modal":!1,class:"queue-status-dialog"},{default:a(()=>[o("div",We,[o("div",Xe,[o("div",Ye,[o("div",et,[e(r,{class:"status-icon"},{default:a(()=>[e(i(ee))]),_:1}),t[13]||(t[13]=o("span",{class:"section-title"},"运行中",-1)),e(P,{type:"success",size:"small",round:""},{default:a(()=>[c(_(F.value.length),1)]),_:1})])]),o("div",tt,[e(Q,{data:F.value,"show-header":F.value.length>0,"max-height":"300",class:"queue-table","empty-text":"暂无运行中的任务"},{default:a(()=>[e(u,{prop:"project_id",label:"项目ID",width:"120"},{default:a(({row:l})=>[e(P,{size:"small",effect:"plain"},{default:a(()=>[c(_(l.project_id),1)]),_:2},1024)]),_:1}),e(u,{prop:"job_id",label:"任务ID",width:"120"},{default:a(({row:l})=>[e(P,{size:"small",type:"primary",effect:"plain"},{default:a(()=>[c(_(l.job_id),1)]),_:2},1024)]),_:1}),e(u,{prop:"project_name",label:"项目名"}),e(u,{prop:"job_name",label:"任务名"}),e(u,{prop:"user",label:"用户"}),e(u,{prop:"job_type",label:"任务类型","min-width":"140"},{default:a(({row:l})=>[e(P,{size:"small",type:M(l.job_type),effect:"light",class:q(`job-type-${l.job_type}`)},{default:a(()=>[c(_(K(l.job_type)),1)]),_:2},1032,["type","class"])]),_:1}),e(u,{label:"状态",width:"100"},{default:a(()=>t[14]||(t[14]=[o("div",{class:"status-indicator running"},[o("div",{class:"status-dot"}),o("span",null,"运行中")],-1)])),_:1})]),_:1},8,["data","show-header"])])]),o("div",at,[o("div",st,[o("div",ot,[e(r,{class:"status-icon"},{default:a(()=>[e(i(ke))]),_:1}),t[15]||(t[15]=o("span",{class:"section-title"},"等待中",-1)),e(P,{type:"warning",size:"small",round:""},{default:a(()=>[c(_(T.value.length),1)]),_:1})])]),o("div",lt,[e(Q,{data:T.value,"show-header":T.value.length>0,"max-height":"300",class:"queue-table","empty-text":"暂无等待中的任务"},{default:a(()=>[e(u,{prop:"project_id",label:"项目ID",width:"120"},{default:a(({row:l})=>[e(P,{size:"small",effect:"plain"},{default:a(()=>[c(_(l.project_id),1)]),_:2},1024)]),_:1}),e(u,{prop:"job_id",label:"任务ID",width:"120"},{default:a(({row:l})=>[e(P,{size:"small",type:"primary",effect:"plain"},{default:a(()=>[c(_(l.job_id),1)]),_:2},1024)]),_:1}),e(u,{prop:"project_name",label:"项目名"}),e(u,{prop:"job_name",label:"任务名"}),e(u,{prop:"user",label:"用户"}),e(u,{prop:"job_type",label:"任务类型","min-width":"140"},{default:a(({row:l})=>[e(P,{size:"small",type:M(l.job_type),effect:"light",class:q(`job-type-${l.job_type}`)},{default:a(()=>[c(_(K(l.job_type)),1)]),_:2},1032,["type","class"])]),_:1}),e(u,{label:"状态",width:"100"},{default:a(()=>t[16]||(t[16]=[o("div",{class:"status-indicator pending"},[o("div",{class:"status-dot"}),o("span",null,"等待中")],-1)])),_:1})]),_:1},8,["data","show-header"])])])])]),_:1},8,["modelValue"])])}}}),rt=se(nt,[["__scopeId","data-v-d86105e9"]]),it={class:"main-layout"},dt={class:"main-content"},ut=ae({__name:"MainLayout",setup(oe){return($,V)=>{const R=p("router-view");return S(),k("div",it,[e(rt),o("div",dt,[e(R)])])}}}),gt=se(ut,[["__scopeId","data-v-f2df2166"]]);export{gt as default};
//# sourceMappingURL=MainLayout-D_w8oggt.js.map
