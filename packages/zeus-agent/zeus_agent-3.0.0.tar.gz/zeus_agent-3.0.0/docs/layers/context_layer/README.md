# ğŸ§© æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚ (Intelligent Context Layer)

## ğŸ“‹ æ¦‚è¿°

æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚æ˜¯Agent Development Centeræ¶æ„çš„ç¬¬4å±‚ï¼Œè´Ÿè´£æ™ºèƒ½ä¸Šä¸‹æ–‡ä¸çŸ¥è¯†ç®¡ç†ã€‚è¿™ä¸€å±‚å®ç°äº†å…­å±‚ä¸Šä¸‹æ–‡æ¨¡å‹ï¼ŒåŒ…æ‹¬RAGç³»ç»Ÿã€çŸ¥è¯†ç®¡ç†ã€è´¨é‡æ§åˆ¶ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. ä¸Šä¸‹æ–‡å·¥ç¨‹ (Context Engineering)
- **å…­å±‚ä¸Šä¸‹æ–‡æ¨¡å‹** - ä»åŸºç¡€åˆ°é«˜çº§çš„å®Œæ•´ä¸Šä¸‹æ–‡æ¶æ„
- **åŠ¨æ€ä¸Šä¸‹æ–‡ç»„è£…** - æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€ç»„è£…ä¸Šä¸‹æ–‡
- **ä¸Šä¸‹æ–‡ä¼˜åŒ–** - æ™ºèƒ½çš„ä¸Šä¸‹æ–‡è´¨é‡ä¼˜åŒ–
- **ä¸Šä¸‹æ–‡åå•†** - æ”¯æŒAgenté—´çš„ä¸Šä¸‹æ–‡åå•†

### 2. RAGç³»ç»Ÿ (Retrieval-Augmented Generation)
- **æ¨¡å—åŒ–æ£€ç´¢** - æ”¯æŒå¤šç§æ£€ç´¢ç­–ç•¥å’Œç®—æ³•
- **å¢å¼ºç”Ÿæˆ** - åŸºäºæ£€ç´¢ç»“æœçš„æ™ºèƒ½å†…å®¹ç”Ÿæˆ
- **å¤šæ¨¡æ€æ”¯æŒ** - æ”¯æŒæ–‡æœ¬ã€å›¾åƒç­‰å¤šç§æ¨¡æ€
- **åä½œæ£€ç´¢** - å¤šAgentåä½œçš„æ£€ç´¢å¢å¼º

### 3. çŸ¥è¯†ç®¡ç† (Knowledge Management)
- **äº”å±‚è®°å¿†æ¶æ„** - ä»çŸ­æœŸåˆ°é•¿æœŸçš„å®Œæ•´è®°å¿†ä½“ç³»
- **çŸ¥è¯†å›¾è°±** - ç»“æ„åŒ–çš„çŸ¥è¯†è¡¨ç¤ºå’Œç®¡ç†
- **çŸ¥è¯†æ›´æ–°** - æ”¯æŒçŸ¥è¯†çš„æŒç»­æ›´æ–°å’Œæ¼”åŒ–
- **çŸ¥è¯†å…±äº«** - Agenté—´çŸ¥è¯†çš„åä½œå…±äº«

### 4. è´¨é‡æ§åˆ¶ (Quality Control)
- **å…­ç»´è´¨é‡è¯„ä¼°** - å…¨é¢çš„è´¨é‡è¯„ä¼°ä½“ç³»
- **è´¨é‡ç›‘æ§** - å®æ—¶çš„è´¨é‡ç›‘æ§å’Œé¢„è­¦
- **è´¨é‡ä¼˜åŒ–** - è‡ªåŠ¨çš„è´¨é‡ä¼˜åŒ–å’Œæå‡
- **åä½œè´¨é‡** - å¤šAgentåä½œçš„è´¨é‡ä¿è¯

## ğŸ“š æ–‡æ¡£ç»“æ„

### æ ¸å¿ƒæ–‡æ¡£
- **[README.md](./README.md)** - æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚æ€»è§ˆ (å½“å‰æ–‡æ¡£)
- **[context_layer.md](./context_layer.md)** - æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚æ•´ä½“è®¾è®¡

### ä¸Šä¸‹æ–‡å·¥ç¨‹æ–‡æ¡£
- **[conversation_history.md](./conversation_history.md)** - å¯¹è¯å†å²ç®¡ç†
- **[knowledge_graph.md](./knowledge_graph.md)** - çŸ¥è¯†å›¾è°±è®¾è®¡

### RAGç³»ç»Ÿæ–‡æ¡£
- **[rag_system.md](./rag_system.md)** - RAGç³»ç»Ÿè¯¦ç»†è®¾è®¡
- **[memory_system.md](./memory_system.md)** - è®°å¿†ç³»ç»Ÿè®¾è®¡

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### ä¸Šä¸‹æ–‡æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚ (Context Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Context     â”‚ RAG         â”‚ Knowledge â”‚ Quality    â”‚ A2A     â”‚
â”‚ Engineering â”‚ System      â”‚ Managementâ”‚ Control    â”‚ Support â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ æ™ºèƒ½ä¸Šä¸‹æ–‡ä¸çŸ¥è¯†ç®¡ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è®¤çŸ¥æ¶æ„å±‚ (Cognitive Layer)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶
- **ContextEngine** - ä¸Šä¸‹æ–‡å¼•æ“
- **RAGSystem** - RAGç³»ç»Ÿ
- **KnowledgeManager** - çŸ¥è¯†ç®¡ç†å™¨
- **QualityController** - è´¨é‡æ§åˆ¶å™¨
- **ContextOrchestrator** - ä¸Šä¸‹æ–‡ç¼–æ’å™¨

## ğŸ“Š å®ç°çŠ¶æ€

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ | ç‰¹æ€§æ”¯æŒ |
|----------|------|--------|----------|
| **ä¸Šä¸‹æ–‡å·¥ç¨‹** | âœ… å®Œæˆ | 80% | å…­å±‚ä¸Šä¸‹æ–‡æ¨¡å‹ |
| **RAGç³»ç»Ÿ** | âœ… å®Œæˆ | 80% | æ¨¡å—åŒ–æ£€ç´¢å¢å¼º |
| **çŸ¥è¯†ç®¡ç†** | âœ… å®Œæˆ | 85% | äº”å±‚è®°å¿†æ¶æ„ |
| **è´¨é‡æ§åˆ¶** | âœ… å®Œæˆ | 75% | å…­ç»´è´¨é‡è¯„ä¼° |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸Šä¸‹æ–‡ç®¡ç†ç¤ºä¾‹
```python
from layers.intelligent_context.context_engineering import ContextEngine

# åˆ›å»ºä¸Šä¸‹æ–‡å¼•æ“
context_engine = ContextEngine()

# ç»„è£…ä¸Šä¸‹æ–‡
context = await context_engine.assemble_context(
    task_requirements,
    user_preferences,
    available_knowledge
)

# ä¼˜åŒ–ä¸Šä¸‹æ–‡
optimized_context = await context_engine.optimize_context(context)
```

### 2. RAGç³»ç»Ÿç¤ºä¾‹
```python
from layers.intelligent_context.rag_system import RAGSystem

# åˆ›å»ºRAGç³»ç»Ÿ
rag_system = RAGSystem()

# æ£€ç´¢ç›¸å…³ä¿¡æ¯
retrieved_info = await rag_system.retrieve(query, context)

# ç”Ÿæˆå¢å¼ºå†…å®¹
enhanced_content = await rag_system.generate(
    query, 
    retrieved_info, 
    context
)
```

### 3. çŸ¥è¯†ç®¡ç†ç¤ºä¾‹
```python
from layers.intelligent_context.knowledge_management import KnowledgeManager

# åˆ›å»ºçŸ¥è¯†ç®¡ç†å™¨
knowledge_manager = KnowledgeManager()

# å­˜å‚¨çŸ¥è¯†
await knowledge_manager.store_knowledge(
    "domain_knowledge",
    knowledge_content,
    metadata
)

# æ£€ç´¢çŸ¥è¯†
knowledge = await knowledge_manager.retrieve_knowledge(
    "domain_knowledge",
    query
)
```

## ğŸ”— ç›¸å…³é“¾æ¥

### æ¶æ„æ–‡æ¡£
- [ä¸»æ¶æ„æ–‡æ¡£](../ARCHITECTURE_DESIGN.md)
- [è®¤çŸ¥æ¶æ„å±‚](../cognitive_architecture_layer/)
- [æ¡†æ¶æŠ½è±¡å±‚](../framework_abstraction_layer/)

### æŠ€æœ¯æ–‡æ¡£
- [APIæ¥å£æ–‡æ¡£](../layers/intelligent_context/)
- [ç¤ºä¾‹ä»£ç ](../examples/intelligent_context_demo.py)
- [æµ‹è¯•ç”¨ä¾‹](../tests/unit/intelligent_context/)

### æ¼”ç¤ºç¤ºä¾‹
- [æ™ºèƒ½ä¸Šä¸‹æ–‡æ¼”ç¤º](../examples/intelligent_context_demo.py)
- [RAGç³»ç»Ÿæ¼”ç¤º](../examples/rag_demo.py)
- [çŸ¥è¯†ç®¡ç†æ¼”ç¤º](../examples/knowledge_demo.py)

## ğŸ“ˆ å‘å±•è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2ä¸ªæœˆ)
- [ ] å®Œå–„ä¸Šä¸‹æ–‡ä¼˜åŒ–ç®—æ³•
- [ ] å¢å¼ºRAGç³»ç»Ÿçš„æ£€ç´¢ç²¾åº¦
- [ ] ä¼˜åŒ–çŸ¥è¯†å›¾è°±çš„æ€§èƒ½

### ä¸­æœŸç›®æ ‡ (3-6ä¸ªæœˆ)
- [ ] å®ç°è‡ªé€‚åº”ä¸Šä¸‹æ–‡ç»„è£…
- [ ] æ·»åŠ å¤šæ¨¡æ€RAGæ”¯æŒ
- [ ] å»ºç«‹çŸ¥è¯†æ¼”åŒ–æœºåˆ¶

### é•¿æœŸç›®æ ‡ (6-12ä¸ªæœˆ)
- [ ] å®ç°ç±»äººä¸Šä¸‹æ–‡ç†è§£
- [ ] æ”¯æŒè·¨é¢†åŸŸçŸ¥è¯†è¿ç§»
- [ ] å»ºç«‹ä¸Šä¸‹æ–‡è´¨é‡åŸºå‡†

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é€‰æ‹©åˆé€‚çš„ä¸Šä¸‹æ–‡å±‚çº§ï¼Ÿ
A: æ ¹æ®ä»»åŠ¡å¤æ‚åº¦ã€å¯ç”¨ä¿¡æ¯ã€æ—¶é—´è¦æ±‚ç­‰å› ç´ ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ä¸Šä¸‹æ–‡å±‚çº§ã€‚

### Q: RAGç³»ç»Ÿçš„æ£€ç´¢ç²¾åº¦å¦‚ä½•ä¿è¯ï¼Ÿ
A: é‡‡ç”¨å¤šç§æ£€ç´¢ç­–ç•¥çš„ç»„åˆï¼Œæ”¯æŒæ£€ç´¢ç»“æœçš„é‡æ–°æ’åºå’Œè¿‡æ»¤ï¼Œç¡®ä¿æ£€ç´¢ç²¾åº¦ã€‚

### Q: çŸ¥è¯†ç®¡ç†å¦‚ä½•é¿å…çŸ¥è¯†å†²çªï¼Ÿ
A: é‡‡ç”¨ç‰ˆæœ¬æ§åˆ¶å’Œå†²çªæ£€æµ‹æœºåˆ¶ï¼Œæ”¯æŒçŸ¥è¯†çš„åˆå¹¶å’Œå†²çªè§£å†³ã€‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç»´æŠ¤å›¢é˜Ÿ
- **æ™ºèƒ½ä¸Šä¸‹æ–‡å¼€å‘**: Intelligent Context Team
- **RAGç³»ç»Ÿ**: RAG System Team
- **çŸ¥è¯†ç®¡ç†**: Knowledge Management Team
- **è´¨é‡æ§åˆ¶**: Quality Control Team

### åé¦ˆæ¸ é“
- **é—®é¢˜æŠ¥å‘Š**: é€šè¿‡GitHub Issues
- **åŠŸèƒ½å»ºè®®**: é€šè¿‡é¡¹ç›®è®¨è®ºåŒº
- **æŠ€æœ¯å’¨è¯¢**: é€šè¿‡å¼€å‘å›¢é˜Ÿ

---

## ğŸ“‹ æ–‡æ¡£ç»´æŠ¤

### æ›´æ–°é¢‘ç‡
- **æ ¸å¿ƒåŠŸèƒ½**: æ¯æœˆæ›´æ–°
- **æ–°ç‰¹æ€§**: åŠŸèƒ½å®Œæˆæ—¶æ›´æ–°
- **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–å®Œæˆæ—¶æ›´æ–°

### ç‰ˆæœ¬å†å²
| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ | ç»´æŠ¤äºº |
|------|------|----------|--------|
| v2.0 | 2025-08-23 | ç»Ÿä¸€æ–‡æ¡£æ ¼å¼ï¼Œå®Œå–„å¯¼èˆª | Documentation Team |
| v1.5 | 2025-08-15 | å®Œå–„RAGç³»ç»ŸåŠŸèƒ½ | Context Team |
| v1.0 | 2025-07-01 | åˆå§‹ç‰ˆæœ¬å‘å¸ƒ | Development Team |

---

*æœ€åæ›´æ–°: 2025å¹´8æœˆ23æ—¥*
*ç»´æŠ¤å›¢é˜Ÿ: Agent Development Center Intelligent Context Team*
*æ–‡æ¡£ç‰ˆæœ¬: v2.0*
```python
class ContextManager:
    def __init__(self, config=None):
        """åˆå§‹åŒ–ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""
        pass
        
    def create_context(self, context_id=None, metadata=None):
        """åˆ›å»ºæ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ"""
        pass
        
    def get_context(self, context_id):
        """è·å–æŒ‡å®šIDçš„ä¸Šä¸‹æ–‡"""
        pass
        
    def update_context(self, context_id, data):
        """æ›´æ–°æŒ‡å®šä¸Šä¸‹æ–‡çš„å†…å®¹"""
        pass
        
    def merge_contexts(self, source_ids, target_id=None):
        """åˆå¹¶å¤šä¸ªä¸Šä¸‹æ–‡"""
        pass
        
    def delete_context(self, context_id):
        """åˆ é™¤æŒ‡å®šçš„ä¸Šä¸‹æ–‡"""
        pass
        
    def compress_context(self, context_id, strategy=None):
        """å‹ç¼©æŒ‡å®šçš„ä¸Šä¸‹æ–‡"""
        pass
        
    def get_relevant_knowledge(self, context_id, query, limit=5):
        """åŸºäºå½“å‰ä¸Šä¸‹æ–‡å’ŒæŸ¥è¯¢è·å–ç›¸å…³çŸ¥è¯†"""
        pass
```

### 4.2 ConversationHistoryManageræ¥å£

```python
class ConversationHistoryManager:
    def __init__(self, storage_provider=None):
        """åˆå§‹åŒ–å¯¹è¯å†å²ç®¡ç†å™¨"""
        pass
        
    def add_message(self, conversation_id, message):
        """æ·»åŠ æ–°æ¶ˆæ¯åˆ°å¯¹è¯å†å²"""
        pass
        
    def get_messages(self, conversation_id, limit=None, filter_criteria=None):
        """è·å–å¯¹è¯å†å²æ¶ˆæ¯"""
        pass
        
    def search_messages(self, conversation_id, query, limit=10):
        """æœç´¢å¯¹è¯å†å²ä¸­çš„ç›¸å…³æ¶ˆæ¯"""
        pass
        
    def summarize_conversation(self, conversation_id, max_length=None):
        """ç”Ÿæˆå¯¹è¯å†å²çš„æ‘˜è¦"""
        pass
        
    def delete_conversation(self, conversation_id):
        """åˆ é™¤æŒ‡å®šçš„å¯¹è¯å†å²"""
        pass
```

### 4.3 MemorySystemæ¥å£

```python
class MemorySystem:
    def __init__(self, memory_providers=None):
        """åˆå§‹åŒ–è®°å¿†ç³»ç»Ÿ"""
        pass
        
    def store(self, memory_type, data, metadata=None):
        """å­˜å‚¨è®°å¿†"""
        pass
        
    def retrieve(self, memory_type, query, limit=10, filter_criteria=None):
        """æ£€ç´¢è®°å¿†"""
        pass
        
    def update(self, memory_id, data):
        """æ›´æ–°è®°å¿†"""
        pass
        
    def forget(self, memory_id=None, filter_criteria=None):
        """é—å¿˜è®°å¿†"""
        pass
        
    def get_memory_by_id(self, memory_id):
        """é€šè¿‡IDè·å–è®°å¿†"""
        pass
        
    def get_memory_types(self):
        """è·å–æ”¯æŒçš„è®°å¿†ç±»å‹"""
        pass
```

### 4.4 KnowledgeConnectoræ¥å£

```python
class KnowledgeConnector:
    def __init__(self, connector_type, config=None):
        """åˆå§‹åŒ–çŸ¥è¯†åº“è¿æ¥å™¨"""
        pass
        
    def connect(self):
        """è¿æ¥åˆ°çŸ¥è¯†åº“"""
        pass
        
    def disconnect(self):
        """æ–­å¼€ä¸çŸ¥è¯†åº“çš„è¿æ¥"""
        pass
        
    def store_document(self, document, metadata=None):
        """å­˜å‚¨æ–‡æ¡£åˆ°çŸ¥è¯†åº“"""
        pass
        
    def retrieve_documents(self, query, limit=10, filter_criteria=None):
        """ä»çŸ¥è¯†åº“æ£€ç´¢æ–‡æ¡£"""
        pass
        
    def delete_document(self, document_id):
        """ä»çŸ¥è¯†åº“åˆ é™¤æ–‡æ¡£"""
        pass
        
    def update_document(self, document_id, document, metadata=None):
        """æ›´æ–°çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£"""
        pass
        
    def get_connector_info(self):
        """è·å–è¿æ¥å™¨ä¿¡æ¯"""
        pass
```

### 4.5 RetrievalEngineæ¥å£

```python
class RetrievalEngine:
    def __init__(self, knowledge_sources=None, config=None):
        """åˆå§‹åŒ–æ£€ç´¢å¼•æ“"""
        pass
        
    def add_knowledge_source(self, source):
        """æ·»åŠ çŸ¥è¯†æº"""
        pass
        
    def remove_knowledge_source(self, source_id):
        """ç§»é™¤çŸ¥è¯†æº"""
        pass
        
    def retrieve(self, query, limit=10, sources=None, strategy=None):
        """æ‰§è¡Œæ£€ç´¢"""
        pass
        
    def hybrid_retrieve(self, query, limit=10, keyword_weight=0.3, semantic_weight=0.7):
        """æ‰§è¡Œæ··åˆæ£€ç´¢ï¼ˆå…³é”®è¯+è¯­ä¹‰ï¼‰"""
        pass
        
    def rank_results(self, results, query, ranking_method=None):
        """å¯¹æ£€ç´¢ç»“æœè¿›è¡Œæ’åº"""
        pass
        
    def get_available_strategies(self):
        """è·å–å¯ç”¨çš„æ£€ç´¢ç­–ç•¥"""
        pass
```

### 4.6 ContextCompressoræ¥å£

```python
class ContextCompressor:
    def __init__(self, compression_strategies=None):
        """åˆå§‹åŒ–ä¸Šä¸‹æ–‡å‹ç¼©å™¨"""
        pass
        
    def compress(self, context, max_tokens=None, strategy=None):
        """å‹ç¼©ä¸Šä¸‹æ–‡"""
        pass
        
    def summarize(self, messages, max_length=None):
        """ç”Ÿæˆæ¶ˆæ¯çš„æ‘˜è¦"""
        pass
        
    def extract_key_information(self, context):
        """ä»ä¸Šä¸‹æ–‡ä¸­æå–å…³é”®ä¿¡æ¯"""
        pass
        
    def optimize_structure(self, context, target_model=None):
        """ä¼˜åŒ–ä¸Šä¸‹æ–‡ç»“æ„ä»¥é€‚åº”ç›®æ ‡æ¨¡å‹"""
        pass
        
    def add_compression_strategy(self, strategy):
        """æ·»åŠ å‹ç¼©ç­–ç•¥"""
        pass
        
    def get_available_strategies(self):
        """è·å–å¯ç”¨çš„å‹ç¼©ç­–ç•¥"""
        pass
```

## 5. å®ç°ç¤ºä¾‹

### 5.1 åŸºäºå‘é‡æ•°æ®åº“çš„é•¿æœŸè®°å¿†å®ç°

```python
class VectorDBMemory:
    def __init__(self, vector_db_connector, embedding_model):
        self.vector_db = vector_db_connector
        self.embedding_model = embedding_model
        
    def store(self, text, metadata=None):
        # ç”Ÿæˆæ–‡æœ¬çš„åµŒå…¥å‘é‡
        embedding = self.embedding_model.embed(text)
        
        # å‡†å¤‡å­˜å‚¨æ•°æ®
        data = {
            "text": text,
            "embedding": embedding,
            "timestamp": datetime.now().isoformat(),
            "metadata": metadata or {}
        }
        
        # å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“
        return self.vector_db.insert(data)
        
    def retrieve(self, query, limit=5, filter_criteria=None):
        # ç”ŸæˆæŸ¥è¯¢çš„åµŒå…¥å‘é‡
        query_embedding = self.embedding_model.embed(query)
        
        # æ‰§è¡Œå‘é‡ç›¸ä¼¼åº¦æœç´¢
        results = self.vector_db.search(
            query_embedding, 
            limit=limit,
            filter=filter_criteria
        )
        
        return results
        
    def forget(self, memory_id=None, filter_criteria=None):
        if memory_id:
            return self.vector_db.delete(memory_id)
        elif filter_criteria:
            return self.vector_db.delete_many(filter_criteria)
        return False
```

### 5.2 å¯¹è¯å†å²æ‘˜è¦ç”Ÿæˆå®ç°

```python
class ConversationSummarizer:
    def __init__(self, llm_service):
        self.llm = llm_service
        
    def summarize(self, messages, max_tokens=100):
        # å‡†å¤‡æç¤ºæ¨¡æ¿
        prompt = f"""è¯·æ€»ç»“ä»¥ä¸‹å¯¹è¯ï¼Œçªå‡ºå…³é”®ä¿¡æ¯å’Œä¸»è¦è®¨è®ºç‚¹ã€‚æ‘˜è¦ä¸åº”è¶…è¿‡{max_tokens}ä¸ªtokenã€‚

å¯¹è¯å†…å®¹ï¼š
{self._format_messages(messages)}

æ‘˜è¦ï¼š"""
        
        # è°ƒç”¨LLMç”Ÿæˆæ‘˜è¦
        summary = self.llm.generate(prompt, max_tokens=max_tokens)
        return summary.strip()
        
    def _format_messages(self, messages):
        formatted = []
        for msg in messages:
            role = msg.get("role", "unknown")
            content = msg.get("content", "")
            formatted.append(f"{role}: {content}")
        return "\n".join(formatted)
        
    def progressive_summarize(self, existing_summary, new_messages, max_tokens=100):
        # å‡†å¤‡æç¤ºæ¨¡æ¿
        prompt = f"""ä»¥ä¸‹æ˜¯ä¹‹å‰å¯¹è¯çš„æ‘˜è¦ï¼Œä»¥åŠæ–°çš„å¯¹è¯æ¶ˆæ¯ã€‚è¯·æ›´æ–°æ‘˜è¦ä»¥åŒ…å«æ–°ä¿¡æ¯ï¼Œä¿æŒæ‘˜è¦ç®€æ´ä¸”ä¸è¶…è¿‡{max_tokens}ä¸ªtokenã€‚

ç°æœ‰æ‘˜è¦ï¼š
{existing_summary}

æ–°æ¶ˆæ¯ï¼š
{self._format_messages(new_messages)}

æ›´æ–°åçš„æ‘˜è¦ï¼š"""
        
        # è°ƒç”¨LLMæ›´æ–°æ‘˜è¦
        updated_summary = self.llm.generate(prompt, max_tokens=max_tokens)
        return updated_summary.strip()
```

### 5.3 æ··åˆæ£€ç´¢ç­–ç•¥å®ç°

```python
class HybridRetrievalEngine:
    def __init__(self, semantic_engine, keyword_engine):
        self.semantic_engine = semantic_engine
        self.keyword_engine = keyword_engine
        
    def retrieve(self, query, limit=10, semantic_weight=0.7, keyword_weight=0.3):
        # æ‰§è¡Œè¯­ä¹‰æ£€ç´¢
        semantic_results = self.semantic_engine.retrieve(query, limit=limit*2)
        
        # æ‰§è¡Œå…³é”®è¯æ£€ç´¢
        keyword_results = self.keyword_engine.retrieve(query, limit=limit*2)
        
        # åˆå¹¶ç»“æœå¹¶è®¡ç®—ç»¼åˆå¾—åˆ†
        combined_results = {}
        
        # å¤„ç†è¯­ä¹‰æ£€ç´¢ç»“æœ
        for result in semantic_results:
            doc_id = result["id"]
            score = result["score"] * semantic_weight
            combined_results[doc_id] = {
                "document": result["document"],
                "score": score,
                "metadata": result.get("metadata", {})
            }
        
        # å¤„ç†å…³é”®è¯æ£€ç´¢ç»“æœ
        for result in keyword_results:
            doc_id = result["id"]
            if doc_id in combined_results:
                # å¦‚æœæ–‡æ¡£å·²å­˜åœ¨ï¼Œæ›´æ–°å¾—åˆ†
                combined_results[doc_id]["score"] += result["score"] * keyword_weight
            else:
                # æ·»åŠ æ–°æ–‡æ¡£
                combined_results[doc_id] = {
                    "document": result["document"],
                    "score": result["score"] * keyword_weight,
                    "metadata": result.get("metadata", {})
                }
        
        # æ’åºå¹¶é™åˆ¶ç»“æœæ•°é‡
        sorted_results = sorted(
            combined_results.values(),
            key=lambda x: x["score"],
            reverse=True
        )[:limit]
        
        return sorted_results
```

## 6. ä¸Šä¸‹æ–‡å¤„ç†æµç¨‹

### 6.1 åŸºæœ¬æµç¨‹

1. **ä¸Šä¸‹æ–‡åˆå§‹åŒ–**ï¼šåˆ›å»ºæ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œåˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

2. **æ¶ˆæ¯å¤„ç†**ï¼š
   - æ¥æ”¶æ–°æ¶ˆæ¯
   - å°†æ¶ˆæ¯æ·»åŠ åˆ°å¯¹è¯å†å²
   - æ›´æ–°ä¸Šä¸‹æ–‡çŠ¶æ€

3. **ä¸Šä¸‹æ–‡å¢å¼º**ï¼š
   - åˆ†æå½“å‰æ¶ˆæ¯å’Œä¸Šä¸‹æ–‡
   - ç¡®å®šéœ€è¦æ£€ç´¢çš„ä¿¡æ¯ç±»å‹
   - ä»è®°å¿†ç³»ç»Ÿå’ŒçŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯
   - å°†æ£€ç´¢åˆ°çš„ä¿¡æ¯æ•´åˆåˆ°ä¸Šä¸‹æ–‡ä¸­

4. **ä¸Šä¸‹æ–‡å‹ç¼©**ï¼š
   - è¯„ä¼°å½“å‰ä¸Šä¸‹æ–‡å¤§å°
   - å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œåº”ç”¨å‹ç¼©ç­–ç•¥
   - ç”Ÿæˆå¯¹è¯å†å²æ‘˜è¦
   - ä¿ç•™å…³é”®ä¿¡æ¯

5. **ä¸Šä¸‹æ–‡ä¼ é€’**ï¼š
   - å°†å¤„ç†åçš„ä¸Šä¸‹æ–‡ä¼ é€’ç»™è®¤çŸ¥æ¶æ„å±‚æˆ–ä¸šåŠ¡èƒ½åŠ›å±‚
   - æ¥æ”¶å¤„ç†ç»“æœ
   - æ›´æ–°ä¸Šä¸‹æ–‡çŠ¶æ€

### 6.2 RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æµç¨‹

1. **æŸ¥è¯¢åˆ†æ**ï¼š
   - åˆ†æç”¨æˆ·æŸ¥è¯¢
   - æå–å…³é”®æ¦‚å¿µå’Œå®ä½“
   - ç¡®å®šæ£€ç´¢ç­–ç•¥

2. **çŸ¥è¯†æ£€ç´¢**ï¼š
   - ä»å¤šä¸ªçŸ¥è¯†æºæ‰§è¡Œå¹¶è¡Œæ£€ç´¢
   - åº”ç”¨æ··åˆæ£€ç´¢ç­–ç•¥
   - å¯¹æ£€ç´¢ç»“æœè¿›è¡Œæ’åºå’Œè¿‡æ»¤

3. **ä¸Šä¸‹æ–‡æ„å»º**ï¼š
   - å°†æ£€ç´¢åˆ°çš„çŸ¥è¯†ä¸å½“å‰ä¸Šä¸‹æ–‡æ•´åˆ
   - åº”ç”¨ä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥
   - æ„å»ºç»“æ„åŒ–æç¤º

4. **ç”Ÿæˆä¸éªŒè¯**ï¼š
   - å°†å¢å¼ºçš„ä¸Šä¸‹æ–‡ä¼ é€’ç»™ç”Ÿæˆæ¨¡å‹
   - æ¥æ”¶ç”Ÿæˆç»“æœ
   - éªŒè¯ç”Ÿæˆå†…å®¹ä¸æ£€ç´¢çŸ¥è¯†çš„ä¸€è‡´æ€§
   - å¿…è¦æ—¶æ‰§è¡Œåå¤„ç†

## 7. æ€§èƒ½è€ƒè™‘

### 7.1 ä¼˜åŒ–ç­–ç•¥

1. **ç¼“å­˜æœºåˆ¶**ï¼š
   - å®ç°å¤šçº§ç¼“å­˜ï¼ˆå†…å­˜ã€æœ¬åœ°å­˜å‚¨ã€åˆ†å¸ƒå¼ç¼“å­˜ï¼‰
   - ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢å’Œæ£€ç´¢ç»“æœ
   - å®ç°LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç­–ç•¥ç®¡ç†ç¼“å­˜

2. **å¼‚æ­¥å¤„ç†**ï¼š
   - éé˜»å¡å¼çŸ¥è¯†æ£€ç´¢
   - åå°è®°å¿†æ›´æ–°å’Œæ•´åˆ
   - é¢„æµ‹æ€§çŸ¥è¯†é¢„åŠ è½½

3. **åˆ†å¸ƒå¼æ¶æ„**ï¼š
   - æ°´å¹³æ‰©å±•çŸ¥è¯†åº“å’Œè®°å¿†å­˜å‚¨
   - è´Ÿè½½å‡è¡¡æ£€ç´¢è¯·æ±‚
   - åˆ†ç‰‡å­˜å‚¨å¤§è§„æ¨¡å‘é‡æ•°æ®

4. **æ‰¹å¤„ç†**ï¼š
   - æ‰¹é‡åµŒå…¥ç”Ÿæˆ
   - æ‰¹é‡çŸ¥è¯†åº“æ›´æ–°
   - æ‰¹é‡è®°å¿†æ£€ç´¢

5. **ç´¢å¼•ä¼˜åŒ–**ï¼š
   - ä¼˜åŒ–å‘é‡ç´¢å¼•ç»“æ„ï¼ˆå¦‚HNSWã€IVFç­‰ï¼‰
   - å®ç°æ··åˆç´¢å¼•ï¼ˆå‘é‡+å…³é”®è¯ï¼‰
   - å®šæœŸé‡å»ºå’Œä¼˜åŒ–ç´¢å¼•

### 7.2 æ€§èƒ½æŒ‡æ ‡

1. **å»¶è¿ŸæŒ‡æ ‡**ï¼š
   - å¹³å‡æ£€ç´¢æ—¶é—´
   - ä¸Šä¸‹æ–‡å¤„ç†æ—¶é—´
   - ç«¯åˆ°ç«¯å“åº”æ—¶é—´

2. **ååé‡æŒ‡æ ‡**ï¼š
   - æ¯ç§’æ£€ç´¢è¯·æ±‚æ•°
   - æ¯ç§’å¤„ç†æ¶ˆæ¯æ•°
   - æ¯ç§’ä¸Šä¸‹æ–‡æ›´æ–°æ•°

3. **è´¨é‡æŒ‡æ ‡**ï¼š
   - æ£€ç´¢å‡†ç¡®ç‡å’Œå¬å›ç‡
   - ä¸Šä¸‹æ–‡ç›¸å…³æ€§å¾—åˆ†
   - å‹ç¼©åä¿¡æ¯ä¿ç•™ç‡

4. **èµ„æºä½¿ç”¨æŒ‡æ ‡**ï¼š
   - å†…å­˜ä½¿ç”¨é‡
   - å­˜å‚¨ç©ºé—´ä½¿ç”¨é‡
   - CPUå’ŒGPUåˆ©ç”¨ç‡

## 8. æ‰©å±•ç‚¹

### 8.1 è‡ªå®šä¹‰è®°å¿†æä¾›è€…

æ¡†æ¶æ”¯æŒé€šè¿‡å®ç°MemoryProvideræ¥å£æ¥é›†æˆè‡ªå®šä¹‰çš„è®°å¿†å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼š

```python
class CustomMemoryProvider(MemoryProvider):
    def __init__(self, config):
        super().__init__()
        # åˆå§‹åŒ–è‡ªå®šä¹‰å­˜å‚¨
        
    def store(self, data, metadata=None):
        # å®ç°å­˜å‚¨é€»è¾‘
        pass
        
    def retrieve(self, query, limit=10, filter_criteria=None):
        # å®ç°æ£€ç´¢é€»è¾‘
        pass
        
    def delete(self, memory_id=None, filter_criteria=None):
        # å®ç°åˆ é™¤é€»è¾‘
        pass
```

### 8.2 è‡ªå®šä¹‰çŸ¥è¯†åº“è¿æ¥å™¨

é€šè¿‡å®ç°KnowledgeConnectoræ¥å£ï¼Œå¯ä»¥é›†æˆå„ç§çŸ¥è¯†åº“ï¼š

```python
class CustomKnowledgeConnector(KnowledgeConnector):
    def __init__(self, config):
        super().__init__("custom", config)
        # åˆå§‹åŒ–è¿æ¥å™¨
        
    def connect(self):
        # å®ç°è¿æ¥é€»è¾‘
        pass
        
    def store_document(self, document, metadata=None):
        # å®ç°æ–‡æ¡£å­˜å‚¨é€»è¾‘
        pass
        
    def retrieve_documents(self, query, limit=10, filter_criteria=None):
        # å®ç°æ–‡æ¡£æ£€ç´¢é€»è¾‘
        pass
```

### 8.3 è‡ªå®šä¹‰å‹ç¼©ç­–ç•¥

é€šè¿‡å®ç°CompressionStrategyæ¥å£ï¼Œå¯ä»¥å®šä¹‰è‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥ï¼š

```python
class CustomCompressionStrategy(CompressionStrategy):
    def __init__(self, config=None):
        super().__init__("custom_strategy")
        self.config = config or {}
        
    def compress(self, context, max_tokens=None):
        # å®ç°è‡ªå®šä¹‰å‹ç¼©é€»è¾‘
        compressed_context = self._apply_compression(context)
        return compressed_context
        
    def _apply_compression(self, context):
        # å…·ä½“çš„å‹ç¼©ç®—æ³•å®ç°
        pass
```

## 9. ä¸å…¶ä»–å±‚çš„é›†æˆ

### 9.1 ä¸æ¡†æ¶æŠ½è±¡å±‚çš„é›†æˆ

æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚é€šè¿‡æ¡†æ¶æŠ½è±¡å±‚å®šä¹‰çš„æ ‡å‡†æ¥å£ï¼ˆå¦‚ContextInterfaceå’ŒMemoryInterfaceï¼‰ä¸åº•å±‚æ¡†æ¶äº¤äº’ï¼Œç¡®ä¿ä¸Šä¸‹æ–‡ç®¡ç†çš„ä¸€è‡´æ€§å’Œå¯ç§»æ¤æ€§ã€‚

### 9.2 ä¸è®¤çŸ¥æ¶æ„å±‚çš„é›†æˆ

æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚ä¸ºè®¤çŸ¥æ¶æ„å±‚æä¾›ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯å’ŒçŸ¥è¯†æ”¯æŒï¼Œä½¿è®¤çŸ¥æ¨¡å—èƒ½å¤ŸåŸºäºå®Œæ•´çš„ä¸Šä¸‹æ–‡åšå‡ºå†³ç­–å’Œæ¨ç†ã€‚

### 9.3 ä¸ä¸šåŠ¡èƒ½åŠ›å±‚çš„é›†æˆ

æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚ä¸ºä¸šåŠ¡èƒ½åŠ›å±‚æä¾›ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†å’Œä¸Šä¸‹æ–‡æ”¯æŒï¼Œä½¿ä¸šåŠ¡åŠŸèƒ½èƒ½å¤Ÿè®¿é—®å’Œåˆ©ç”¨ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

## 10. æ€»ç»“

æ™ºèƒ½ä¸Šä¸‹æ–‡å±‚æ˜¯ç»Ÿä¸€Agentæ¡†æ¶ä¸­çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œå®ƒé€šè¿‡æä¾›ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ç®¡ç†ã€è®°å¿†ç³»ç»Ÿå’ŒçŸ¥è¯†æ£€ç´¢èƒ½åŠ›ï¼Œä½¿Agentèƒ½å¤Ÿç†è§£å¤æ‚çš„äº¤äº’å†å²ã€ç»´æŠ¤é•¿æœŸè®°å¿†ã€æ•´åˆå¤–éƒ¨çŸ¥è¯†ï¼Œå¹¶åŸºäºè¿™äº›ä¿¡æ¯åšå‡ºæ›´æ™ºèƒ½çš„å†³ç­–ã€‚

è¯¥å±‚çš„è®¾è®¡éµå¾ªæ¨¡å—åŒ–ã€å¯æ‰©å±•å’Œé«˜æ€§èƒ½çš„åŸåˆ™ï¼Œæ”¯æŒå¤šç§è®°å¿†ç±»å‹ã€çŸ¥è¯†æºå’Œæ£€ç´¢ç­–ç•¥ï¼Œå¹¶æä¾›çµæ´»çš„æ‰©å±•æœºåˆ¶ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ ¹æ®ç‰¹å®šéœ€æ±‚å®šåˆ¶å’Œæ‰©å±•ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›ã€‚

é€šè¿‡ä¸æ¡†æ¶çš„å…¶ä»–å±‚ç´§å¯†é›†æˆï¼Œæ™ºèƒ½ä¸Šä¸‹æ–‡å±‚ä¸ºæ„å»ºå…·æœ‰æŒç»­å­¦ä¹ èƒ½åŠ›ã€ä¸Šä¸‹æ–‡æ„ŸçŸ¥èƒ½åŠ›å’ŒçŸ¥è¯†é©±åŠ¨å†³ç­–èƒ½åŠ›çš„æ™ºèƒ½Agentæä¾›äº†åšå®çš„åŸºç¡€ã€‚