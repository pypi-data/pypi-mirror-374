# CIRCL Vulnerability Lookup Analyzer

O CIRCL Vulnerability Lookup Analyzer analisa vulnerabilidades CVE usando a API do CIRCL Vulnerability Lookup, fornecendo pontuações EPSS e métricas CVSS.

## Características

- **Análise de CVE**: Busca informações detalhadas sobre vulnerabilidades CVE
- **Pontuações EPSS**: Avalia o risco de exploração usando EPSS (Exploit Prediction Scoring System)
- **Métricas CVSS**: Extrai e analisa pontuações CVSS de diferentes versões
- **Sightings**: Analisa avistamentos e explorações conhecidas
- **Taxonomia**: Gera entradas de taxonomia baseadas em risco e severidade

## Configuração

### Credenciais (Obrigatório)

```python
secrets = {
    "circl_vulnerability_lookup": {
        "token": "seu_token_api_circl"
    }
}
```

### Configurações Opcionais

```python
config = WorkerConfig(
    # URL da API CIRCL (padrão: https://vulnerability.circl.lu/)
    circl_vulnerability_lookup_url="https://vulnerability.circl.lu/",
    secrets=secrets
)
```

## Uso Programático

### Exemplo Básico

```python
from sentineliqsdk import WorkerInput, WorkerConfig
from sentineliqsdk.analyzers.circl_vulnerability_lookup import CIRCLVulnerabilityLookupAnalyzer

# Configurar credenciais
secrets = {
    "circl_vulnerability_lookup": {
        "token": "seu_token_api_circl"
    }
}

# Criar entrada
input_data = WorkerInput(
    data_type="cve",
    data="CVE-2021-44228",
    tlp=2,
    pap=2,
    config=WorkerConfig(secrets=secrets)
)

# Executar análise
analyzer = CIRCLVulnerabilityLookupAnalyzer(input_data)
report = analyzer.execute()

# Acessar resultados
print(report.full_report["short_report"])
print(report.full_report["taxonomy"])
```

### Exemplo com Configuração Personalizada

```python
from sentineliqsdk import WorkerInput, WorkerConfig
from sentineliqsdk.analyzers.circl_vulnerability_lookup import CIRCLVulnerabilityLookupAnalyzer

# Configuração completa
secrets = {
    "circl_vulnerability_lookup": {
        "token": "seu_token_api_circl"
    }
}

config = WorkerConfig(
    check_tlp=True,
    max_tlp=2,
    check_pap=True,
    max_pap=2,
    auto_extract=True,
    circl_vulnerability_lookup_url="https://vulnerability.circl.lu/",
    secrets=secrets
)

input_data = WorkerInput(
    data_type="cve",
    data="CVE-2021-44228",
    tlp=2,
    pap=2,
    config=config
)

analyzer = CIRCLVulnerabilityLookupAnalyzer(input_data)
report = analyzer.execute()

# Processar resultados
for taxonomy in report.full_report["taxonomy"]:
    print(f"{taxonomy['level']}: {taxonomy['value']}")
```

## Tipos de Dados Suportados

- `cve`: CVE (Common Vulnerabilities and Exposures)
- `vuln`: Vulnerabilidade
- `other`: Outros tipos (quando contém CVE no valor)

## Estrutura de Resposta

### Campos Principais

- **vulnerability**: Dados completos da vulnerabilidade
- **cvss_scores**: Pontuações CVSS por versão
- **sightings**: Avistamentos e explorações
- **epss**: Dados EPSS (Exploit Prediction Scoring System)
- **comments**: Comentários sobre a vulnerabilidade
- **short_report**: Relatório resumido em texto
- **taxonomy**: Entradas de taxonomia para classificação
- **stats**: Estatísticas de avistamentos

### Exemplo de Resposta

```json
{
  "vulnerability": {
    "id": "CVE-2021-44228",
    "metrics": {
      "cvssMetricV31": [{
        "cvssData": {
          "baseScore": 9.8,
          "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
          "baseSeverity": "CRITICAL"
        }
      }]
    }
  },
  "cvss_scores": {
    "3.1": {
      "score": 9.8,
      "severity": "CRITICAL",
      "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
    }
  },
  "short_report": [
    "EPSS Risk: Very High (Score 0.95, 95th percentile)",
    "CVSS 3.1: CRITICAL (9.8)"
  ],
  "taxonomy": [
    {
      "level": "malicious",
      "namespace": "CIRCLVulnL",
      "predicate": "cvss",
      "value": "Critical (CVSS 9.8)"
    },
    {
      "level": "malicious",
      "namespace": "CIRCLVulnL",
      "predicate": "epss",
      "value": "Very High (95th percentile)"
    }
  ]
}
```

## Níveis de Taxonomia

### CVSS (Common Vulnerability Scoring System)
- **malicious**: CVSS >= 7.0 (High/Critical)
- **suspicious**: CVSS >= 4.0 (Medium)
- **info**: CVSS < 4.0 (Low)
- **safe**: Sem pontuação CVSS

### EPSS (Exploit Prediction Scoring System)
- **malicious**: Percentil >= 90% (Very High)
- **suspicious**: Percentil >= 40% (High/Moderate)
- **info**: Percentil >= 10% (Low)
- **safe**: Percentil < 10% (Very Low)

### Sightings
- **malicious**: Vulnerabilidade explorada
- **suspicious**: Vulnerabilidade avistada ou outros avistamentos
- **info**: Sem avistamentos

## Dependências

Este analyzer requer a biblioteca `pyvulnerabilitylookup`:

```bash
pip install pyvulnerabilitylookup
```

## Exemplo de Uso via Linha de Comando

```bash
# Executar em modo dry-run
python examples/analyzers/circl_vulnerability_lookup_example.py --cve CVE-2021-44228

# Executar com token real
python examples/analyzers/circl_vulnerability_lookup_example.py --cve CVE-2021-44228 --execute --token seu_token

# Usar URL personalizada
python examples/analyzers/circl_vulnerability_lookup_example.py --cve CVE-2021-44228 --execute --token seu_token --url https://vulnerability.circl.lu/
```

## Tratamento de Erros

- **Tipo de dados não suportado**: Erro se o tipo de dados não for CVE/vuln/other
- **Biblioteca não disponível**: Erro se `pyvulnerabilitylookup` não estiver instalada
- **Dados não encontrados**: Erro se a CVE não for encontrada na base de dados
- **Erro de API**: Erro se houver problemas na comunicação com a API

## Limitações

- Requer token de API válido do CIRCL
- Depende da disponibilidade da API CIRCL
- Funciona apenas com CVE válidas
- Requer biblioteca externa `pyvulnerabilitylookup`
