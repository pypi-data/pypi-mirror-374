# patch-workflow.yaml

body:
  name: updated-workflow
  triggers:
    - {}
  watchers:
    - user: abc@peak.ai
      events:
        success: false
        fail: true
    - webhook:
        name: info
        url: "https://abc.com/post"
        payload: |
          {
            "system": "external_system",
            "action": "update",
            "data": {
              "field": "value",
              "timestamp": "2024-05-20T12:00:00Z"
            }
          }
      events:
        success: false
        fail: true
        runtimeExceeded: 10
    - email:
        name: email-watcher-1
        recipients:
          to:
            - user1@peak.ai
            - user2@peak.ai
      events:
        success: false
        fail: true
        runtimeExceeded: 10
  retryOptions:
    duration: 5
    exitCodes:
      - 1
      - 2
    exponentialBackoff: true
    numberOfRetries: 3
  steps:
    step1:
      imageId: 100
      imageVersionId: 100
    step2:
      type: http
      method: post
      url: "https://peak.ai"
      payload: "{}"
      auth:
        type: no-auth
      headers:
        absolute:
          Content-Type: application/json
    step3:
      imageId: 400
      imageVersionId: 400
      command: python test4.py
      resources:
        instanceTypeId: 24
      repository:
        url: "https://github.com/org/repo"
        branch: main
        token: random_token
