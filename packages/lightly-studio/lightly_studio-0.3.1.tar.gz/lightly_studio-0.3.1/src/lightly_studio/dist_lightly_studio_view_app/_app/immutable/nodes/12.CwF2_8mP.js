import{w as A,l as h,p as N,f as I,a as P,$ as j,g as v,d as w}from"../chunks/l7KrR96u.js";import{c as $}from"../chunks/BJXwVxaE.js";import{c as L}from"../chunks/x9G_hzyY.js";import{u as k}from"../chunks/vC4nQVEB.js";import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{e as E}from"../chunks/DjfY96ND.js";import{c as O,a as T}from"../chunks/Bu7uvVrG.js";import{i as D,s as F,a as K}from"../chunks/XO7A28GO.js";import{p as x}from"../chunks/Bsi3UGy5.js";import{g as y}from"../chunks/CxtLVaYz.js";import{r as S}from"../chunks/H7C68rOM.js";import{S as M}from"../chunks/BylOuP6i.js";const b=new Map,q=(n,s,g)=>{const{dataset_id:l,offset:e,limit:d,annotationLabelIds:o,tagIds:m,min_width:i,max_width:p,min_height:r,max_height:c,metadataValues:a}=n;return JSON.stringify({dataset_id:l,offset:e,limit:d,annotationLabelIds:o,tagIds:m,min_width:i,max_width:p,min_height:r,max_height:c,metadataValues:a,textEmbedding:s,sampleIds:g})},C=async({dataset_id:n,offset:s=0,limit:g=10,annotationLabelIds:l,tagIds:e,min_width:d,max_width:o,min_height:m,max_height:i,textEmbedding:p=[],sampleIds:r=[],metadataValues:c={}})=>{const a={data:[],error:void 0},t=q({dataset_id:n,offset:s,limit:g,annotationLabelIds:l,tagIds:e,min_width:d,max_width:o,min_height:m,max_height:i,metadataValues:c},p,r),u=b.get(t);if(u)return u;const f=L(c);try{const _=await $.POST("/api/datasets/{dataset_id}/samples/list",{params:{path:{dataset_id:n}},body:{filters:{annotation_label_ids:l,tag_ids:e,width:{min:d,max:o},height:{min:m,max:i},metadata_filters:f},text_embedding:p,sample_ids:r,pagination:{offset:s,limit:g}}});if(_.error)throw new Error(JSON.stringify(_.error,null,2));if(!_.data)throw new Error("No data");a.data=_.data.data,b.set(t,a)}catch(_){a.error="Error loading samples: "+String(_)}return a},J=({dataset_id:n,sampleIndex:s,tagIds:g,annotationLabelIds:l,min_width:e,max_width:d,min_height:o,max_height:m,textEmbedding:i,metadataValues:p})=>{const r=A({isLoading:!1});return(async()=>{r.update(a=>({...a,isLoading:!0,error:void 0}));try{const a=await C({dataset_id:n,limit:3,offset:s<1?0:s-1,annotationLabelIds:l,tagIds:g,min_width:e,max_width:d,min_height:o,max_height:m,textEmbedding:i,metadataValues:p});let t;const u=s>0?a.data[0]:void 0;a.data.length>2&&(t=s==0?a.data[1]:a.data[2]),r.update(f=>({...f,isLoading:!1,sampleNext:t,samplePrevious:u,error:void 0}))}catch(a){r.update(t=>({...t,isLoading:!1,error:a.message||"Failed to load adjacent samples"}))}})(),r},R=async({parent:n,params:{dataset_id:s,sampleId:g,sampleIndex:l}})=>{var c,a,t,u,f;const{samplesSelectedTagsIds:e,samplesSelectedAnnotationLabelsIds:d,samplesDimensions:o,samplesTextEmbedding:m}=await n(),i=parseInt(l,10),{metadataValues:p}=k();return{sampleAdjacents:J({dataset_id:s,sampleIndex:i,tagIds:Array.from(h(e)),annotationLabelIds:Array.from(h(d)),min_width:(c=h(o))==null?void 0:c.min_width,max_width:(a=h(o))==null?void 0:a.max_width,min_height:(t=h(o))==null?void 0:t.min_height,max_height:(u=h(o))==null?void 0:u.max_height,textEmbedding:(f=h(m))==null?void 0:f.embedding,metadataValues:h(p)}),sampleIndex:i}},sa=Object.freeze(Object.defineProperty({__proto__:null,load:R},Symbol.toStringTag,{value:"Module"}));function V(n,s){N(s,!0);const[g,l]=F(),e=()=>K(v(o),"$sampleAdjacents",g),d=w(()=>x.data.sampleIndex),o=w(()=>x.data.sampleAdjacents),m=()=>{e().sampleNext&&y(S.toSample({sampleId:e().sampleNext.sample_id,datasetId:e().sampleNext.dataset_id,sampleIndex:v(d)+1}),{invalidateAll:!0})},i=()=>{e().samplePrevious&&y(S.toSample({sampleId:e().samplePrevious.sample_id,datasetId:e().samplePrevious.dataset_id,sampleIndex:v(d)-1}),{invalidateAll:!0})},p=t=>{switch(t.key){case"ArrowRight":m();break;case"ArrowLeft":i();break}};var r=O();E("keydown",j,p);var c=I(r);{var a=t=>{const u=w(()=>!!e().samplePrevious),f=w(()=>!!e().sampleNext);M(t,{get hasPrevious(){return v(u)},get hasNext(){return v(f)},onPrevious:i,onNext:m})};D(c,t=>{e()&&t(a)})}T(n,r),P(),l()}function oa(n){V(n,{})}export{oa as component,sa as universal};
