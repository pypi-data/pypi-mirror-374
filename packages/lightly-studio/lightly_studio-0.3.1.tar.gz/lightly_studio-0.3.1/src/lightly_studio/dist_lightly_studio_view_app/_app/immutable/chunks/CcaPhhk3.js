import"./CWj6FrbW.js";import{p as U,c as V,g as t,d as W,r as j,t as Y,a as q,L as v,V as x,z as Me,u as N,f as oe,s as re}from"./l7KrR96u.js";import{n as ze,a as p,t as C,c as de}from"./Bu7uvVrG.js";import{a as o,s as ge,i as me}from"./XO7A28GO.js";import{u as We,e as De,i as Ge,s as k,a as Ee,c as Te,b as Be,d as Ne,f as Ue,g as Ye,h as qe,G as Je,j as Ke,S as Qe,k as Xe}from"./CvOmgdoc.js";import{p as ue,r as Ze,a as w,b as $e}from"./D98V7j6A.js";import{u as _e}from"./vC4nQVEB.js";import{o as ve}from"./CxtLVaYz.js";import{r as et}from"./H7C68rOM.js";import{u as tt}from"./D6su9Aln.js";import{u as at,c as ce}from"./x9G_hzyY.js";import"./Bsi3UGy5.js";import"./69_IOA4Y.js";import{u as st}from"./DIRAtgl0.js";import{P as it}from"./BJXwVxaE.js";import{S as nt}from"./B2FVR0s0.js";import{r as fe}from"./Bx1xMsFy.js";import{r as lt}from"./DjfY96ND.js";var ot=ze('<svg style="position: absolute; top: 0; left: 0;"><g></g></svg>');function rt(H,e){U(e,!0);const[a,A]=ge(),I=()=>o(P,"$isHidden",a),y=ue(e,"sampleImageObjectFit",3,"contain"),{isHidden:P}=We(),h=W(()=>e.sample.annotations.filter(c=>c.annotation_type!=="classification"));var s=ot(),d=V(s);let m;De(d,21,()=>t(h),Ge,(c,L)=>{nt(c,{get annotation(){return t(L)},get showLabel(){return e.showLabel},get imageWidth(){return e.sample.width}})}),j(d),j(s),Y(c=>{k(s,"viewBox",`0 0 ${e.sample.width} ${e.sample.height}`),k(s,"preserveAspectRatio",y()==="contain"?"xMidYMid meet":"xMidYMid slice"),k(s,"width",e.containerWidth),k(s,"height",e.containerHeight),m=Ee(d,0,"",null,m,c)},[()=>({invisible:I()})]),p(H,s),q(),A()}var dt=C("<img>");function mt(H,e){U(e,!0);const a=ue(e,"objectFit",3,"contain"),A=Ze(e,["$$slots","$$events","$$legacy","sample","objectFit"]),{class:I,...y}=A,{getDatasetVersion:P}=_e();let h=x("");ve(async()=>{var m;(m=e.sample)!=null&&m.dataset_id&&v(h,w(await P(e.sample.dataset_id)))});var s=dt();let d;Y(m=>d=Be(s,d,{src:`${it}/sample/${e.sample.sample_id}${t(h)?`?v=${t(h)}`:""}`,alt:e.sample.file_path_abs,class:m,style:`--object-fit: ${a()??""}`,loading:"lazy",...y},"svelte-1c6bz0a"),[()=>Te("sample-image rounded-lg bg-black",I)]),lt(s),p(H,s),q()}var ct=C('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <a data-testid="sample-link" class="block"><!> <!></a></div>'),ft=C('<div slot="noMore"></div>'),gt=C('<div slot="noResults"></div>'),ut=C('<div class="viewport flex-1 svelte-gzepom"><!></div>'),_t=C('<div class="flex h-full w-full items-center justify-center"><div>Loading...</div></div>');function Lt(H,e){U(e,!0);const[a,A]=ge(),I=()=>o(he,"$gridViewSampleRenderingStore",a),y=()=>o(Ie,"$infiniteLoaderIdentifier",a),P=()=>o(Q,"$dimensions",a),h=()=>o(Z,"$isCreateClassifiersPanelOpen",a),s=()=>o($,"$isRefineClassifiersPanelOpen",a),d=()=>o(ee,"$classifierSamples",a),m=()=>o(X,"$metadataValues",a),c=()=>o(e.textEmbedding,"$textEmbedding",a),L=()=>o(e.selectedAnnotationFilterIds,"$selectedAnnotationFilterIds",a),J=()=>o(K,"$tagsSelected",a),pe=()=>o(be,"$selectedSampleIds",a),{gridViewSampleRenderingStore:he}=Ne(),{tagsSelected:K}=st({dataset_id:e.dataset_id,kind:["sample"]}),{dimensionsValues:Q}=tt(),{metadataValues:X}=at(e.dataset_id),{isCreateClassifiersPanelOpen:Z}=Ue(),{isRefineClassifiersPanelOpen:$}=Ye(),{selectedSampleIds:be,classifierSamples:ee,toggleSampleSelection:Se,getDatasetVersion:xe,setSamplesTotalCount:we}=_e();let Ie=Me([e.selectedAnnotationFilterIds,K,Q,X,e.textEmbedding,Z,$,ee],([i,n,r,l,u,F,ie,S])=>i.join(",")+Array.from(n).join(",")+r.min_width+r.max_width+r.min_height+r.max_height+JSON.stringify(l)+(u?u.queryText:"")+(F?"open":"closed")+(ie?"open":"closed")+(S?`${S.positiveSampleIds.join(",")},${S.negativeSampleIds.join(",")}`:"")),R=x(0);const M=100;let g=x(w([])),b=x(null),te=x(!1),D=x(w(I())),G=x(0);ve(async()=>{await xe(e.dataset_id),v(te,!0)}),N(()=>{v(D,w(I()))}),N(()=>{y(),v(g,w([])),v(R,0)}),N(()=>{if(!t(b))return;v(G,w(t(b).clientHeight));const i=new ResizeObserver(()=>{t(b)&&v(G,w(t(b).clientHeight))});return i.observe(t(b)),()=>{i.disconnect()}});async function ye({detail:{loaded:i,complete:n}}){const r=P();let l;if(h()||s()){if(!d()){n();return}const u=[...d().positiveSampleIds,...d().negativeSampleIds];if(u.length===0){n();return}const{data:F}=await fe({path:{dataset_id:e.dataset_id},body:{filters:{metadata_filters:ce(m())},text_embedding:c()?c().embedding:void 0,sample_ids:u,pagination:{offset:t(R),limit:M}}});l=F}else{const{data:u}=await fe({path:{dataset_id:e.dataset_id},body:{filters:{annotation_label_ids:L().length>0?L():void 0,tag_ids:J().size>0?Array.from(J()):void 0,width:{min:r.min_width,max:r.max_width},height:{min:r.min_height,max:r.max_height},metadata_filters:ce(m())},text_embedding:c()?c().embedding:void 0,pagination:{offset:t(R),limit:M}}});l=u}l!=null&&l.data.length?(v(R,t(R)+M),t(g).push(...l.data),we(l.total_count),l.data.length<M?n():i()):n()}const ae=16,Fe=qe(),[je,vt]=Fe;var se=de(),Ce=oe(se);{var He=i=>{var n=ut(),r=V(n);const l=W(()=>e.sampleHeight+ae),u=W(()=>e.sampleWidth+ae);Je(r,{get itemCount(){return t(g).length},get itemHeight(){return t(l)},get itemWidth(){return t(u)},get height(){return t(G)},class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${e.sampleWidth??""}px; --sample-height: ${e.sampleHeight??""}px;`},overScan:100,item:(S,f)=>{let _=()=>f==null?void 0:f().index,O=()=>f==null?void 0:f().style;var ne=de(),Pe=oe(ne);{var Re=E=>{var z=ct(),T=V(z),Oe=V(T);const Ve=W(()=>pe().has(t(g)[_()].sample_id));Qe(Oe,{onSelect:()=>Se(t(g)[_()].sample_id),get isSelected(){return t(Ve)}}),j(T);var B=re(T,2),le=V(B);mt(le,{get sample(){return t(g)[_()]},get objectFit(){return t(D)}});var ke=re(le,2);rt(ke,{get sample(){return t(g)[_()]},get containerWidth(){return e.sampleWidth},get sampleImageObjectFit(){return t(D)},get containerHeight(){return e.sampleHeight}}),j(B),j(z),Y(Le=>{Xe(z,O()),k(B,"href",Le)},[()=>je(et.toSample({sampleId:t(g)[_()].sample_id,datasetId:e.dataset_id,sampleIndex:_()}),void 0)]),p(E,z)};me(Pe,E=>{t(g)[_()]&&E(Re)})}p(S,ne)},footer:S=>{Ke(S,{get identifier(){return y()},$$events:{infinite:ye},$$slots:{noMore:(f,_)=>{var O=ft();p(f,O)},noResults:(f,_)=>{var O=gt();p(f,O)}}})},$$slots:{item:!0,footer:!0}}),j(n),$e(n,F=>v(b,F),()=>t(b)),p(i,n)},Ae=i=>{var n=_t();p(i,n)};me(Ce,i=>{t(te)?i(He):i(Ae,!1)})}p(H,se),q(),A()}export{Lt as S};
