const B=/\{[^{}]+\}/g,G=()=>{var t,r;return typeof process=="object"&&Number.parseInt((r=(t=process==null?void 0:process.versions)==null?void 0:t.node)==null?void 0:r.substring(0,2))>=18&&process.versions.undici};function F(){return Math.random().toString(36).slice(2,11)}function M(t){let{baseUrl:r="",Request:e=globalThis.Request,fetch:a=globalThis.fetch,querySerializer:n,bodySerializer:s,headers:l,requestInitExt:f=void 0,...P}={...t};f=G()?f:void 0,r=L(r);const y=[];async function h(i,o){const{baseUrl:m,fetch:O=a,Request:V=e,headers:v,params:p={},parseAs:$="json",querySerializer:E,bodySerializer:I=s??J,body:C,...A}=o||{};m&&(r=L(m));let U=typeof n=="function"?n:D(n);E&&(U=typeof E=="function"?E:D({...typeof n=="object"?n:{},...E}));const q=C===void 0?void 0:I(C),N=q===void 0||q instanceof FormData?{}:{"Content-Type":"application/json"},k={redirect:"follow",...P,...A,body:q,headers:Y(N,l,v,p.header)};let g,j,b=new e(Q(i,{baseUrl:r,params:p,querySerializer:U}),k);for(const u in A)u in b||(b[u]=A[u]);if(y.length){g=F(),j=Object.freeze({baseUrl:r,fetch:O,parseAs:$,querySerializer:U,bodySerializer:I});for(const u of y)if(u&&typeof u=="object"&&typeof u.onRequest=="function"){const d=await u.onRequest({request:b,schemaPath:i,params:p,options:j,id:g});if(d){if(!(d instanceof e))throw new Error("onRequest: must return new Request() when modifying the request");b=d}}}let c;try{c=await O(b,f)}catch(u){let d=u;if(y.length)for(let w=y.length-1;w>=0;w--){const S=y[w];if(S&&typeof S=="object"&&typeof S.onError=="function"){const R=await S.onError({request:b,error:d,schemaPath:i,params:p,options:j,id:g});if(R){if(R instanceof Response){d=void 0,c=R;break}if(R instanceof Error){d=R;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(d)throw d}if(y.length)for(let u=y.length-1;u>=0;u--){const d=y[u];if(d&&typeof d=="object"&&typeof d.onResponse=="function"){const w=await d.onResponse({request:b,response:c,schemaPath:i,params:p,options:j,id:g});if(w){if(!(w instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");c=w}}}if(c.status===204||c.headers.get("Content-Length")==="0")return c.ok?{data:void 0,response:c}:{error:void 0,response:c};if(c.ok)return $==="stream"?{data:c.body,response:c}:{data:await c[$](),response:c};let x=await c.text();try{x=JSON.parse(x)}catch{}return{error:x,response:c}}return{request(i,o,m){return h(o,{...m,method:i.toUpperCase()})},GET(i,o){return h(i,{...o,method:"GET"})},PUT(i,o){return h(i,{...o,method:"PUT"})},POST(i,o){return h(i,{...o,method:"POST"})},DELETE(i,o){return h(i,{...o,method:"DELETE"})},OPTIONS(i,o){return h(i,{...o,method:"OPTIONS"})},HEAD(i,o){return h(i,{...o,method:"HEAD"})},PATCH(i,o){return h(i,{...o,method:"PATCH"})},TRACE(i,o){return h(i,{...o,method:"TRACE"})},use(...i){for(const o of i)if(o){if(typeof o!="object"||!("onRequest"in o||"onResponse"in o||"onError"in o))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");y.push(o)}},eject(...i){for(const o of i){const m=y.indexOf(o);m!==-1&&y.splice(m,1)}}}}function T(t,r,e){if(r==null)return"";if(typeof r=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${t}=${(e==null?void 0:e.allowReserved)===!0?r:encodeURIComponent(r)}`}function _(t,r,e){if(!r||typeof r!="object")return"";const a=[],n={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(const f in r)a.push(f,e.allowReserved===!0?r[f]:encodeURIComponent(r[f]));const l=a.join(",");switch(e.style){case"form":return`${t}=${l}`;case"label":return`.${l}`;case"matrix":return`;${t}=${l}`;default:return l}}for(const l in r){const f=e.style==="deepObject"?`${t}[${l}]`:l;a.push(T(f,r[l],e))}const s=a.join(n);return e.style==="label"||e.style==="matrix"?`${n}${s}`:s}function H(t,r,e){if(!Array.isArray(r))return"";if(e.explode===!1){const s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",l=(e.allowReserved===!0?r:r.map(f=>encodeURIComponent(f))).join(s);switch(e.style){case"simple":return l;case"label":return`.${l}`;case"matrix":return`;${t}=${l}`;default:return`${t}=${l}`}}const a={simple:",",label:".",matrix:";"}[e.style]||"&",n=[];for(const s of r)e.style==="simple"||e.style==="label"?n.push(e.allowReserved===!0?s:encodeURIComponent(s)):n.push(T(t,s,e));return e.style==="label"||e.style==="matrix"?`${a}${n.join(a)}`:n.join(a)}function D(t){return function(e){const a=[];if(e&&typeof e=="object")for(const n in e){const s=e[n];if(s!=null){if(Array.isArray(s)){if(s.length===0)continue;a.push(H(n,s,{style:"form",explode:!0,...t==null?void 0:t.array,allowReserved:(t==null?void 0:t.allowReserved)||!1}));continue}if(typeof s=="object"){a.push(_(n,s,{style:"deepObject",explode:!0,...t==null?void 0:t.object,allowReserved:(t==null?void 0:t.allowReserved)||!1}));continue}a.push(T(n,s,t))}}return a.join("&")}}function W(t,r){let e=t;for(const a of t.match(B)??[]){let n=a.substring(1,a.length-1),s=!1,l="simple";if(n.endsWith("*")&&(s=!0,n=n.substring(0,n.length-1)),n.startsWith(".")?(l="label",n=n.substring(1)):n.startsWith(";")&&(l="matrix",n=n.substring(1)),!r||r[n]===void 0||r[n]===null)continue;const f=r[n];if(Array.isArray(f)){e=e.replace(a,H(n,f,{style:l,explode:s}));continue}if(typeof f=="object"){e=e.replace(a,_(n,f,{style:l,explode:s}));continue}if(l==="matrix"){e=e.replace(a,`;${T(n,f)}`);continue}e=e.replace(a,l==="label"?`.${encodeURIComponent(f)}`:encodeURIComponent(f))}return e}function J(t){return t instanceof FormData?t:JSON.stringify(t)}function Q(t,r){var n;let e=`${r.baseUrl}${t}`;(n=r.params)!=null&&n.path&&(e=W(e,r.params.path));let a=r.querySerializer(r.params.query??{});return a.startsWith("?")&&(a=a.substring(1)),a&&(e+=`?${a}`),e}function Y(...t){const r=new Headers;for(const e of t){if(!e||typeof e!="object")continue;const a=e instanceof Headers?e.entries():Object.entries(e);for(const[n,s]of a)if(s===null)r.delete(n);else if(Array.isArray(s))for(const l of s)r.append(n,l);else s!==void 0&&r.set(n,s)}return r}function L(t){return t.endsWith("/")?t.substring(0,t.length-1):t}const X="/images",K="/",z=M({baseUrl:K,fetch}),Z=async t=>{const r={data:void 0,error:void 0};try{const e=await z.GET("/api/datasets/{dataset_id}",{params:{path:{dataset_id:t}}});if(e.error)throw new Error(JSON.stringify(e.error,null,2));if(!e.data)throw new Error("No data");r.data=e.data}catch(e){r.error="Error loading dataset: "+String(e)}return r},ee=async()=>{const t={data:void 0,error:void 0};try{const{data:r}=await z.GET("/api/datasets");if(!r)throw new Error("No data");const e=r.sort((n,s)=>Date.parse(s.created_at)-Date.parse(n.created_at))[0].dataset_id,a=await z.GET("/api/datasets/{dataset_id}",{params:{path:{dataset_id:e}}});if(a.error)throw new Error(JSON.stringify(a.error,null,2));if(!a.data)throw new Error("No data");t.data=a.data}catch(r){t.error="Error loading dataset: "+String(r)}return t};export{X as P,Z as a,z as c,ee as l};
