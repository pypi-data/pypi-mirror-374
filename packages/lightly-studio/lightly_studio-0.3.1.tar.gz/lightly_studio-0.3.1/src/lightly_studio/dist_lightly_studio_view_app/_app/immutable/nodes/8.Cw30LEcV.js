import{p as T,f as B,n as Et,a as j,w as bt,l as V,$ as ct,g as a,d,c as f,r as m,s as S,t as F,L as Dt,V as Tt,ax as gt}from"../chunks/l7KrR96u.js";import{c as jt}from"../chunks/BJXwVxaE.js";import"../chunks/CWj6FrbW.js";import{c as Z,a as _,t as k,n as Ht}from"../chunks/Bu7uvVrG.js";import{i as O,a as D,s as q}from"../chunks/XO7A28GO.js";import{e as ut}from"../chunks/DjfY96ND.js";import{I as Rt,s as J,K as Ut,L as at,M as Ft,N as Ot,O as zt,P as Gt,p as xt,F as Kt,e as Wt,l as qt,h as Vt,C as It,z as At,E as wt,u as Zt,d as Jt,S as Qt,Q as Yt,a as Xt}from"../chunks/CvOmgdoc.js";import{g as tt}from"../chunks/CxtLVaYz.js";import{u as St}from"../chunks/vC4nQVEB.js";import{f as ht,S as ta}from"../chunks/D5-A_Ffd.js";import{r as U}from"../chunks/H7C68rOM.js";import"../chunks/D6su9Aln.js";import"../chunks/Bx1xMsFy.js";import{p as z}from"../chunks/Bsi3UGy5.js";import"../chunks/69_IOA4Y.js";import{S as aa}from"../chunks/B2FVR0s0.js";import{S as na,B as ea,a as oa,b as X,c as lt,H as sa,d as dt,D as ra,e as ia,Z as la,g as da,u as ca}from"../chunks/nAHhluT7.js";import{S as ua}from"../chunks/BylOuP6i.js";import{s as va,r as ma,a as fa}from"../chunks/D98V7j6A.js";import{s as W}from"../chunks/D6RI2Zrd.js";import{C as _a}from"../chunks/CDnpyLsT.js";import{s as pa}from"../chunks/DIRAtgl0.js";function ga(v,t){T(t,!0);let r=ma(t,["$$slots","$$events","$$legacy"]);Rt(v,va({name:"square-dashed"},()=>r,{iconNode:[["path",{d:"M5 3a2 2 0 0 0-2 2"}],["path",{d:"M19 3a2 2 0 0 1 2 2"}],["path",{d:"M21 19a2 2 0 0 1-2 2"}],["path",{d:"M5 21a2 2 0 0 1-2-2"}],["path",{d:"M9 3h1"}],["path",{d:"M9 21h1"}],["path",{d:"M14 3h1"}],["path",{d:"M14 21h1"}],["path",{d:"M3 9v1"}],["path",{d:"M21 9v1"}],["path",{d:"M3 14v1"}],["path",{d:"M21 14v1"}]],children:(n,o)=>{var s=Z(),p=B(s);pa(p,()=>t.children??Et),_(n,s)},$$slots:{default:!0}})),j()}const ha=async({dataset_id:v,cursor:t=0,limit:r=10,annotation_label_ids:i,tag_ids:n})=>{const o={data:[],error:void 0};try{const s=await jt.GET("/api/datasets/{dataset_id}/annotations",{params:{path:{dataset_id:v},query:{annotation_label_ids:i,tag_ids:n,cursor:t,limit:r}}});if(s.error)throw new Error(JSON.stringify(s.error,null,2));if(!s.data)throw new Error("No data");o.data=s.data.data}catch(s){o.error="Error loading annotations: "+String(s)}return o},ba=({annotationIndex:v,...t})=>{const r=bt({isLoading:!1});return(async()=>{r.update(n=>({...n,isLoading:!0}));try{const n=await ha({cursor:v>0?v-1:0,limit:3,...t}),o=n.data.findIndex(e=>e.annotation_id===t.currentAnnotationId),s=n.data[o+1],p=n.data[o-1];r.update(e=>({...e,isLoading:!1,error:n.error?String(n.error):void 0,data:n.error?void 0:{annotationNext:s,annotationPrevious:p}}))}catch(n){r.update(o=>({...o,isLoading:!1,error:String(n)}))}})(),r},xa=async({parent:v,params:{dataset_id:t,annotationId:r,annotationIndex:i}})=>{const{annotationsSelectedTagsIds:n,annotationsSelectedAnnotationLabelsIds:o,dataset:s}=await v(),p=parseInt(i,10),e=bt();if(!s)throw new Error("Dataset data not found");return ba({annotationIndex:p,dataset_id:t,currentAnnotationId:r,annotation_label_ids:Array.from(V(o)),tag_ids:Array.from(V(n))}).subscribe(({data:L})=>{e.set(L)}),{annotationAdjacents:e,annotationIndex:p,annotationId:r,dataset:s}},gn=Object.freeze(Object.defineProperty({__proto__:null,load:xa},Symbol.toStringTag,{value:"Module"}));function Ia(v,t){T(t,!0);const[r,i]=q(),n=()=>D(a(s),"$annotationAdjacents",r),o=d(()=>z.data.annotationIndex),s=d(()=>z.data.annotationAdjacents),p=()=>{n().annotationNext&&tt(U.toSampleWithAnnotation({datasetId:n().annotationNext.dataset_id,sampleId:n().annotationNext.sample_id,annotationId:n().annotationNext.annotation_id,annotationIndex:a(o)+1}))},e=()=>{n().annotationPrevious&&tt(U.toSampleWithAnnotation({datasetId:n().annotationPrevious.dataset_id,sampleId:n().annotationPrevious.sample_id,annotationId:n().annotationPrevious.annotation_id,annotationIndex:a(o)-1}))},L=g=>{switch(g.key){case"ArrowRight":p();break;case"ArrowLeft":e();break}};var x=Z();ut("keydown",ct,L);var $=B(x);{var I=g=>{const P=d(()=>!!n().annotationPrevious),y=d(()=>!!n().annotationNext);ua(g,{get hasPrevious(){return a(P)},get hasNext(){return a(y)},onPrevious:e,onNext:p})};O($,g=>{n()&&g(I)})}_(v,x),j(),i()}const Aa={object_detection:"Object Detection",bbox:"Bounding Box",instance_segmentation:"Instance Segmentation",semantic_segmentation:"Semantic Segmentation",classification:"Classification"};var wa=k('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1);function Sa(v,t){var r=wa(),i=B(r),n=f(i,!0);m(i);var o=S(i,2),s=f(o,!0);m(o),F(()=>{W(n,t.label),J(o,"data-testid",`annotation-metadata-${t.id}`),W(s,t.value)}),_(v,r)}var $a=k('<span class="break-all text-sm"> </span>'),ya=k('<span class="text-sm"> </span> <!>',1);function ka(v,t){T(t,!0);const[r,i]=q(),n=()=>D(s,"$result",r),o=()=>D(t.isEditingMode,"$isEditingMode",r),s=Ut(),{updateAnnotation:p}=at({datasetId:t.datasetId,annotationId:t.annotationId,onUpdate:t.onUpdate}),e=d(()=>zt(n().data||[])),L=d(()=>{const A=a(e).find(c=>c.value===t.value);return A||{value:t.value,label:t.value}});var x=ya(),$=B(x),I=f($,!0);m($);var g=S($,2);{var P=A=>{Ft(A,{get items(){return a(e)},get value(){return a(L)},name:"annotation-label",placeholder:"Select a label",onSelect:l=>{p({annotation_id:t.annotationId,dataset_id:t.datasetId,label_name:l.value})},notFound:(l,u)=>{let h=()=>u==null?void 0:u().inputValue;Ot(l,{get label(){return h()}})},$$slots:{notFound:!0}})},y=A=>{var c=$a();J(c,"data-testid","annotation-metadata-label");var l=f(c,!0);m(c),F(()=>W(l,t.value)),_(A,c)};O(g,A=>{o()?A(P):A(y,!1)})}F(()=>W(I,t.label)),_(v,x),j(),i()}var Pa=k('<div class="flex flex-col gap-4"><div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div></div>');function Ma(v,t){T(t,!0);const[r,i]=q(),n=()=>D(a(p),"$annotationResp",r),{datasetId:o}=z.data,s=d(()=>at({datasetId:o,annotationId:t.annotationId})),p=d(()=>a(s).annotation);let e=d(()=>n().data);const L=d(qt),x=d(()=>a(L).taskMap),$=d(()=>a(e)&&a(e).annotation_task_id&&V(a(x)).has(a(e).annotation_task_id)?V(a(x)).get(a(e).annotation_task_id).is_prediction:!1),I=d(()=>{var l,u;if(!a(e))return[];let c=[{id:"label",label:"Label:",value:(u=(l=a(e))==null?void 0:l.annotation_label)==null?void 0:u.annotation_label_name},{id:"type",label:"Type:",value:Aa[a(e).annotation_type]||"Unknown"},{id:"status",label:"Status:",value:a($)?"Prediction":"Ground Truth"}];if(a(e)&&!Gt(a(e))){const{height:h,width:M}=xt(a(e));c=[{id:"height",label:"Height:",value:ht(Math.round(h))+"px"},{id:"width",label:"Width:",value:ht(Math.round(M))+"px"},...c]}return c}),{isEditingMode:g}=z.data.globalStorage;var P=Z(),y=B(P);{var A=c=>{Kt(c,{title:"Annotation details",children:(l,u)=>{var h=Pa(),M=f(h);Wt(M,21,()=>a(I),({label:N,value:b,id:C})=>N,(N,b)=>{let C=()=>a(b).label,E=()=>a(b).value,H=()=>a(b).id;var G=Z(),nt=B(G);{var Q=w=>{ka(w,{get onUpdate(){return t.onUpdate},get annotationId(){return t.annotationId},datasetId:o,get label(){return C()},get value(){return E()},isEditingMode:g})},et=w=>{Sa(w,{get label(){return C()},get id(){return H()},get value(){return E()}})};O(nt,w=>{H()==="label"&&g?w(Q):w(et,!1)})}_(N,G)}),m(M),m(h),_(l,h)}})};O(y,c=>{a(I).length>0&&c(A)})}_(v,P),j(),i()}var Na=k('<!> <h2 class="py-2 text-lg font-semibold"><a>Check all sample annotations</a></h2>',1),Ca=k('<div class="flex h-full w-full items-center justify-center"><!></div>'),Ba=k('<div class="flex h-full min-h-0 flex-col space-y-4 overflow-hidden dark:[color-scheme:dark]"><!> <!></div>');function La(v,t){T(t,!0);const{datasetId:r}=z.data;let i=Tt(void 0);at({datasetId:r,annotationId:t.annotationId}).annotation.subscribe(e=>{e.isSuccess&&Dt(i,fa(e.data.sample))});const o=Vt(),[s,p]=o;It(v,{className:"h-full",children:(e,L)=>{At(e,{className:"h-full flex flex-col",children:(x,$)=>{var I=Ba(),g=f(I);Ma(g,{get annotationId(){return t.annotationId},get onUpdate(){return t.onUpdate}});var P=S(g,2);{var y=c=>{var l=Na(),u=B(l);na(u,{get sample(){return a(i)},showCustomMetadata:!1});var h=S(u,2),M=f(h);m(h),F(N=>J(M,"href",N),[()=>s(U.toSample({sampleId:a(i).sample_id,datasetId:a(i).dataset_id}),void 0)]),_(c,l)},A=c=>{var l=Ca(),u=f(l);wt(u,{size:"large",align:"center"}),m(l),_(c,l)};O(P,c=>{a(i)?c(y):c(A,!1)})}m(I),_(x,I)},$$slots:{default:!0}})},$$slots:{default:!0}}),j()}var Ea=k('<!> <span class="hidden sm:inline">Home</span>',1),Da=k('<!> <span class="max-w-[150px] truncate"> </span>',1),Ta=k('<!> <span class="hidden sm:inline">Annotations</span>',1),ja=k('<!> <span class="max-w-[200px] truncate"> </span>',1),Ha=k("<!> <!> <!> <!> <!> <!> <!>",1);function Ra(v,t){T(t,!0);const[r,i]=q(),n=()=>D(o,"$annotationsTotalCount",r),{annotationsTotalCount:o}=St();ea(v,{class:"mb-2",children:(s,p)=>{oa(s,{children:(e,L)=>{var x=Ha(),$=B(x);X($,{children:(l,u)=>{const h=d(()=>U.toHome());lt(l,{get href(){return a(h)},class:"flex items-center gap-2",children:(M,N)=>{var b=Ea(),C=B(b);sa(C,{class:"h-4 w-4"}),gt(2),_(M,b)},$$slots:{default:!0}})},$$slots:{default:!0}});var I=S($,2);dt(I,{});var g=S(I,2);X(g,{children:(l,u)=>{const h=d(()=>U.toAnnotations(t.dataset.dataset_id));lt(l,{get href(){return a(h)},class:"flex items-center gap-2",get title(){return t.dataset.directory},children:(M,N)=>{var b=Da(),C=B(b);ra(C,{class:"h-4 w-4"});var E=S(C,2),H=f(E,!0);m(E),F(()=>{J(E,"title",t.dataset.directory),W(H,t.dataset.name)}),_(M,b)},$$slots:{default:!0}})},$$slots:{default:!0}});var P=S(g,2);dt(P,{});var y=S(P,2);X(y,{children:(l,u)=>{const h=d(()=>U.toAnnotations(t.dataset.dataset_id));lt(l,{get href(){return a(h)},class:"flex items-center gap-2",children:(M,N)=>{var b=Ta(),C=B(b);_a(C,{class:"h-4 w-4"}),gt(2),_(M,b)},$$slots:{default:!0}})},$$slots:{default:!0}});var A=S(y,2);dt(A,{});var c=S(A,2);X(c,{children:(l,u)=>{ia(l,{class:"flex items-center gap-2",children:(h,M)=>{var N=ja(),b=B(N);ga(b,{class:"h-4 w-4"});var C=S(b,2),E=f(C);m(C),F(()=>W(E,`Annotation ${t.annotationIndex+1} of ${n()??""}`)),_(h,N)},$$slots:{default:!0}})},$$slots:{default:!0}}),_(e,x)},$$slots:{default:!0}})},$$slots:{default:!0}}),j(),i()}var Ua=Ht("<image></image><g><!></g>",1),Fa=k('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),Oa=k('<div class="flex h-full w-full items-center justify-center"><!></div>'),za=k('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function Ga(v,t){T(t,!0);const[r,i]=q(),n=()=>D(a(l),"$annotationResp",r),o=()=>D(e,"$selectedSampleAnnotationCropIds",r),s=()=>D(L,"$isHidden",r),{toggleSampleAnnotationCropSelection:p,selectedSampleAnnotationCropIds:e}=St(),{isHidden:L,handleKeyEvent:x}=Zt(),{settingsStore:$}=Jt(),I=" ",g=V($).key_go_back,P=()=>{var w;(w=t.sample)!=null&&w.dataset_id?tt(U.toAnnotations(t.sample.dataset_id)):tt("/")},y=w=>{switch(w.key){case g:P();break;case I:w.preventDefault(),p(t.annotationId);break}x(w)},A=z.data.datasetId,c=d(()=>at({datasetId:A,annotationId:t.annotationId})),l=d(()=>a(c).annotation);let u=d(()=>n().data),h=d(()=>{var w,ot;return da(((ot=(w=a(u))==null?void 0:w.sample)==null?void 0:ot.sample_id)||"")}),M=d(()=>a(u)?xt(a(u)):void 0);var N=za();ut("keydown",ct,y),ut("keyup",ct,x);var b=f(N),C=f(b);Ra(C,{get dataset(){return t.dataset},get annotationIndex(){return t.annotationIndex}}),m(b);var E=S(b,2);ta(E,{class:"mb-4 bg-border-hard"});var H=S(E,2),G=f(H),nt=f(G);It(nt,{className:"h-full",children:(w,ot)=>{At(w,{className:"h-full",children:($t,Wa)=>{var vt=Z(),yt=B(vt);{var kt=K=>{var R=Fa(),Y=f(R),st=f(Y),Mt=f(st);const Nt=d(()=>o().has(t.annotationId));Qt(Mt,{onSelect:()=>p(t.annotationId),get isSelected(){return a(Nt)}}),m(st);var mt=S(st,2);Ia(mt,{});var Ct=S(mt,2);la(Ct,{get width(){return a(u).sample.width},get height(){return a(u).sample.height},get boundingBox(){return a(M)},children:(Bt,qa)=>{var ft=Ua(),_t=B(ft),rt=S(_t);let pt;var Lt=f(rt);Yt(Lt,()=>a(u).annotation_id,it=>{aa(it,{get annotation(){return a(u)},showLabel:!0,get imageWidth(){return a(u).sample.width}})}),m(rt),F(it=>{J(_t,"href",a(h)),pt=Xt(rt,0,"",null,pt,it)},[()=>({invisible:s()})]),_(Bt,ft)},$$slots:{default:!0}}),m(Y),m(R),_(K,R)},Pt=K=>{var R=Oa(),Y=f(R);wt(Y,{size:"large",align:"center"}),m(R),_(K,R)};O(yt,K=>{a(u)?K(kt):K(Pt,!1)})}_($t,vt)},$$slots:{default:!0}})},$$slots:{default:!0}}),m(G);var Q=S(G,2),et=f(Q);La(et,{get annotationId(){return t.annotationId}}),m(Q),m(H),m(N),_(v,N),j(),i()}var Ka=k('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="annotation-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function hn(v,t){T(t,!0);const[r,i]=q(),n=()=>D(a(x),"$sample",r),o=d(()=>t.data.annotationId),s=d(()=>t.data.dataset),p=d(()=>t.data.annotationIndex),{sampleId:e}=z.params,L=d(()=>ca({sampleId:e,datasetId:a(s).dataset_id})),x=d(()=>a(L).sample);var $=Ka(),I=f($),g=f(I);{var P=y=>{Ga(y,{get annotationId(){return a(o)},get annotationIndex(){return a(p)},get dataset(){return a(s)},get sample(){return n().data}})};O(g,y=>{n().data&&a(o)&&a(s)&&y(P)})}m(I),m($),_(v,$),j(),i()}export{hn as component,gn as universal};
