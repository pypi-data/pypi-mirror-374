var Mt=d=>{throw TypeError(d)};var Ot=(d,t,a)=>t.has(d)||Mt("Cannot "+a);var Ae=(d,t,a)=>(Ot(d,t,"read from private field"),a?a.call(d):t.get(d)),rt=(d,t,a)=>t.has(d)?Mt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(d):t.set(d,a);var Nt=(d,t,a)=>(Ot(d,t,"access private method"),a);import{u as it,a as Zt}from"../chunks/vC4nQVEB.js";import{c as lt,a as ea}from"../chunks/BJXwVxaE.js";import{r as Ge,i as ta,a as aa,b as sa}from"../chunks/H7C68rOM.js";import{r as ra}from"../chunks/B90CZVMX.js";import{ad as xt,g as e,L as M,p as Oe,f as C,n as dt,a as Ne,s as r,c as i,ax as X,d as p,r as o,t as de,V as Be,ay as na,am as oa,z as Vt,l as Ze,u as Dt,w as ia}from"../chunks/l7KrR96u.js";import"../chunks/CWj6FrbW.js";import{c as U,a as s,t as $,d as fe}from"../chunks/Bu7uvVrG.js";import{a as L,i as se,s as Ke}from"../chunks/XO7A28GO.js";import{s as Ye,u as Et}from"../chunks/DIRAtgl0.js";import{s as ct,r as at,c as ve,a as Re,p as et,b as Lt}from"../chunks/D98V7j6A.js";import{p as He}from"../chunks/Bsi3UGy5.js";import{R as bt,I as ut,T as je,c as ot,F as ht,U as _t,e as Je,i as nt,l as la,V as yt,W as wt,X as Ct,Y as St,Z as Pt,_ as kt,$ as da,a0 as zt,b as Rt,a1 as ca,a2 as jt,a3 as qt,f as ua,a4 as At,a5 as va,a6 as fa,a7 as Ht,a8 as ma,m as mt,k as _a,s as ga,o as pa,a9 as ha,aa as $a,ab as xa,ac as ba,ad as ya,ae as Gt,af as wa,ag as Ca,ah as Sa,g as Pa,ai as ka,d as Ta,u as Ia,K as Ea,aj as Aa,ak as Fa,al as Ma}from"../chunks/CvOmgdoc.js";import{g as Ue,o as Kt,c as Wt}from"../chunks/CxtLVaYz.js";import{S as vt,f as Qe,a as Oa}from"../chunks/D5-A_Ffd.js";import{C as Na}from"../chunks/CDnpyLsT.js";import{s as K}from"../chunks/D6RI2Zrd.js";import{u as Jt}from"../chunks/D6su9Aln.js";import{u as Da}from"../chunks/x9G_hzyY.js";import"../chunks/69_IOA4Y.js";import{u as La,c as za,a as Ra}from"../chunks/Bx1xMsFy.js";import{u as ja,a as Ba}from"../chunks/hQVEETDE.js";import{i as Qt}from"../chunks/O-EABkf9.js";import{T as Va}from"../chunks/r64xT6ao.js";import{p as Tt}from"../chunks/C8I8rFJQ.js";var qa=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Ha=["difference","intersection","symmetricDifference","union"],Bt=!1,tt,Ve,We,gt,Ut;const pt=class pt extends Set{constructor(a){super();rt(this,gt);rt(this,tt,new Map);rt(this,Ve,xt(0));rt(this,We,xt(0));if(a){for(var l of a)super.add(l);Ae(this,We).v=super.size}Bt||Nt(this,gt,Ut).call(this)}has(a){var l=super.has(a),n=Ae(this,tt),u=n.get(a);if(u===void 0){if(!l)return e(Ae(this,Ve)),!1;u=xt(!0),n.set(a,u)}return e(u),l}add(a){return super.has(a)||(super.add(a),M(Ae(this,We),super.size),bt(Ae(this,Ve))),this}delete(a){var l=super.delete(a),n=Ae(this,tt),u=n.get(a);return u!==void 0&&(n.delete(a),M(u,!1)),l&&(M(Ae(this,We),super.size),bt(Ae(this,Ve))),l}clear(){if(super.size!==0){super.clear();var a=Ae(this,tt);for(var l of a.values())M(l,!1);a.clear(),M(Ae(this,We),0),bt(Ae(this,Ve))}}keys(){return this.values()}values(){return e(Ae(this,Ve)),super.values()}entries(){return e(Ae(this,Ve)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(Ae(this,We))}};tt=new WeakMap,Ve=new WeakMap,We=new WeakMap,gt=new WeakSet,Ut=function(){Bt=!0;var a=pt.prototype,l=Set.prototype;for(const n of qa)a[n]=function(...u){return e(Ae(this,Ve)),l[n].apply(this,u)};for(const n of Ha)a[n]=function(...u){e(Ae(this,Ve));var v=l[n].apply(this,u);return new pt(v)}};let It=pt;function Yt(d,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(d,ct({name:"image"},()=>a,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}],["circle",{cx:"9",cy:"9",r:"2"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}]],children:(n,u)=>{var v=U(),y=C(v);Ye(y,()=>t.children??dt),s(n,v)},$$slots:{default:!0}})),Ne()}var Ga=$("<!> Samples",1),Ka=$("<!> Annotations",1),Wa=$('<div class="mb-5 mt-2 text-lg font-semibold">Collections</div> <!> <div class="flex space-x-2"><!> <!></div>',1);function Ja(d,t){Oe(t,!0);const a="is-active inline-flex rounded-md bg-muted",l=()=>{Ue(Ge.toSamples(t.datasetId))},n=()=>{Ue(Ge.toAnnotations(t.datasetId))};var u=Wa(),v=r(C(u),2);vt(v,{class:"mb-4 bg-border-hard"});var y=r(v,2),W=i(y);const E=p(()=>ot("flex-1","px-2",t.gridType=="samples"&&a));je(W,{variant:"ghost",get class(){return e(E)},onclick:l,"data-testid":"collections-nav-samples-button","data-sveltekit-noscroll":!0,children:(F,S)=>{var k=Ga(),b=C(k);Yt(b,{class:"size-4"}),X(),s(F,k)},$$slots:{default:!0}});var A=r(W,2);const P=p(()=>ot("flex-1","px-2",t.gridType=="annotations"&&a));je(A,{get class(){return e(P)},variant:"ghost",onclick:n,"data-testid":"collections-nav-annotations-button","data-sveltekit-noscroll":!0,children:(F,S)=>{var k=Ka(),b=C(k);Na(b,{class:"size-4"}),X(),s(F,k)},$$slots:{default:!0}}),o(y),s(d,u),Ne()}var Qa=$('<div class="space-y-1"><h2 class="text-md capitalize"> </h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div>'),Ua=$('<div class="space-y-4"><div class="space-y-1"><h2 class="text-md">Width</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <div class="space-y-1"><h2 class="text-md">Height</h2> <div class="flex justify-between text-sm text-diffuse-foreground"><span> </span> <span> </span></div> <div class="relative p-2"><!></div></div> <!></div>');function Ya(d,t){Oe(t,!0);const[a,l]=Ke(),n=()=>L(A,"$values",a),u=()=>L(b,"$metadataValues",a),v=()=>L(k,"$metadataBounds",a),y=()=>L(E,"$bounds",a),W=He.params.dataset_id,{dimensionsBounds:E,dimensionsValues:A,updateDimensionsValues:P}=Jt(),F=g=>{P({min_width:g[0],max_width:g[1],min_height:n().min_height,max_height:n().max_height})},S=g=>{P({min_width:n().min_width,max_width:n().max_width,min_height:g[0],max_height:g[1]})},{metadataBounds:k,metadataValues:b,updateMetadataValues:f}=Da(W),x=g=>N=>{const V={...u()};V[g]={min:N[0],max:N[1]},f(V)},j=p(()=>Object.keys(v()).filter(g=>{const N=v()[g];return N&&typeof N.min=="number"&&typeof N.max=="number"})),Y=(g,N)=>{const V=v()[N];return V&&Number.isInteger(V.min)&&Number.isInteger(V.max)?Qe(g):Oa(g)};ht(d,{title:"Metadata FIlters",children:(g,N)=>{var V=Ua(),pe=i(V),we=r(i(pe),2),T=i(we),Ce=i(T);o(T);var Pe=r(T,2),De=i(Pe);o(Pe),o(we);var me=r(we,2),te=i(me);const Se=p(()=>[n().min_width,n().max_width]);_t(te,{type:"multiple",class:"filter-width",get min(){return y().min_width},get max(){return y().max_width},get value(){return e(Se)},onValueCommit:F}),o(me),o(pe);var J=r(pe,2),re=r(i(J),2),he=i(re),ke=i(he);o(he);var $e=r(he,2),Te=i($e);o($e),o(re);var Fe=r(re,2),m=i(Fe);const c=p(()=>[n().min_height,n().max_height]);_t(m,{type:"multiple",class:"filter-height",get min(){return y().min_height},get max(){return y().max_height},get value(){return e(c)},onValueCommit:S}),o(Fe),o(J);var _=r(J,2);{var ce=I=>{var Q=U(),B=C(Q);Je(B,17,()=>e(j),nt,(xe,ne)=>{var q=Qa();const z=p(()=>v()[e(ne)]),oe=p(()=>u()[e(ne)]),ie=p(()=>Number.isInteger(e(z).min)&&Number.isInteger(e(z).max));var Z=i(q),Me=i(Z,!0);o(Z);var h=r(Z,2),R=i(h),w=i(R,!0);o(R);var H=r(R,2),O=i(H,!0);o(H),o(h);var D=r(h,2),ue=i(D);const G=p(()=>e(ie)?1:.01),le=p(()=>[e(oe).min,e(oe).max]),Ie=p(()=>x(e(ne)));_t(ue,{type:"multiple",get class(){return`filter-${e(ne)??""}`},get min(){return e(z).min},get max(){return e(z).max},get step(){return e(G)},get value(){return e(le)},get onValueCommit(){return e(Ie)}}),o(D),o(q),de((_e,ge,be)=>{K(Me,_e),K(w,ge),K(O,be)},[()=>e(ne).replace(/_/g," "),()=>Y(e(oe).min,e(ne)),()=>Y(e(oe).max,e(ne))]),s(xe,q)}),s(I,Q)};se(_,I=>{e(j).length>0&&I(ce)})}o(V),de((I,Q,B,xe)=>{K(Ce,`${I??""}px`),K(De,`${Q??""}px`),K(ke,`${B??""}px`),K(Te,`${xe??""}px`)},[()=>Qe(n().min_width),()=>Qe(n().max_width),()=>Qe(n().min_height),()=>Qe(n().max_height)]),s(g,V)},$$slots:{default:!0}}),Ne(),l()}function Xa(d,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(d,ct({name:"eraser"},()=>a,{iconNode:[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]],children:(n,u)=>{var v=U(),y=C(v);Ye(y,()=>t.children??dt),s(n,v)},$$slots:{default:!0}})),Ne()}function Za(d,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(d,ct({name:"grid-3x3"},()=>a,{iconNode:[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M3 9h18"}],["path",{d:"M3 15h18"}],["path",{d:"M9 3v18"}],["path",{d:"M15 3v18"}]],children:(n,u)=>{var v=U(),y=C(v);Ye(y,()=>t.children??dt),s(n,v)},$$slots:{default:!0}})),Ne()}function es(d,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(d,ct({name:"plus"},()=>a,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]],children:(n,u)=>{var v=U(),y=C(v);Ye(y,()=>t.children??dt),s(n,v)},$$slots:{default:!0}})),Ne()}function ts(d,t){Oe(t,!0);let a=at(t,["$$slots","$$events","$$legacy"]);ut(d,ct({name:"sliders-horizontal"},()=>a,{iconNode:[["line",{x1:"21",x2:"14",y1:"4",y2:"4"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22"}]],children:(n,u)=>{var v=U(),y=C(v);Ye(y,()=>t.children??dt),s(n,v)},$$slots:{default:!0}})),Ne()}const as=async d=>{const t={data:{},error:void 0};try{const a=await lt.POST("/api/metrics/compute/detection/map",{body:d});if(a.error)throw new Error(JSON.stringify(a.error,null,2));if(!a.data)throw new Error("No data returned from metrics calculation");t.data=a.data}catch(a){t.error="Error computing metrics: "+String(a)}return t};var ss=$("<!> <!>",1),rs=$("<!> <!>",1),ns=$("<!> <!>",1),os=$("<!> <!>",1),is=$('<div class="rounded-md bg-destructive/15 p-3 text-sm text-destructive"> </div>'),ls=$('<span class="mr-2 animate-spin">‚ü≥</span>'),ds=$("<!> Compute",1),cs=$('<div class="space-y-6"><!> <!> <!> <!> <div class="flex space-x-2"><!> <!></div></div>'),us=$('<div class="flex justify-between"><span class="truncate"> </span> <span class="font-medium"> </span></div>'),vs=$('<div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP by Class</h4> <div class="max-h-60 space-y-1 overflow-y-auto text-sm"></div></div>'),fs=$('<div class="space-y-4"><div class="rounded-lg bg-muted p-4"><h4 class="text-md mb-2 font-medium">mAP Results</h4> <div class="space-y-2 text-sm"><div class="flex justify-between"><span>mAP:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@50:</span> <span class="font-medium"> </span></div> <div class="flex justify-between"><span>mAP@75:</span> <span class="font-medium"> </span></div></div></div> <!> <!></div>'),ms=$('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 text-lg font-semibold">Metrics</div> <!> <div class="flex-1 space-y-6"><!></div></div>'),_s=$('<div class="hidden"></div>');function gs(d,t){Oe(t,!0);const[a,l]=Ke(),n=()=>L(F,"$isMetricsPanelOpen",a),u=()=>L(P,"$hasEnoughTasksForMetrics",a),v=()=>L(A,"$annotationTasks",a),y=()=>L(E,"$tags",a);let W=He.params.dataset_id;const{tags:E}=Et({dataset_id:W}),{annotationTasks:A,hasEnoughTasksForMetrics:P}=la(),{isMetricsPanelOpen:F}=ja();let S=Be(""),k=Be(""),b=Be(""),f=Be(null),x=Be(!1),j=Be("");async function Y(){if(!e(S)||!e(k)){M(j,"Please select both ground truth and prediction tasks");return}M(x,!0),M(j,"");try{const T=await as({dataset_id:W,ground_truth_task_id:e(S),prediction_task_id:e(k),tag_id:e(b)||null});T.error?M(j,Re(T.error)):M(f,Re(T.data))}catch(T){M(j,Re(String(T)))}finally{M(x,!1)}}function g(){M(S,""),M(k,""),M(b,""),M(f,null),M(j,"")}var N=U(),V=C(N);{var pe=T=>{var Ce=ms(),Pe=r(i(Ce),2);vt(Pe,{class:"mb-4 bg-border-hard"});var De=r(Pe,2),me=i(De);{var te=J=>{var re=cs(),he=i(re);yt(he,{label:"Ground Truth Task",children:(I,Q)=>{var B=U(),xe=C(B);ve(xe,()=>kt,(ne,q)=>{q(ne,{type:"single",name:"groundTruthTaskId",get value(){return e(S)},set value(z){M(S,Re(z))},children:(z,oe)=>{var ie=ss(),Z=C(ie);ve(Z,()=>wt,(h,R)=>{R(h,{class:"w-full",children:(w,H)=>{X();var O=fe();de(D=>K(O,D),[()=>{var D;return((D=v().find(ue=>ue.annotation_task_id===e(S)))==null?void 0:D.name)||"Select ground truth task"}]),s(w,O)},$$slots:{default:!0}})});var Me=r(Z,2);ve(Me,()=>Ct,(h,R)=>{R(h,{children:(w,H)=>{var O=U(),D=C(O);ve(D,()=>St,(ue,G)=>{G(ue,{children:(le,Ie)=>{var _e=U(),ge=C(_e);Je(ge,1,()=>v().filter(be=>!be.is_prediction),nt,(be,ee)=>{var ae=U(),ye=C(ae);{var ze=Ee=>{var Le=U(),qe=C(Le);ve(qe,()=>Pt,(ft,Xe)=>{Xe(ft,{get value(){return e(ee).annotation_task_id},get label(){return e(ee).name},children:($t,Xt)=>{X();var st=fe();de(()=>K(st,e(ee).name)),s($t,st)},$$slots:{default:!0}})}),s(Ee,Le)};se(ye,Ee=>{e(ee).annotation_task_id&&Ee(ze)})}s(be,ae)}),s(le,_e)},$$slots:{default:!0}})}),s(w,O)},$$slots:{default:!0}})}),s(z,ie)},$$slots:{default:!0}})}),s(I,B)}});var ke=r(he,2);yt(ke,{label:"Prediction Task",children:(I,Q)=>{var B=U(),xe=C(B);ve(xe,()=>kt,(ne,q)=>{q(ne,{type:"single",name:"predictionTaskId",get value(){return e(k)},set value(z){M(k,Re(z))},children:(z,oe)=>{var ie=rs(),Z=C(ie);ve(Z,()=>wt,(h,R)=>{R(h,{class:"w-full",children:(w,H)=>{X();var O=fe();de(D=>K(O,D),[()=>{var D;return((D=v().find(ue=>ue.annotation_task_id===e(k)))==null?void 0:D.name)||"Select prediction task"}]),s(w,O)},$$slots:{default:!0}})});var Me=r(Z,2);ve(Me,()=>Ct,(h,R)=>{R(h,{children:(w,H)=>{var O=U(),D=C(O);ve(D,()=>St,(ue,G)=>{G(ue,{children:(le,Ie)=>{var _e=U(),ge=C(_e);Je(ge,1,()=>v().filter(be=>be.is_prediction),nt,(be,ee)=>{var ae=U(),ye=C(ae);{var ze=Ee=>{var Le=U(),qe=C(Le);ve(qe,()=>Pt,(ft,Xe)=>{Xe(ft,{get value(){return e(ee).annotation_task_id},get label(){return e(ee).name},children:($t,Xt)=>{X();var st=fe();de(()=>K(st,e(ee).name)),s($t,st)},$$slots:{default:!0}})}),s(Ee,Le)};se(ye,Ee=>{e(ee).annotation_task_id&&Ee(ze)})}s(be,ae)}),s(le,_e)},$$slots:{default:!0}})}),s(w,O)},$$slots:{default:!0}})}),s(z,ie)},$$slots:{default:!0}})}),s(I,B)}});var $e=r(ke,2);yt($e,{label:"Tag (Optional)",children:(I,Q)=>{var B=U(),xe=C(B);ve(xe,()=>kt,(ne,q)=>{q(ne,{type:"single",name:"tagId",get value(){return e(b)},set value(z){M(b,Re(z))},children:(z,oe)=>{var ie=os(),Z=C(ie);ve(Z,()=>wt,(h,R)=>{R(h,{class:"w-full",children:(w,H)=>{X();var O=fe();de(D=>K(O,D),[()=>{var D;return((D=y().find(ue=>ue.tag_id===e(b)))==null?void 0:D.name)||"Select tag (optional)"}]),s(w,O)},$$slots:{default:!0}})});var Me=r(Z,2);ve(Me,()=>Ct,(h,R)=>{R(h,{children:(w,H)=>{var O=U(),D=C(O);ve(D,()=>St,(ue,G)=>{G(ue,{children:(le,Ie)=>{var _e=ns(),ge=C(_e);ve(ge,()=>da,(ee,ae)=>{ae(ee,{children:(ye,ze)=>{X();var Ee=fe("Sample tags");s(ye,Ee)},$$slots:{default:!0}})});var be=r(ge,2);Je(be,1,()=>y().filter(ee=>ee.kind==="sample"),nt,(ee,ae)=>{var ye=U(),ze=C(ye);ve(ze,()=>Pt,(Ee,Le)=>{Le(Ee,{get value(){return e(ae).tag_id},get label(){return e(ae).name},children:(qe,ft)=>{X();var Xe=fe();de(()=>K(Xe,e(ae).name)),s(qe,Xe)},$$slots:{default:!0}})}),s(ee,ye)}),s(le,_e)},$$slots:{default:!0}})}),s(w,O)},$$slots:{default:!0}})}),s(z,ie)},$$slots:{default:!0}})}),s(I,B)}});var Te=r($e,2);{var Fe=I=>{var Q=is(),B=i(Q,!0);o(Q),de(()=>K(B,e(j))),s(I,Q)};se(Te,I=>{e(j)&&I(Fe)})}var m=r(Te,2),c=i(m);je(c,{variant:"outline",class:"flex-1",onclick:g,get disabled(){return e(x)},children:(I,Q)=>{X();var B=fe("Reset");s(I,B)},$$slots:{default:!0}});var _=r(c,2);const ce=p(()=>!e(S)||!e(k)||e(x));je(_,{variant:"default",class:"flex-1",onclick:Y,get disabled(){return e(ce)},children:(I,Q)=>{var B=ds(),xe=C(B);{var ne=q=>{var z=ls();s(q,z)};se(xe,q=>{e(x)&&q(ne)})}X(),s(I,B)},$$slots:{default:!0}}),o(m),o(re),s(J,re)},Se=J=>{var re=fs(),he=i(re),ke=r(i(he),2),$e=i(ke),Te=r(i($e),2),Fe=i(Te);o(Te),o($e);var m=r($e,2),c=r(i(m),2),_=i(c);o(c),o(m);var ce=r(m,2),I=r(i(ce),2),Q=i(I);o(I),o(ce),o(ke),o(he);var B=r(he,2);{var xe=q=>{var z=vs(),oe=r(i(z),2);Je(oe,21,()=>Object.entries(e(f).map_per_class).sort(([ie],[Z])=>ie<Z?-1:ie>Z?1:0),nt,(ie,Z)=>{let Me=()=>e(Z)[0],h=()=>e(Z)[1];var R=us(),w=i(R),H=i(w);o(w);var O=r(w,2),D=i(O);o(O),o(R),de(ue=>{K(H,`${Me()??""}:`),K(D,`${ue??""}%`)},[()=>(h()*100).toFixed(2)]),s(ie,R)}),o(oe),o(z),s(q,z)};se(B,q=>{e(f).map_per_class&&q(xe)})}var ne=r(B,2);je(ne,{variant:"outline",class:"mt-4 w-full",onclick:()=>M(f,null),children:(q,z)=>{X();var oe=fe("Back to Form");s(q,oe)},$$slots:{default:!0}}),o(re),de((q,z,oe)=>{K(Fe,`${q??""}%`),K(_,`${z??""}%`),K(Q,`${oe??""}%`)},[()=>(e(f).map*100).toFixed(2),()=>(e(f).map_50*100).toFixed(2),()=>(e(f).map_75*100).toFixed(2)]),s(J,re)};se(me,J=>{e(f)?J(Se,!1):J(te)})}o(De),o(Ce),s(T,Ce)},we=T=>{var Ce=_s();s(T,Ce)};se(V,T=>{n()&&u()?T(pe):T(we,!1)})}s(d,N),Ne(),l()}var ps=$("<input>"),hs=$("<input>");function Ft(d,t){Oe(t,!0);let a=et(t,"ref",15,null),l=et(t,"value",15),n=et(t,"files",15),u=at(t,["$$slots","$$events","$$legacy","ref","value","type","files","class"]);var v=U(),y=C(v);{var W=A=>{var P=ps();zt(P);let F;Lt(P,S=>a(S),()=>a()),de(S=>F=Rt(P,F,{class:S,type:"file",...u}),[()=>ot("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t.class)]),ca(P,n),jt(P,l),s(A,P)},E=A=>{var P=hs();zt(P);let F;Lt(P,S=>a(S),()=>a()),de(S=>F=Rt(P,F,{class:S,type:t.type,...u}),[()=>ot("border-input bg-background ring-offset-background placeholder:text-muted-foreground focus-visible:ring-ring flex h-10 w-full rounded-md border px-3 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t.class)]),jt(P,l),s(A,P)};se(y,A=>{t.type==="file"?A(W):A(E,!1)})}s(d,v),Ne()}var $s=$('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 flex items-center justify-between"><div class="text-lg font-semibold">Create Classifier</div> <!></div> <!> <div class="flex-1 space-y-6"><!> <div class="space-y-2"><label for="classifier-name" class="text-sm font-medium">Classifier Name</label> <!></div> <!></div></div>'),xs=$('<div class="hidden"></div>');function bs(d,t){Oe(t,!1);const[a,l]=Ke(),n=()=>L(v,"$isCreateClassifiersPanelOpen",a),u=()=>L(W,"$error",a),{isCreateClassifiersPanelOpen:v,closeCreateClassifiersPanel:y}=ua(),{error:W,createClassifier:E}=qt(),{clearClassifierSamples:A}=it();let P=na(""),F=He.params.dataset_id;function S(){A(),M(P,""),y(),Ue(Ge.toSamples(F))}Qt();var k=U(),b=C(k);{var f=j=>{var Y=$s(),g=i(Y),N=r(i(g),2);je(N,{variant:"ghost",size:"icon",onclick:S,class:"h-8 w-8",children:(te,Se)=>{X();var J=fe("‚úï");s(te,J)},$$slots:{default:!0}}),o(g);var V=r(g,2);vt(V,{class:"mb-4 bg-border-hard"});var pe=r(V,2),we=i(pe);{var T=te=>{At(te,{title:"Error occured",children:(Se,J)=>{X();var re=fe();de(()=>K(re,u())),s(Se,re)}})};se(we,te=>{u()&&te(T)})}var Ce=r(we,2),Pe=r(i(Ce),2);Ft(Pe,{id:"classifier-name",type:"text",placeholder:"Enter classifier name",get value(){return e(P)},set value(te){M(P,te)},$$legacy:!0}),o(Ce);var De=r(Ce,2);const me=oa(()=>!e(P).trim());je(De,{variant:"default",class:"w-full",onclick:()=>E({name:e(P),class_list:["positive","negative"],dataset_id:F}),get disabled(){return e(me)},children:(te,Se)=>{X();var J=fe("Create Classifier");s(te,J)},$$slots:{default:!0}}),o(pe),o(Y),s(j,Y)},x=j=>{var Y=xs();s(j,Y)};se(b,j=>{n()?j(f):j(x,!1)})}s(d,k),Ne(),l()}var ys=$('<div class="w-300 flex space-x-4 text-diffuse-foreground"><!> <!> <!></div>');function ws(d,t){Oe(t,!0);const[a,l]=Ke(),n=()=>L(y,"$sampleSize",a),u=et(t,"min",3,100),v=et(t,"max",3,1500),{sampleSize:y,updateSampleSize:W}=it(),E=p(()=>n().width),A=va.throttle(f=>{W(f[0])},100);var P=ys(),F=i(P);Za(F,{class:"h-6 w-6"});var S=r(F,2);const k=p(()=>[e(E)]);_t(S,{class:"w-full flex-1",get value(){return e(k)},get min(){return u()},get max(){return v()},step:1,onValueChange:A});var b=r(S,2);Yt(b,{class:"h-6 w-6"}),o(P),s(d,P),Ne(),l()}var Cs=$('<div class="h-3 w-3 cursor-pointer rounded-sm border"></div>'),Ss=$('<div class="color-picker-container"><!></div> <p class="flex-1 truncate text-base font-normal" data-testid="label-menu-label-name"> </p> <span class="text-sm text-diffuse-foreground" data-testid="label-menu-label-count"> </span>',1),Ps=$('<div class="width-full flex items-center space-x-2"><!> <!></div>'),ks=$('<div class="width-full space-y-2 overflow-hidden"></div>');function Ts(d,t){Oe(t,!0);const[a,l]=Ke(),n=()=>L(A,"$customLabelColorsStore",a),u=()=>L(v(),"$annotationFilters",a);let v=et(t,"annotationFilters",19,()=>[]);const{setCustomColor:y,getCustomColor:W,hasCustomColor:E,customLabelColorsStore:A}=pa();function P(b,f,x){y(b,f,x)}function F(b){if(E(b)){const x=W(b);return(x==null?void 0:x.color)||"#ff0000"}const f=mt(b,1).color;try{const x=f.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(x){const j=parseInt(x[1]),Y=parseInt(x[2]),g=parseInt(x[3]);return`#${((1<<24)+(j<<16)+(Y<<8)+g).toString(16).slice(1)}`}}catch(x){console.error("Error converting rgba to hex",x)}return"#ff0000"}function S(b){if(E(b)){const f=W(b);return(f==null?void 0:f.alpha)||1}return .4}const k=p(()=>{const b=n(),f={};for(const x of Object.keys(b)){const j=b[x];f[x]={borderColor:j.color,backgroundColor:mt(x,.4).color}}return f});ht(d,{title:"Labels",children:(b,f)=>{var x=ks();Je(x,5,u,({label_name:j,current_count:Y,total_count:g,selected:N})=>j,(j,Y)=>{let g=()=>e(Y).label_name,N=()=>e(Y).current_count,V=()=>e(Y).total_count,pe=()=>e(Y).selected;var we=Ps(),T=i(we);const Ce=p(()=>`${g()}-label`);fa(T,{get id(){return g()},get checked(){return pe()},get"aria-labelledby"(){return e(Ce)},onCheckedChange:()=>t.onToggleAnnotationFilter(g())});var Pe=r(T,2);const De=p(()=>`${g()}-label`);Ht(Pe,{get id(){return e(De)},get for(){return g()},"data-testid":"labels-menu-item",class:"flex min-w-0 flex-1 cursor-pointer items-center space-x-2 text-nowrap peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:(me,te)=>{var Se=Ss(),J=C(Se),re=i(J);const he=p(()=>F(g())),ke=p(()=>S(g()));ma(re,{get initialColor(){return e(he)},get initialAlpha(){return e(ke)},onChange:(c,_)=>P(g(),c,_),children:(c,_)=>{var ce=Cs();de(I=>_a(ce,I),[()=>{var I,Q;return`
                                    border-color: ${((I=e(k)[g()])==null?void 0:I.borderColor)??mt(g()).color};
                                    background-color: ${((Q=e(k)[g()])==null?void 0:Q.backgroundColor)??mt(g(),pe()?1:.4).color};
                                `}]),s(c,ce)},$$slots:{default:!0}}),o(J);var $e=r(J,2),Te=i($e,!0);o($e);var Fe=r($e,2),m=i(Fe);o(Fe),de((c,_)=>{K(Te,g()),K(m,`${c??""} of ${_??""}`)},[()=>Qe(N()),()=>Qe(V())]),s(me,Se)},$$slots:{default:!0}}),o(we),de(()=>ga(we,"title",g())),s(j,we)}),o(x),s(b,x)},$$slots:{default:!0}}),Ne(),l()}const Is=async({dataset_id:d,tag_id:t,annotationIdsBody:a})=>{const l={data:void 0,error:void 0};try{const n=await lt.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/annotations",{params:{path:{dataset_id:d,tag_id:t}},body:a});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No data");l.data=n.data}catch(n){l.error="Error assigning annotationIds to a tag: "+String(n)}return l},Es=d=>["/api/datasets/{dataset_id}/tags",d],As=async({dataset_id:d,tag_id:t,sampleIdsBody:a})=>{const l={data:void 0,error:void 0};try{const n=await lt.POST("/api/datasets/{dataset_id}/tags/{tag_id}/add/samples",{params:{path:{dataset_id:d,tag_id:t}},body:a});if(n.error)throw new Error(JSON.stringify(n.error,null,2));if(!n.data)throw new Error("No data");l.data=n.data}catch(n){l.error="Error assigning sampleIds to tag: "+String(n)}return l},Fs=async({dataset_id:d,tagInputBody:t})=>{const a={data:void 0,error:void 0};try{const l=await lt.POST("/api/datasets/{dataset_id}/tags",{params:{path:{dataset_id:d}},body:t});if(l.error)throw new Error(JSON.stringify(l.error,null,2));if(!l.data)throw new Error("No data");a.data=l.data}catch(l){a.error="Error creating tag: "+String(l)}return a};var Ms=$("<!> Create new Tags",1),Os=$("<!> <!>",1),Ns=$('<div class="flex space-x-2 py-1"><!></div>'),Ds=$('<!> <!> <div class="grid gap-4"><!></div> <div><!> <!></div> <!>',1),Ls=$('<div class="flex space-x-1"><!> <!></div> <!>',1);function zs(d,t){Oe(t,!0);const[a,l]=Ke(),n=()=>L(S,"$selectedSampleIds",a),u=()=>L(k,"$selectedSampleAnnotationCropIds",a),v=()=>L(e(P),"$tags",a),y=()=>L(e(j),"$itemsSelected",a),W=()=>L(te,"$submitTagAndMutate",a);let E=p(()=>t.gridType==="samples"?"sample":"annotation");const A=p(()=>Et({dataset_id:t.datasetId,kind:[e(E)]})),P=p(()=>e(A).tags),F=p(()=>e(A).loadTags),{selectedSampleIds:S,selectedSampleAnnotationCropIds:k,clearSelectedSampleAnnotationCrops:b,clearSelectedSamples:f}=it(),x=p(()=>t.gridType==="samples"?f:b),j=p(()=>t.gridType==="samples"?S:k);let Y=Be(!1);const g=p(()=>n().size>0&&t.gridType==="samples"||u().size>0&&t.gridType==="annotations");let N=Be(""),V=Be(Re([])),pe=()=>{e(V).push(e(N)),T.add(e(N)),M(N,"")};const we=p(()=>[...e(V).map(c=>({tag_id:c,name:c,kind:e(E)})),...v()].filter(c=>c.name.includes(e(N))));let T=Re(new It);const Ce=c=>{T.has(c)?(T.delete(c),e(V).splice(e(V).indexOf(c),1)):T.add(c)};let Pe=Be(null);const De=async()=>{await Promise.all([...e(V)].map(async c=>{var ce;const _=await Fs({dataset_id:t.datasetId,tagInputBody:{name:c,description:`${c} description`,kind:e(E)}});if(_.error)throw _.error;return(ce=_.data)!=null&&ce.tag_id&&(T.delete(c),T.add(_.data.tag_id)),_})),await Promise.all([...T].map(async c=>{const _=e(E)==="sample"?await As({dataset_id:t.datasetId,tag_id:c,sampleIdsBody:{sample_ids:[...y()]}}):await Is({dataset_id:t.datasetId,tag_id:c,annotationIdsBody:{annotation_ids:[...y()]}});if(_.error)throw _.error;return _}))},me=La(),te=ha({mutationFn:async()=>{await De()},onError:c=>{M(Pe,Re(c))},onSuccess:()=>{me.invalidateQueries({queryKey:Es({dataset_id:t.datasetId})}),e(F)(),e(x)(),Se(!1)}}),Se=c=>{M(Y,Re(c)),M(Pe,null),M(N,""),M(V,Re([])),T.clear()},J=p(()=>T.size>0||e(V).length>0);var re=Ls(),he=C(re),ke=i(he);const $e=p(()=>!e(g));je(ke,{variant:"outline",get disabled(){return e($e)},class:"flex-1",onclick:()=>M(Y,!0),"data-testid":"tag-create-dialog-button",children:(c,_)=>{var ce=Ms(),I=C(ce);es(I,{}),X(),s(c,ce)},$$slots:{default:!0}});var Te=r(ke,2);const Fe=p(()=>!e(g));je(Te,{variant:"outline",get disabled(){return e(Fe)},size:"icon",title:"Clear selection",get onclick(){return e(x)},children:(c,_)=>{Xa(c,{})},$$slots:{default:!0}}),o(he);var m=r(he,2);ve(m,()=>Ca,(c,_)=>{_(c,{onOpenChange:Se,get open(){return e(Y)},children:(ce,I)=>{var Q=U(),B=C(Q);ve(B,()=>$a,(xe,ne)=>{ne(xe,{class:"sm:max-w-[425px]",children:(q,z)=>{var oe=Ds(),ie=C(oe);ve(ie,()=>xa,(G,le)=>{le(G,{children:(Ie,_e)=>{var ge=Os(),be=C(ge);ve(be,()=>ba,(ae,ye)=>{ye(ae,{children:(ze,Ee)=>{X();var Le=fe();de(()=>K(Le,`Add the selected ${e(E)??""} to a tag`)),s(ze,Le)},$$slots:{default:!0}})});var ee=r(be,2);ve(ee,()=>ya,(ae,ye)=>{ye(ae,{children:(ze,Ee)=>{X();var Le=fe();de(()=>K(Le,`Add the selected ${y().size??""}
                ${e(E)??""} to an new or existing tag. Tags can later be exported.`)),s(ze,Le)},$$slots:{default:!0}})}),s(Ie,ge)},$$slots:{default:!0}})});var Z=r(ie,2);{var Me=G=>{At(G,{title:"Error occured",children:(le,Ie)=>{X();var _e=fe();de(()=>K(_e,e(Pe))),s(le,_e)}})};se(Z,G=>{e(Pe)&&G(Me)})}var h=r(Z,2),R=i(h);Ft(R,{type:"text",placeholder:"Create or search tags",autofocus:!0,"data-testid":"tag-create-dialog-input",get value(){return e(N)},set value(G){M(N,Re(G))}}),o(h);var w=r(h,2),H=i(w);Je(H,17,()=>e(we),G=>G.tag_id,(G,le)=>{var Ie=Ns(),_e=i(Ie);const ge=p(()=>`tagCreateDialog-tag-${e(le).tag_id}`),be=p(()=>T.has(e(le).tag_id));Gt(_e,{get name(){return e(ge)},get isChecked(){return e(be)},get label(){return e(le).name},onCheckedChange:()=>Ce(e(le).tag_id)}),o(Ie),s(G,Ie)});var O=r(H,2);{var D=G=>{const le=p(()=>ot("",...Sa({variant:"outline"})));je(G,{type:"button",variant:"outline",get class(){return e(le)},onclick:pe,"data-testid":"tag-create-dialog-create",children:(Ie,_e)=>{X();var ge=fe();de(()=>K(ge,`Create tag "${e(N)??""}"`)),s(Ie,ge)},$$slots:{default:!0}})};se(O,G=>{e(N)&&G(D)})}o(w);var ue=r(w,2);ve(ue,()=>wa,(G,le)=>{le(G,{children:(Ie,_e)=>{var ge=U(),be=C(ge);{var ee=ae=>{je(ae,{type:"submit",onclick:()=>W().mutate(),"data-testid":"tag-create-dialog-save",children:(ye,ze)=>{X();var Ee=fe("Save changes");s(ye,Ee)},$$slots:{default:!0}})};se(be,ae=>{e(J)&&ae(ee)})}s(Ie,ge)},$$slots:{default:!0}})}),s(q,oe)},$$slots:{default:!0}})}),s(ce,Q)},$$slots:{default:!0}})}),s(d,re),Ne(),l()}var Rs=$('<div class="flex items-center space-x-2 py-1" data-testid="tag-menu-item"><!></div>'),js=$("<p>No tag, create a tag</p>"),Bs=$('<div class="mb-3 w-full space-y-2"></div>');function Vs(d,t){Oe(t,!0);const[a,l]=Ke(),n=()=>L(e(y),"$tags",a),u=()=>L(e(W),"$tagsSelected",a),v=p(()=>Et({dataset_id:t.dataset_id,kind:[t.gridType==="annotations"?"annotation":"sample"]})),y=p(()=>e(v).tags),W=p(()=>e(v).tagsSelected),E=p(()=>e(v).tagSelectionToggle);ht(d,{title:"Tags",icon:Va,children:(A,P)=>{var F=Bs();Je(F,5,n,S=>S.tag_id,(S,k)=>{var b=Rs(),f=i(b);const x=p(()=>u().has(e(k).tag_id));Gt(f,{get name(){return e(k).tag_id},get isChecked(){return e(x)},get label(){return e(k).name},onCheckedChange:()=>e(E)(e(k).tag_id)}),o(b),s(S,b)},S=>{var k=js();s(S,k)}),o(F),s(A,F)}}),Ne(),l()}var qs=$(`<li>Once satisfied with the results, click "Commit Temporary Classifier"
                                to save permanently</li>`),Hs=$('<div class="flex w-80 flex-col rounded-[1vw] bg-card p-4"><div class="mb-5 mt-2 flex items-center justify-between"><div class="text-lg font-semibold"> </div> <!></div> <!> <div class="flex-1 space-y-6"><div class="space-y-4"><div><h3 class="mb-2 text-lg font-semibold">Refinement Instructions</h3> <p class="mb-4 text-sm text-muted-foreground">You are refining classifier: <span class="font-medium"> </span></p> <ol class="list-inside list-decimal space-y-2 text-sm text-muted-foreground"><li>Select positive examples from the samples</li> <li>Click "Refine Classifier" to retrain with your selections</li> <!></ol></div></div> <div class="space-y-4"><!> <!> <div class="flex items-center justify-between gap-4"><!> <!></div> <!></div></div></div>'),Gs=$('<div class="hidden"></div>');function Ks(d,t){Oe(t,!1);const[a,l]=Ke(),n=()=>L(S,"$isRefineClassifiersPanelOpen",a),u=()=>L(b,"$currentMode",a),v=()=>L(x,"$currentClassifierName",a),y=()=>L(Y,"$error",a),W=()=>L(f,"$currentClassifierId",a),E=()=>L(j,"$currentClassifierClasses",a),A=()=>L(F,"$showTrainingSamplesToggle",a),{clearSelectedSamples:P}=it(),F=Zt("refine_classifier_show_training_samples",!1),{isRefineClassifiersPanelOpen:S,closeRefineClassifiersPanel:k,currentMode:b,currentClassifierId:f,currentClassifierName:x,currentClassifierClasses:j}=Pa(),{error:Y,commitTempClassifier:g,refineClassifier:N,showClassifierTrainingSamples:V}=qt();let pe=He.params.dataset_id;function we(){P(),F.set(!1),k(),Ue(Ge.toSamples(pe))}Qt();var T=U(),Ce=C(T);{var Pe=me=>{var te=Hs(),Se=i(te),J=i(Se),re=i(J,!0);o(J);var he=r(J,2);je(he,{variant:"ghost",size:"icon",onclick:we,class:"h-8 w-8",children:(h,R)=>{X();var w=fe("‚úï");s(h,w)},$$slots:{default:!0}}),o(Se);var ke=r(Se,2);vt(ke,{class:"mb-4 bg-border-hard"});var $e=r(ke,2),Te=i($e),Fe=i(Te),m=r(i(Fe),2),c=r(i(m)),_=i(c,!0);o(c),o(m);var ce=r(m,2),I=r(i(ce),4);{var Q=h=>{var R=qs();s(h,R)};se(I,h=>{u()==="temp"&&h(Q)})}o(ce),o(Fe),o(Te);var B=r(Te,2),xe=i(B);{var ne=h=>{At(h,{title:"Error occured",children:(R,w)=>{X();var H=fe();de(()=>K(H,y())),s(R,H)}})};se(xe,h=>{y()&&h(ne)})}var q=r(xe,2);je(q,{variant:"default",class:"w-full",onclick:()=>{F.set(!1),N(W()||"",pe,E()||[])},children:(h,R)=>{X();var w=fe("Refine Classifier");s(h,w)},$$slots:{default:!0}});var z=r(q,2),oe=i(z);Ht(oe,{class:"text-foreground",children:(h,R)=>{X();var w=fe("Show All Training Samples");s(h,w)},$$slots:{default:!0}});var ie=r(oe,2);ka(ie,{class:"",get checked(){return A()},onCheckedChange:h=>{F.set(h),V(W()||"",pe,E()||[],h)}}),o(z);var Z=r(z,2);{var Me=h=>{je(h,{variant:"outline",class:"w-full",onclick:()=>{F.set(!1),g(W()||"",pe)},children:(R,w)=>{X();var H=fe("Commit Temporary Classifier");s(R,H)},$$slots:{default:!0}})};se(Z,h=>{u()==="temp"&&h(Me)})}o(B),o($e),o(te),de(()=>{K(re,u()==="temp"?"Refine Temporary Classifier":"Refine Classifier"),K(_,v())}),s(me,te)},De=me=>{var te=Gs();s(me,te)};se(Ce,me=>{n()?me(Pe):me(De,!1)})}s(d,T),Ne(),l()}const Ws=async({params:{dataset_id:d}})=>{const{data:t,error:a}=await ea(d);if(a||!t)throw ra(307,Ge.toHome());const l=it(),n=Vt(l.selectedAnnotationFilterIds,u=>Array.from(u));return{datasetId:d,dataset:t,globalStorage:l,selectedAnnotationFilterIds:n,sampleSize:l.sampleSize}},Ir=Object.freeze(Object.defineProperty({__proto__:null,load:Ws},Symbol.toStringTag,{value:"Module"})),Js=d=>{const{settingsStore:t}=Ta(),a=new Set,l=u=>{if(u.target instanceof HTMLInputElement||u.target instanceof HTMLTextAreaElement||u.target instanceof HTMLSelectElement)return;a.add(u.key);const v=Ze(Tt).url.pathname,y={hideAnnotations:Ze(t).key_hide_annotations||"v",goBack:Ze(t).key_go_back||"Escape"};Object.entries(d).forEach(([W,E])=>{const A=y[W]||E.key;if(u.key===A){if(E.requiredPath){if(typeof E.requiredPath=="function"){if(!E.requiredPath(v))return}else if(!E.requiredPath.test(v))return}E.action(u)}})},n=u=>{a.delete(u.key)};return Kt(()=>{window.addEventListener("keydown",l),window.addEventListener("keyup",n)}),Wt(()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",n)}),{isKeyPressed:u=>a.has(u)}},Qs={goBack:{key:"Escape",description:"Go back from detail view to grid view",isConfigurable:!0,requiredPath:d=>/\/datasets\/[^/]+\/(samples|annotations)\/[^/]+/.test(d)||/\/samples\/[^/]+/.test(d),action:()=>{const d=Ze(Tt).url.pathname,t=Ze(Tt).params.dataset_id;if(/\/samples\/[^/]+/.test(d)&&!t){Ue("/");return}t&&(d.includes("/samples/")?Ue(Ge.toSamples(t)):d.includes("/annotations/")&&Ue(Ge.toAnnotations(t)))}}},Us=async({query_text:d="",model_id:t=""})=>{const a={data:[],error:void 0};try{const l=await lt.GET("/api/text_embedding/embed_text",{params:{query:{query_text:d,model_id:t}}});if(l.error)throw new Error(JSON.stringify(l.error,null,2));if(!l.data)throw new Error("No data");a.data=l.data}catch(l){a.error="Error creating text embedding: "+String(l)}return a},Ys=({datasetId:d,options:t})=>{var a,l,n,u;return za(Ra({path:{dataset_id:d},query:{...(t==null?void 0:t.filtered_labels)&&{filtered_labels:t.filtered_labels},...((a=t==null?void 0:t.dimensions)==null?void 0:a.min_width)&&{min_width:t.dimensions.min_width},...((l=t==null?void 0:t.dimensions)==null?void 0:l.max_width)&&{max_width:t.dimensions.max_width},...((n=t==null?void 0:t.dimensions)==null?void 0:n.min_height)&&{min_height:t.dimensions.min_height},...((u=t==null?void 0:t.dimensions)==null?void 0:u.max_height)&&{max_height:t.dimensions.max_height}}}))};var Xs=$("<div><!></div>"),Zs=$('<div class="space-y-2"><!> <!></div>'),er=$('<div class="flex w-80 flex-col space-y-6 rounded-[1vw] bg-card py-4"><div class="px-4"><!></div> <div class="min-h-0 flex-1 space-y-2 overflow-y-auto px-4 dark:[color-scheme:dark]"><div><!> <!></div> <!> <!></div></div>'),tr=$('<div class="relative"><!> <!></div>'),ar=$("<!> <!>",1),sr=$('<div class="flex h-full w-full space-x-4 px-4 pb-4"><!> <div class="flex1 flex flex-grow flex-col space-y-4 rounded-[1vw] bg-card p-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><!></div> <div class="w-4/12"><!></div></div> <!> <div class="flex min-h-0 flex-1"><!></div></div> <!> <!></div>');function Er(d,t){Oe(t,!0);const[a,l]=Ke(),n=()=>L(F,"$textEmbedding",a),u=()=>L(g,"$featureFlags",a),v=()=>L(De,"$annotationFilterLabels",a),y=()=>L(k,"$selectedAnnotationFilterIds",a),W=()=>L(Ce,"$dimensionsValues",a),E=()=>L(e(Se),"$annotationCounts",a),{datasetId:A,globalStorage:{setTextEmbedding:P,textEmbedding:F,setLastGridType:S,selectedAnnotationFilterIds:k}}=t.data,{handleKeyEvent:b}=Ia();Kt(()=>{window.addEventListener("keydown",b),window.addEventListener("keyup",b)}),Wt(()=>{window.removeEventListener("keydown",b),window.removeEventListener("keyup",b)}),Js({goBack:Qs.goBack});let f=Be("samples");Dt(()=>{He.url.pathname===Ge.toAnnotations(A)?M(f,"annotations"):He.url.pathname===Ge.toClassifiers(A)?M(f,"classifiers"):M(f,"samples"),S(e(f))});let x=Be(Re(n()?n().queryText:""));async function j(){if(e(x).trim()!=="")try{return(await Us({query_text:e(x),model_id:void 0})).data}catch(m){he(m.message),console.error("Error during API call:",m)}}async function Y(m){if(m.key==="Enter"){const c=await j();P({queryText:e(x),embedding:c||[]})}}const{featureFlags:g}=Ba(),N=p(()=>u().some(m=>m==="embeddingSearchEnabled")),V=p(()=>u().some(m=>m==="fewShotClassifierEnabled")),pe=p(()=>ta(He.route.id)),we=p(()=>aa(He.route.id)),T=p(()=>sa(He.route.id)),{dimensionsValues:Ce}=Jt(A),Pe=Ea(),De=Vt(Pe,m=>m.data?m.data.reduce((c,_)=>({...c,[_.annotation_label_name]:_.annotation_label_id}),{}):{}),me=p(()=>{const m=v(),c=Array.from(y());return Object.entries(m).filter(([,_])=>c.includes(_)).map(([_])=>_)}),te=(m,c)=>m.map(_=>({..._,selected:c.includes(_.label_name)})),Se=p(()=>Ys({datasetId:A,options:{filtered_labels:e(me).length>0?e(me):void 0,dimensions:W()}})),J=ia([]);Dt(()=>{const m=E().data;if(m){const c=te(m,e(me));J.set(c)}});const re=m=>{const c=Ze(De)[m];c&&k.update(_=>(_.has(c)?_.delete(c):_.add(c),_))},he=m=>{Fa.error("Error",{description:m})};var ke=U(),$e=C(ke);{var Te=m=>{var c=U(),_=C(c);Ye(_,()=>t.children),s(m,c)},Fe=m=>{var c=sr(),_=i(c);{var ce=w=>{var H=er(),O=i(H),D=i(O);Ja(D,{datasetId:A,get gridType(){return e(f)}}),o(O);var ue=r(O,2),G=i(ue),le=i(G);Vs(le,{dataset_id:A,get gridType(){return e(f)}});var Ie=r(le,2);zs(Ie,{datasetId:A,get gridType(){return e(f)}}),o(G);var _e=r(G,2);{var ge=ee=>{var ae=Xs(),ye=i(ae);Ma(ye,{}),o(ae),s(ee,ae)};se(_e,ee=>{e(f)==="samples"&&e(N)&&e(V)&&ee(ge)})}var be=r(_e,2);ht(be,{title:"Filters",icon:ts,children:(ee,ae)=>{var ye=Zs(),ze=i(ye);Ts(ze,{annotationFilters:J,onToggleAnnotationFilter:re});var Ee=r(ze,2);{var Le=qe=>{Ya(qe,{})};se(Ee,qe=>{e(f)==="samples"&&qe(Le)})}o(ye),s(ee,ye)}}),o(ue),o(H),s(w,H)};se(_,w=>{(e(f)==="samples"||e(f)==="annotations")&&w(ce)})}var I=r(_,2),Q=i(I),B=i(Q),xe=i(B);{var ne=w=>{var H=tr(),O=i(H);Aa(O,{class:"absolute left-2 top-[50%] h-4 w-4 translate-y-[-50%] text-muted-foreground"});var D=r(O,2);Ft(D,{placeholder:"Search",class:"pl-8",onkeydown:Y,"data-testid":"text-embedding-search-input",get value(){return e(x)},set value(ue){M(x,Re(ue))}}),o(H),s(w,H)};se(xe,w=>{e(f)==="samples"&&e(N)&&w(ne)})}o(B);var q=r(B,2),z=i(q);ws(z,{}),o(q),o(Q);var oe=r(Q,2);vt(oe,{class:"mb-4 bg-border-hard"});var ie=r(oe,2),Z=i(ie);Ye(Z,()=>t.children),o(ie),o(I);var Me=r(I,2);{var h=w=>{var H=ar(),O=C(H);bs(O,{});var D=r(O,2);Ks(D,{}),s(w,H)};se(Me,w=>{e(f)==="classifiers"&&e(N)&&e(V)&&w(h)})}var R=r(Me,2);gs(R,{}),o(c),s(m,c)};se($e,m=>{e(pe)||e(we)||e(T)?m(Te):m(Fe,!1)})}s(d,ke),Ne(),l()}export{Er as component,Ir as universal};
