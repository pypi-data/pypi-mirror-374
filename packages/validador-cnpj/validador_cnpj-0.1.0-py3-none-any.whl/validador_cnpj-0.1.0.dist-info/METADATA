Metadata-Version: 2.4
Name: validador-cnpj
Version: 0.1.0
Summary: UDFs PySpark para limpeza, reparo, normaliza√ß√£o e valida√ß√£o de CNPJ (num√©rico e alfanum√©rico).
Project-URL: Homepage, https://github.com/data-engineering-bp/validador-cnpj
Project-URL: Issues, https://github.com/data-engineering-bp/validador-cnpj/issues
Author-email: Yuri Arthur Ferreira Santana <yuriarthurf@gmail.com>
License: MIT
License-File: LICENSE
Keywords: brasil,cnpj,data-quality,databricks,pyspark,spark
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3 :: Only
Classifier: Programming Language :: Python :: Implementation :: CPython
Classifier: Topic :: Database :: Database Engines/Servers
Classifier: Topic :: Software Development :: Libraries
Requires-Python: >=3.8
Requires-Dist: pyspark<4.0,>=3.3
Description-Content-Type: text/markdown

Perfeito üëå. Aqui est√° o **README revisado** j√° com os ajustes que comentei (badges, links diretos, uniformiza√ß√£o das se√ß√µes, melhorias de navega√ß√£o).

````markdown
# validador-cnpj

[![PyPI version](https://img.shields.io/pypi/v/validador-cnpj.svg)](https://pypi.org/project/validador-cnpj/)
[![Python](https://img.shields.io/pypi/pyversions/validador-cnpj.svg)](https://pypi.org/project/validador-cnpj/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

UDFs **PySpark** para **limpeza, reparo, normaliza√ß√£o e valida√ß√£o** de CNPJ (num√©rico e alfanum√©rico).  
**Distribui√ß√£o (PyPI):** `validador-cnpj` ‚Ä¢ **Import (Python):** `validador_cnpj`

---

## Instala√ß√£o

```bash
pip install validador-cnpj
````

---

## Uso r√°pido (Spark)

```python
from validador_cnpj import padronizar_cnpj

df = spark.createDataFrame(
    [("12.345.678/0001-95",), ("12.ABC.345/01DE-35",), ("123456780001",)],
    ["cnpj_bruto"]
)

out = padronizar_cnpj(df, "cnpj_bruto", com_mascara=True)
display(out)
```

**Colunas geradas**:

* `cnpj14` ‚Äî 14 chars (12 base + 2 DV)
* `f_eh_valido` ‚Äî boolean
* `f_tipo` ‚Äî `"numerico"` | `"alfanumerico"` | `"desconhecido"`
* `cnpj_mascara` ‚Äî `AA.AAA.AAA/AAAA-DV` (quando v√°lido e `com_mascara=True`)
* `bruto_limpo` ‚Äî entrada higienizada (apenas A‚ÄìZ/0‚Äì9, mai√∫sculo)

---

## Principais recursos

* Aceita entradas **sujas** (m√°scaras, espa√ßos, s√≠mbolos, caixa mista).
* **Repara** casos com **falta**/**excesso** de caracteres (configur√°vel por estrat√©gia).
* **Valida DV** (m√≥dulo 11) para CNPJ **num√©rico e alfanum√©rico**.
* UDFs prontas para **PySpark** e fun√ß√£o pura para uso em Python/driver.

---

## API (Python)

```python
from validador_cnpj import (
    padronizar_cnpj,
    normalizar_cnpj_udf,
    cnpj_eh_valido_udf,
    tipo_cnpj_udf,
    mascarar_cnpj_udf,
)
```

### `padronizar_cnpj(df, coluna, *, coluna_saida="cnpj14", com_mascara=True, estrategia="flex_pad_esquerda") -> DataFrame`

Aplica limpeza/reparo/valida√ß√£o em lote e devolve colunas utilit√°rias.

Par√¢metros:

* `coluna` ‚Äî nome da coluna de entrada.
* `coluna_saida` ‚Äî nome da coluna com o CNPJ normalizado (14 chars).
* `com_mascara` ‚Äî adiciona `cnpj_mascara` quando v√°lido.
* `estrategia` ‚Äî `"rigorosa" | "flex_pad_esquerda" | "corte_direita"`.

### UDFs

* `normalizar_cnpj_udf(string) -> struct(cnpj14, eh_valido, tipo, mascarado)`
* `cnpj_eh_valido_udf(string) -> boolean`
* `tipo_cnpj_udf(string) -> string`
* `mascarar_cnpj_udf(string) -> string | null`

> Dica: use as UDFs quando quiser compor sua pr√≥pria transforma√ß√£o; use `padronizar_cnpj` para o caminho mais simples.

---

## Estrat√©gias de reparo

* **`rigorosa`** ‚Äî aceita apenas 12 ou 14 caracteres v√°lidos, sen√£o retorna `None`.
* **`flex_pad_esquerda`** *(padr√£o)* ‚Äî cobre truncamentos/legados comuns (completa √† esquerda, recalcula DV quando necess√°rio).
* **`corte_direita`** ‚Äî prioriza cortar √† direita (12 primeiros como base, tenta usar os 2 √∫ltimos como DV).

---

## Casos de uso pr√°ticos

1. Limpeza e valida√ß√£o em lote
2. Apenas checar se √© v√°lido
3. Identificar tipo (num√©rico x alfanum√©rico)
4. Aplicar m√°scara oficial somente se v√°lido
5. Usar estrat√©gia **rigorosa**
6. Preferir cortes √† direita
7. Compor manualmente com `normalizar_cnpj_udf`
8. **Exemplo em SQL (Databricks)**

```sql
-- Exemplo SQL
SELECT
  normalizar_cnpj(cnpj_bruto).cnpj14       AS cnpj14,
  normalizar_cnpj(cnpj_bruto).eh_valido    AS f_eh_valido,
  normalizar_cnpj(cnpj_bruto).tipo         AS f_tipo,
  normalizar_cnpj(cnpj_bruto).mascarado    AS cnpj_mascara
FROM tabela;
```

---

## Exemplos detalhados de entradas ‚Üí sa√≠das

| Entrada (`cnpj_bruto`)       | Estrat√©gia          | `cnpj14` (normalizado) |        `f_eh_valido`       | `f_tipo`       | Observa√ß√£o                                   |
| ---------------------------- | ------------------- | ---------------------: | :------------------------: | :------------- | -------------------------------------------- |
| `12.345.678/0001-95`         | qualquer            |       `12345678000195` |    :white\_check\_mark:    | `numerico`     | Formato cl√°ssico com m√°scara                 |
| `12.ABC.345/01DE-35`         | qualquer            |       `12ABC34501DE35` |    :white\_check\_mark:    | `alfanumerico` | Alfanum√©rico com m√°scara mista               |
| `123456780001`               | flex\_pad\_esquerda |       `123456780001??` | :white\_check\_mark:/ \:x: | `numerico`     | Faltam DVs ‚Üí calculados                      |
| `123`                        | flex\_pad\_esquerda |       `000000000123??` | :white\_check\_mark:/ \:x: | `numerico`     | Completa √† esquerda at√© 12 e calcula DV      |
| `00012345678000195`          | flex\_pad\_esquerda |       `12345678000195` |    :white\_check\_mark:    | `numerico`     | Excesso √† esquerda ‚Üí usa 12 anteriores ao DV |
| `12ABC34501DEXX`             | flex\_pad\_esquerda |       `12ABC34501DE??` | :white\_check\_mark:/ \:x: | `alfanumerico` | Lixo no fim, sem DV confi√°vel ‚Üí recalcula    |
| `12abc345/01de-35`           | qualquer            |       `12ABC34501DE35` |    :white\_check\_mark:    | `alfanumerico` | Caixa/s√≠mbolos higienizados                  |
| `foo 12.ABC.345/01DE-35 bar` | flex\_pad\_esquerda |       `12ABC34501DE35` |    :white\_check\_mark:    | `alfanumerico` | Texto ao redor ignorado                      |
| `A2345678000195`             | rigorosa            |                 `None` |             :x:            | `desconhecido` | 14 chars mas DV n√£o num√©rico ‚Üí rejeita       |
| `None` / vazio               | qualquer            |                 `None` |             :x:            | `desconhecido` | Valor nulo                                   |

---

## Boas pr√°ticas de performance

* Prefira `padronizar_cnpj` (uma passada) e **reutilize** as colunas derivadas.
* Filtre v√°lidos ap√≥s normalizar.
* Ajuste `estrategia` conforme a qualidade do dado.

---

## Tratamento de erros & decis√µes de neg√≥cio

A biblioteca **n√£o** toma decis√µes de neg√≥cio (ex.: descartar registros inv√°lidos).
Ela fornece sinais (`f_eh_valido`, `f_tipo`, `cnpj14`, `bruto_limpo`) para que **voc√™** defina as regras.

---

## Compatibilidade

* **Python**: 3.8+
* **PySpark**: 3.3 ‚Äì 3.x
* **Databricks**: testado em clusters 10.x/11.x/12.x (Spark 3.x)

---

## Altera√ß√µes recentes

Veja o [CHANGELOG.md](CHANGELOG.md).

---

## Licen√ßa

MIT

---

## Detalhes t√©cnicos

* C√°lculo de DV (m√≥dulo 11) aplic√°vel a CNPJ **num√©rico** e **alfanum√©rico**.
* M√°scara padr√£o: `AA.AAA.AAA/AAAA-DV`.

```