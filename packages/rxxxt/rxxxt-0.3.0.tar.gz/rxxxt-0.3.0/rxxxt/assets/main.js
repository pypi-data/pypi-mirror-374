(()=>{var be=Object.defineProperty;var te=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ne=(e,n,t)=>n in e?be(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,ae=(e,n)=>{for(var t in n||(n={}))ye.call(n,t)&&ne(e,t,n[t]);if(te)for(var t of te(n))we.call(n,t)&&ne(e,t,n[t]);return e};var re="rxxxt-on-",ie=()=>new Date().getTime(),se=new WeakMap;function $(e){var t,a,r;let n=se.get(e);return n===void 0&&(n=JSON.stringify([e.context_id,e.handler_name,(t=e.options.debounce)!=null?t:null,(a=e.options.prevent_default)!=null?a:null,(r=e.options.throttle)!=null?r:null,...Object.entries(e.param_map).sort((u,v)=>u[0].localeCompare(v[0]))]),se.set(e,n)),n}function xe(e){var t;let n=new Map;for(let a of e.getAttributeNames())if(a.startsWith(re)){let r=a.substring(re.length),u=JSON.parse(atob((t=e.getAttribute(a))!=null?t:""));n.set(r,u)}return n}function Se(e,n){let t=e;try{for(let a of n.split("."))t=t[a];return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:void 0}catch(a){return}}function oe(e){let n=0,t=new WeakMap,a=new WeakMap,r=new Map,u=l=>{var p,g,h,f,T;if(l.target!==null)for(let o of(g=(p=t.get(l.target))==null?void 0:p.filter(S=>S.event===l.type))!=null?g:[]){let S=ae({$handler_name:o.descriptor.handler_name},Object.fromEntries(Object.entries(o.descriptor.param_map).map(H=>[H[0],Se(l,H[1])])));r.set(o.submitId,{context_id:o.descriptor.context_id,data:S}),o.timeoutHandle&&(clearTimeout(o.timeoutHandle),o.timeoutHandle=void 0),o.descriptor.options.prevent_default&&l.preventDefault();let A=Math.max(0,(h=o.descriptor.options.debounce)!=null?h:0,((f=o.lastCall)!=null?f:0)+((T=o.descriptor.options.throttle)!=null?T:0)-ie());o.timeoutHandle=setTimeout(()=>{r.has(o.submitId)&&(o.lastCall=ie(),e())},A)}},v=l=>{var h,f,T;let p=(h=a.get(l))!=null?h:new Set;a.set(l,p);let g=new Set((T=(f=t.get(l))==null?void 0:f.map(o=>o.event))!=null?T:[]);for(let o of Array.from(p))g.has(o)||(l.removeEventListener(o,u),p.delete(o));for(let o of g)p.has(o)||(l.addEventListener(o,u),p.add(o))},w=()=>{let l=Array.from(r.values());return r.clear(),l},x=l=>{var h;let p=new Map(((h=t.get(l))!=null?h:[]).filter(f=>f.tag=="local").map(f=>[f.event,f])),g=xe(l);for(let f of p.values())g.has(f.event)||b(l,f.event,f.descriptor,"local");for(let f of g.entries())p.has(f[0])?p.get(f[0]).descriptor=f[1]:C(l,f[0],f[1],"local")},C=(l,p,g,h="global")=>{var S;let f=$(g),T=(S=t.get(l))!=null?S:[];t.set(l,T);let o=T.find(A=>A.event===p&&$(A.descriptor)===f&&A.tag==h);o===void 0?T.push({descriptor:g,event:p,submitId:++n,tag:h}):o.descriptor=g,v(l)},b=(l,p,g,h="global")=>{var T;let f=$(g);t.set(l,((T=t.get(l))!=null?T:[]).filter(o=>o.event!=p||$(o.descriptor)!==f||o.tag!==h)),v(l)};return{registerEvent:C,unregisterEvent:b,updateEvents:x,popPendingEvents:w}}function le(e){let n,t=!1,a=!1,r=!1,u,v=()=>{if(t){a=!0;return}t=!0,a=!1,u(e.popPendingEvents())},w=(b,l)=>{e.onUpdate(b,l),t=!1,a&&v()},x=()=>{n==null||n.close(),n=void 0,u=async b=>{var p;let l=await fetch(location.href,{method:"POST",body:JSON.stringify({state_token:e.stateToken,events:b}),headers:{"Content-Type":"application/json"},credentials:"include"}).then(g=>g.json());w(l.html_parts,l.events),e.stateToken=(p=l.state_token)!=null?p:e.stateToken}},C=()=>{if(n!==void 0){console.warn("tried to switch to websocket again, despite using it already");return}let b=async p=>n==null?void 0:n.send(JSON.stringify({type:"update",events:p,location:location.href.substring(location.origin.length)})),l=new URL(location.href);l.protocol=location.protocol=="https:"?"wss":"ws",n=new WebSocket(l),n.addEventListener("close",x),n.addEventListener("open",()=>{u=b,n==null||n.send(JSON.stringify({type:"init",state_token:e.stateToken,enable_state_updates:e.enableWebSocketStateUpdates}))}),n.addEventListener("message",p=>{var h;if(typeof p.data!="string")return;let g=JSON.parse(p.data);e.stateToken=(h=g.state_token)!=null?h:e.stateToken,w(g.html_parts,g.events)})};return x(),{useHTTP:x,useWebSocket:C,update:()=>{r||(r=!0,setTimeout(()=>{r=!1,v()},0))}}}var de=11;function Ae(e,n){var t=n.attributes,a,r,u,v,w;if(!(n.nodeType===de||e.nodeType===de)){for(var x=t.length-1;x>=0;x--)a=t[x],r=a.name,u=a.namespaceURI,v=a.value,u?(r=a.localName||r,w=e.getAttributeNS(u,r),w!==v&&(a.prefix==="xmlns"&&(r=a.name),e.setAttributeNS(u,r,v))):(w=e.getAttribute(r),w!==v&&e.setAttribute(r,v));for(var C=e.attributes,b=C.length-1;b>=0;b--)a=C[b],r=a.name,u=a.namespaceURI,u?(r=a.localName||r,n.hasAttributeNS(u,r)||e.removeAttributeNS(u,r)):n.hasAttribute(r)||e.removeAttribute(r)}}var j,Ce="http://www.w3.org/1999/xhtml",y=typeof document>"u"?void 0:document,Oe=!!y&&"content"in y.createElement("template"),Ue=!!y&&y.createRange&&"createContextualFragment"in y.createRange();function ke(e){var n=y.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}function Ne(e){j||(j=y.createRange(),j.selectNode(y.body));var n=j.createContextualFragment(e);return n.childNodes[0]}function Ie(e){var n=y.createElement("body");return n.innerHTML=e,n.childNodes[0]}function _e(e){return e=e.trim(),Oe?ke(e):Ue?Ne(e):Ie(e)}function F(e,n){var t=e.nodeName,a=n.nodeName,r,u;return t===a?!0:(r=t.charCodeAt(0),u=a.charCodeAt(0),r<=90&&u>=97?t===a.toUpperCase():u<=90&&r>=97?a===t.toUpperCase():!1)}function De(e,n){return!n||n===Ce?y.createElement(e):y.createElementNS(n,e)}function Pe(e,n){for(var t=e.firstChild;t;){var a=t.nextSibling;n.appendChild(t),t=a}return n}function Y(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var ue={OPTION:function(e,n){var t=e.parentNode;if(t){var a=t.nodeName.toUpperCase();a==="OPTGROUP"&&(t=t.parentNode,a=t&&t.nodeName.toUpperCase()),a==="SELECT"&&!t.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}Y(e,n,"selected")},INPUT:function(e,n){Y(e,n,"checked"),Y(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var a=e.firstChild;if(a){var r=a.nodeValue;if(r==t||!t&&r==e.placeholder)return;a.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t=-1,a=0,r=e.firstChild,u,v;r;)if(v=r.nodeName&&r.nodeName.toUpperCase(),v==="OPTGROUP")u=r,r=u.firstChild;else{if(v==="OPTION"){if(r.hasAttribute("selected")){t=a;break}a++}r=r.nextSibling,!r&&u&&(r=u.nextSibling,u=null)}e.selectedIndex=t}}},L=1,pe=11,ce=3,fe=8;function N(){}function He(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Le(e){return function(t,a,r){if(r||(r={}),typeof a=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var u=a;a=y.createElement("html"),a.innerHTML=u}else a=_e(a);else a.nodeType===pe&&(a=a.firstElementChild);var v=r.getNodeKey||He,w=r.onBeforeNodeAdded||N,x=r.onNodeAdded||N,C=r.onBeforeElUpdated||N,b=r.onElUpdated||N,l=r.onBeforeNodeDiscarded||N,p=r.onNodeDiscarded||N,g=r.onBeforeElChildrenUpdated||N,h=r.skipFromChildren||N,f=r.addChild||function(i,s){return i.appendChild(s)},T=r.childrenOnly===!0,o=Object.create(null),S=[];function A(i){S.push(i)}function H(i,s){if(i.nodeType===L)for(var m=i.firstChild;m;){var d=void 0;s&&(d=v(m))?A(d):(p(m),m.firstChild&&H(m,s)),m=m.nextSibling}}function M(i,s,m){l(i)!==!1&&(s&&s.removeChild(i),p(i),H(i,m))}function G(i){if(i.nodeType===L||i.nodeType===pe)for(var s=i.firstChild;s;){var m=v(s);m&&(o[m]=s),G(s),s=s.nextSibling}}G(t);function J(i){x(i);for(var s=i.firstChild;s;){var m=s.nextSibling,d=v(s);if(d){var c=o[d];c&&F(s,c)?(s.parentNode.replaceChild(c,s),W(c,s)):J(s)}else J(s);s=m}}function he(i,s,m){for(;s;){var d=s.nextSibling;(m=v(s))?A(m):M(s,i,!0),s=d}}function W(i,s,m){var d=v(s);if(d&&delete o[d],!m){var c=C(i,s);if(c===!1||(c instanceof HTMLElement&&(i=c,G(i)),e(i,s),b(i),g(i,s)===!1))return}i.nodeName!=="TEXTAREA"?Te(i,s):ue.TEXTAREA(i,s)}function Te(i,s){var m=h(i,s),d=s.firstChild,c=i.firstChild,_,O,D,B,U;e:for(;d;){for(B=d.nextSibling,_=v(d);!m&&c;){if(D=c.nextSibling,d.isSameNode&&d.isSameNode(c)){d=B,c=D;continue e}O=v(c);var K=c.nodeType,k=void 0;if(K===d.nodeType&&(K===L?(_?_!==O&&((U=o[_])?D===U?k=!1:(i.insertBefore(U,c),O?A(O):M(c,i,!0),c=U,O=v(c)):k=!1):O&&(k=!1),k=k!==!1&&F(c,d),k&&W(c,d)):(K===ce||K==fe)&&(k=!0,c.nodeValue!==d.nodeValue&&(c.nodeValue=d.nodeValue))),k){d=B,c=D;continue e}O?A(O):M(c,i,!0),c=D}if(_&&(U=o[_])&&F(U,d))m||f(i,U),W(U,d);else{var q=w(d);q!==!1&&(q&&(d=q),d.actualize&&(d=d.actualize(i.ownerDocument||y)),f(i,d),J(d))}d=B,c=D}he(i,c,O);var ee=ue[i.nodeName];ee&&ee(i,s)}var E=t,V=E.nodeType,Z=a.nodeType;if(!T){if(V===L)Z===L?F(t,a)||(p(t),E=Pe(t,De(a.nodeName,a.namespaceURI))):E=a;else if(V===ce||V===fe){if(Z===V)return E.nodeValue!==a.nodeValue&&(E.nodeValue=a.nodeValue),E;E=a}}if(E===a)p(t);else{if(a.isSameNode&&a.isSameNode(E))return;if(W(E,a,T),S)for(var X=0,Ee=S.length;X<Ee;X++){var z=o[S[X]];z&&M(z,z.parentNode,!1)}}return!T&&E!==t&&t.parentNode&&(E.actualize&&(E=E.actualize(t.ownerDocument||y)),t.parentNode.replaceChild(E,t)),E}}var Re=Le(Ae),ve=Re;var Me="root",I,ge={stateToken:"",enableWebSocketStateUpdates:!1,onUpdate:(e,n)=>{for(let t of e)me(t);Q(n)},popPendingEvents:()=>P.popPendingEvents()},R=le(ge),P=oe(R.update),me=e=>{let n;if(e===void 0){let t=document.getElementById(Me);if(t===null)throw new Error("Update target not found!");n=t}else{let t=document.createElement("div");t.innerHTML=e;let a=t.children.item(0);if(a===null||a.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let r=document.getElementById(a.id);if(r===null)throw new Error("Update target not found!");n=r,ve(n,a)}for(let t of n.getElementsByTagName("*"))P.updateEvents(t)},We={navigate:e=>{let n=new URL(e.location,location.href);I===void 0||I.origin!==n.origin||!n.pathname.startsWith(I.pathname)?location.assign(n):window.history.pushState({},"",e.location)},"use-websocket":e=>{e.websocket?R.useWebSocket():R.useHTTP()},"set-cookie":e=>{var t;let n=["".concat(e.name,"=").concat((t=e.value)!=null?t:"")];typeof e.path=="string"&&n.push("path=".concat(e.path)),typeof e.expires=="string"&&n.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&n.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&n.push("domain=".concat(e.domain)),e.secure&&n.push("secure"),e.http_only&&n.push("httponly"),document.cookie=n.join(";")},"event-modify-window":e=>{e.mode==="add"?P.registerEvent(window,e.name,e.descriptor):e.mode==="remove"&&P.unregisterEvent(window,e.name,e.descriptor)},"event-modify-query-selector":e=>{let n;if(e.all)n=Array.from(document.querySelectorAll(e.selector));else{let t=document.querySelector(e.selector);n=t===null?[]:[t]}for(let t of n)e.mode==="add"?P.registerEvent(t,e.name,e.descriptor):e.mode==="remove"&&P.unregisterEvent(t,e.name,e.descriptor)}},Q=e=>e.forEach(n=>We[n.event](n));window.rxxxt={navigate:e=>{Q([{event:"navigate",location:new URL(e,location.href).href}]),R.update()},init:e=>{I=new URL(location.href),I.pathname.endsWith(e.path)?I.pathname=I.pathname.slice(0,I.pathname.length-e.path.length):console.warn("Invalid base url!"),window.addEventListener("popstate",R.update),ge.stateToken=e.state_token,Q(e.events),me()}};})();
