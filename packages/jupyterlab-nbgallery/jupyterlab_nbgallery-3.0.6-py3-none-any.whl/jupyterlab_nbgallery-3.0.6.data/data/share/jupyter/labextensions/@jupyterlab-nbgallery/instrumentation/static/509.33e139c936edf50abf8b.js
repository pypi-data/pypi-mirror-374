"use strict";(self.webpackChunk_jupyterlab_nbgallery_instrumentation=self.webpackChunk_jupyterlab_nbgallery_instrumentation||[]).push([[509],{509:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var l=n(10),o=n(397),i=n(980),a=n(795),r=n(14),s=n(76),c=n.n(s);let u=null;const d={id:"@juptyerlab-nbgallery/instrumentation",autoStart:!0,requires:[l.ISettingRegistry],activate:async(e,t)=>{let n={},l=!1;i.NotebookActions.executionScheduled.connect((e,t)=>{if(l){let e,l;l=t.notebook,e=t.cell;const o=new Date;n[e.id]=new Object,n[e.id].startTime=o.getTime(),n[e.id].cellIndex=l.activeCellIndex,console.log(e)}}),i.NotebookActions.executed.connect((o,i)=>{const{cell:s,notebook:d,success:g}=i;if(l&&s instanceof a.CodeCell){const l=new Date;console.log("Post execution"),Promise.all([e.restored,t.load("@jupyterlab-nbgallery/environment-registration:environment-registration")]).then(([,e])=>{!function(e,t,n,l,o){let i;if(i=e.model.sharedModel.metadata.gallery,i){let a=new Object;a.success=n,a.md5=r.Md5.hashStr(t.model.sharedModel.source),a.runtime=l,a.uuid=i.uuid||i.link||i.clone;let s=i.gallery_url;s||(s=o.get("nbgallery_url").composite),s||(s=u),console.log(s),s.length>0&&a.uuid.length>0&&c().ajax({method:"POST",headers:{Accept:"application/json"},url:s+"/executions",data:a,xhrFields:{withCredentials:!0}}),console.log("Made it here"+e+t+n+l),console.log(i.uuid)}}(d,s,g,l.getTime()-n[s.id].startTime,e)})}}),Promise.all([e.restored,t.load("@jupyterlab-nbgallery/instrumentation:instrumentation")]).then(([,e])=>{try{!function(e){c().ajax({method:"GET",headers:{Accept:"application/json"},url:o.PageConfig.getBaseUrl()+"jupyterlab_nbgallery/instrumentation",cache:!1,xhrFields:{withCredentials:!0},success:function(t){u=t.NBGALLERY_URL,1==t.NBGALLERY_ENABLE_INSTRUMENTATION||e.get("enabled").composite?(e.set("enabled",!0),l=!0):l=!1}})}(e)}catch(e){console.error(`Problem initializing instrumentation \n ${e}`)}})}}}}]);