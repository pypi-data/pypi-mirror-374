Metadata-Version: 2.4
Name: nonebot-plugin-distributed-blacklist
Version: 1.0.5
Summary: åŸºäºPostgreSQLçš„åˆ†å¸ƒå¼é»‘åå•ç³»ç»Ÿ
Home-page: https://github.com/your-repo/nonebot-plugin-distributed-blacklist
Author: Tosd0
Author-email: Tosd0 <tntobsidian@126.com>
License: LGPL-3.0
Project-URL: Homepage, https://github.com/Tosd0/nonebot-plugin-distributed-blacklist
Project-URL: Repository, https://github.com/Tosd0/nonebot-plugin-distributed-blacklist
Project-URL: Documentation, https://github.com/Tosd0/nonebot-plugin-distributed-blacklist
Project-URL: Issues, https://github.com/Tosd0/nonebot-plugin-distributed-blacklist/issues
Keywords: nonebot,blacklist,distributed,postgresql
Classifier: License :: OSI Approved :: GNU Lesser General Public License v3 (LGPLv3)
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.9
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: nonebot2<3.0.0,>=2.3.0
Requires-Dist: nonebot-adapter-onebot>=2.3.0
Requires-Dist: nonebot-plugin-apscheduler>=0.5.0
Requires-Dist: nonebot-plugin-localstore>=0.6.0
Requires-Dist: asyncpg>=0.28.0
Requires-Dist: pydantic>=1.10.0
Provides-Extra: dev
Requires-Dist: pytest; extra == "dev"
Requires-Dist: pytest-asyncio; extra == "dev"
Requires-Dist: black; extra == "dev"
Requires-Dist: isort; extra == "dev"
Requires-Dist: flake8; extra == "dev"
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-python

# NoneBot åˆ†å¸ƒå¼é»‘åå•æ’ä»¶

âœ¨ åŸºäº PostgreSQL çš„åˆ†å¸ƒå¼é»‘åå•ç³»ç»Ÿï¼Œæ”¯æŒå¤šå®¢æˆ·ç«¯åå•åŒæ­¥ âœ¨

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½å†…å­˜ç¼“å­˜**: ä½¿ç”¨é«˜æ•ˆçš„äºŒå‰æ ‘ç»“æ„å®ç°æ¯«ç§’çº§é»‘åå•æ£€æŸ¥ï¼Œè‡ªåŠ¨ç¼“å­˜å…·æœ‰ç®¡ç†æƒé™çš„ç¾¤ç»„é¿å…æ— æ„ä¹‰APIè°ƒç”¨
- ğŸŒ **åˆ†å¸ƒå¼æ¶æ„**: åŸºäº PostgreSQL çš„ä¸­å¿ƒåŒ–æ•°æ®å­˜å‚¨ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²
- âš¡ **å®æ—¶åŒæ­¥**: è‡ªåŠ¨åŒæ­¥é»‘åå•å˜æ›´ï¼Œåå†™å…¥è€…èƒœï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ä¸€è‡´
- ğŸ›¡ï¸ **è‡ªåŠ¨é˜²æŠ¤**: å®šæ—¶æ£€æŸ¥ç¾¤æˆå‘˜ï¼Œè‡ªåŠ¨è¸¢å‡ºé»‘åå•ç”¨æˆ·
- ğŸ“Š **æ“ä½œæ—¥å¿—**: å®Œæ•´çš„æ“ä½œè®°å½•å’Œç‰ˆæœ¬æ§åˆ¶

## ç³»ç»Ÿæ¶æ„

æœ¬æ’ä»¶é‡‡ç”¨**Hub-and-Spoke**ï¼ˆä¸­å¿ƒè¾å°„ï¼‰æ¶æ„ï¼š

- **Hubï¼ˆä¸­å¿ƒèŠ‚ç‚¹ï¼‰**: PostgreSQL æ•°æ®åº“ï¼Œä½œä¸ºå”¯ä¸€æ•°æ®æº
- **Spokeï¼ˆè¾¹ç¼˜èŠ‚ç‚¹ï¼‰**: å„ä¸ª NoneBot å®ä¾‹ï¼Œç»´æŠ¤æœ¬åœ°é«˜é€Ÿç¼“å­˜

```
         PostgreSQL Hub
              |
    +---------+---------+
    |         |         |
  Bot A     Bot B     Bot C
 (Cache)   (Cache)   (Cache)
```

## ğŸ’¿ å®‰è£…

<details open>
<summary>ä½¿ç”¨ nb-cli å®‰è£…</summary>
åœ¨ nonebot2 é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œ, è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤å³å¯å®‰è£…

    nb plugin install nonebot-plugin-distributed-blacklist

</details>

<details>
<summary>ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…</summary>
åœ¨ nonebot2 é¡¹ç›®çš„æ’ä»¶ç›®å½•ä¸‹, æ‰“å¼€å‘½ä»¤è¡Œ, æ ¹æ®ä½ ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨, è¾“å…¥ç›¸åº”çš„å®‰è£…å‘½ä»¤

<details>
<summary>pip</summary>

    pip install nonebot-plugin-distributed-blacklist
</details>
<details>
<summary>pdm</summary>

    pdm add nonebot-plugin-distributed-blacklist
</details>
<details>
<summary>poetry</summary>

    poetry add nonebot-plugin-distributed-blacklist
</details>
<details>
<summary>conda</summary>

    conda install nonebot-plugin-distributed-blacklist
</details>

æ‰“å¼€ nonebot2 é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `pyproject.toml` æ–‡ä»¶, åœ¨ `[tool.nonebot]` éƒ¨åˆ†è¿½åŠ å†™å…¥

    plugins = ["nonebot_plugin_distributed_blacklist"]

</details>

## ğŸ“Š æ•°æ®åº“é…ç½®

æœ¬æ’ä»¶ä½¿ç”¨ PostgreSQL æ•°æ®åº“ã€‚åœ¨é¦–æ¬¡è¿è¡Œå‰ï¼Œä½ éœ€è¦å®Œæˆæ•°æ®åº“çš„åˆå§‹åŒ–ã€‚

### 1. åˆ›å»ºæ•°æ®åº“

é¦–å…ˆï¼Œè¯·åœ¨ä½ çš„ PostgreSQL æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ã€‚å‘½ä»¤è¡Œç¤ºæ„ï¼š

```bash
psql -U blacklist_user
CREATE DATABASE distributed_blacklist OWNER blacklist_user;
\q
```

### 2. åˆå§‹åŒ–è„šæœ¬

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåˆå§‹åŒ–è„šæœ¬ `init_db.sql` æ¥ä¸ºä½ åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„æ•°æ®è¡¨å’Œç´¢å¼•ã€‚è¯·ä½¿ç”¨ `psql` å‘½ä»¤è¡Œå·¥å…·æ¥æ‰§è¡Œå®ƒã€‚

è¿™æ˜¯æœ€æ¨èçš„æ–¹å¼ï¼š

```bash
psql -U blacklist_user -d distributed_blacklist -f /path/to/your/init_db.sql
```

æ‰§è¡ŒæˆåŠŸä¸”æ²¡æœ‰æŠ¥é”™ï¼Œåˆ™ä½ çš„æ•°æ®åº“å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥é…ç½®æ’ä»¶å¹¶å¯åŠ¨ä½ çš„æœºå™¨äººäº†ã€‚

## âš™ï¸ é…ç½®

åœ¨ NoneBot é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

| é…ç½®é¡¹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|:-----:|:----:|:----:|:----:|
| `superusers` | å¦ | [] | è¸¢äººåä¼šç§ä¿¡ä¸ŠæŠ¥ SUPERUSERS |
| `distributed_blacklist_db_host` | æ˜¯ | localhost | PostgreSQL æœåŠ¡å™¨åœ°å€ |
| `distributed_blacklist_db_port` | å¦ | 5432 | PostgreSQL ç«¯å£ |
| `distributed_blacklist_db_name` | æ˜¯ | blacklist | æ•°æ®åº“åç§° |
| `distributed_blacklist_db_user` | æ˜¯ | blacklist | æ•°æ®åº“ç”¨æˆ·å |
| `distributed_blacklist_db_password` | æ˜¯ | æ—  | æ•°æ®åº“å¯†ç  |
| `distributed_blacklist_admins` | å¦ | [] | é»‘åå•ç®¡ç†å‘˜QQå·åˆ—è¡¨ |
| `distributed_blacklist_sync_interval` | å¦ | 300 | åŒæ­¥é—´éš”ï¼ˆç§’ï¼‰ |
| `distributed_blacklist_kick_check_interval` | å¦ | 3600 | è¸¢äººæ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ |
| `distributed_blacklist_db_max_connections` | å¦ | 10 | æœ€å¤§æ•°æ®åº“è¿æ¥æ•° |
| `distributed_blacklist_db_min_connections` | å¦ | 2 | æœ€å°æ•°æ®åº“è¿æ¥æ•° |
| `distributed_blacklist_enable_auto_kick` | å¦ | true | å¯ç”¨å®šæ—¶è¸¢äººåŠŸèƒ½ |
| `distributed_blacklist_debug_mode` | å¦ | false | è°ƒè¯•æ¨¡å¼ï¼Œå¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡º |
| `distributed_blacklist_check_global` | å¦ | false | é˜»æ–­é»‘åå•ç”¨æˆ·æŒ‡ä»¤ |

### é…ç½®ç¤ºä¾‹

```dotenv
# .env æ–‡ä»¶
DISTRIBUTED_BLACKLIST_DB_HOST=your_database_host
DISTRIBUTED_BLACKLIST_DB_PORT=5432
DISTRIBUTED_BLACKLIST_DB_NAME=blacklist
DISTRIBUTED_BLACKLIST_DB_USER=blacklist
DISTRIBUTED_BLACKLIST_DB_PASSWORD=your_password
DISTRIBUTED_BLACKLIST_ADMINS=[123456789, 987654321]  # ç®¡ç†å‘˜QQå·åˆ—è¡¨

DISTRIBUTED_BLACKLIST_CHECK_GLOBAL=true
DISTRIBUTED_BLACKLIST_ENABLE_AUTO_KICK=true
DISTRIBUTED_BLACKLIST_SYNC_INTERVAL=300
DISTRIBUTED_BLACKLIST_KICK_CHECK_INTERVAL=3600
DISTRIBUTED_BLACKLIST_DEBUG_MODE=false
```

## ğŸ‰ ä½¿ç”¨

### æŒ‡ä»¤è¡¨

ä»¥ä¸‹æŒ‡ä»¤é»˜è®¤éƒ½éœ€è¦å‘½ä»¤å‰ç¼€ï¼Œè¯·æ ¹æ®è‡ªå·±çš„è®¾ç½®æ·»åŠ å‘½ä»¤å‰ç¼€ï¼Œä¸‹ç•¥ã€‚

| æŒ‡ä»¤ | åˆ«å | æƒé™ | èŒƒå›´ | è¯´æ˜ |
|:---:|:---:|:---:|:---:|:---:|
| `æ·»åŠ é»‘åå• <QQå·> [åŸå› ]` | `åŠ é»‘`, `ä¸Šé»‘`, `åŠ é»‘åå•` | `SUPERUSER` æˆ– `DISTRIBUTED_BLACKLIST_ADMINS` | ç¾¤èŠ æˆ– ç§èŠ | æ·»åŠ ç”¨æˆ·åˆ°é»‘åå• |
| `åˆ é™¤é»‘åå• <QQå·>` | `åˆ é»‘`, `ä¸‹é»‘`, `åˆ é»‘åå•` | `SUPERUSER` æˆ– `DISTRIBUTED_BLACKLIST_ADMINS` | ç¾¤èŠ æˆ– ç§èŠ | ä»é»‘åå•ç§»é™¤ç”¨æˆ· |
| `æœç´¢é»‘åå• <QQå·>` | `æŸ¥é»‘`, `æŸ¥è¯¢é»‘åå•`, `æŸ¥æ‰¾é»‘åå•` | `SUPERUSER` æˆ– `DISTRIBUTED_BLACKLIST_ADMINS` | ç¾¤èŠ æˆ– ç§èŠ | æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦åœ¨é»‘åå•ä¸­ |
| `åŒæ­¥é»‘åå•` | æ—  | `SUPERUSER` æˆ– `DISTRIBUTED_BLACKLIST_ADMINS` | ç¾¤èŠ æˆ– ç§èŠ | æ‰‹åŠ¨è§¦å‘é»‘åå•åŒæ­¥ |

### ä½¿ç”¨è¯´æ˜

æ’ä»¶ä¼šåœ¨æ¯æ¬¡å¯åŠ¨çš„ç¬¬ä¸€æ¬¡è§¦å‘è¸¢äººæ—¶ï¼Œæ£€æŸ¥æ‰€æœ‰æ‰€åœ¨ç¾¤çš„æƒé™ã€‚åç»­åªä»æœºå™¨äººæ˜¯ç®¡ç†æˆ–ç¾¤ä¸»çš„ç¾¤æ£€æŸ¥é»‘åå•ã€‚è‹¥åœ¨æœºå™¨äººå·²ç»ç¼“å­˜ç®¡ç†æ•°æ®åæ‰ç»™æœºå™¨äººç®¡ç†ï¼Œåˆ™éœ€è¦é‡å¯`Nonebot`å¹¶é‡æ–°è§¦å‘è¸¢äººæµç¨‹ã€‚

é»‘åå•æ•°æ®ä½¿ç”¨å¢é‡åŒæ­¥ï¼Œè‹¥å¢é‡åŒæ­¥å‡ºç°é—®é¢˜ï¼Œè¯·åˆ é™¤`LocalStore`æä¾›çš„æ’ä»¶æ•°æ®ç›®å½•ä¸‹çš„`blacklist_data.json`ã€‚

åªæœ‰ SUPERUSERS å’Œ DISTRIBUTED_BLACKLIST_ADMINS é‡Œè®¾ç½®çš„è§’è‰²æ‰å¯ä»¥ä½¿ç”¨é»‘åå•ç›¸å…³åŠŸèƒ½ã€‚ä½†åœ¨è¸¢äººå®Œæ¯•åï¼ŒBot åªä¼šå‘ SUPERUSERS å‘é€æŠ¥å¤‡é€šçŸ¥ã€‚

### ä½¿ç”¨ç¤ºä¾‹

```
# æ·»åŠ é»‘åå•
æ·»åŠ é»‘åå• 123456789 æ¶æ„åˆ·å±

# åˆ é™¤é»‘åå•
åˆ é™¤é»‘åå• 123456789

# æœç´¢é»‘åå•
æœç´¢é»‘åå• 123456789

# åŒæ­¥é»‘åå•
åŒæ­¥é»‘åå•
```

## æ•ˆæœå›¾
<img width="1158" height="614" alt="image" src="https://github.com/user-attachments/assets/a344d119-7c2f-47a7-a4db-90816d24d909" />
<img width="478" height="242" alt="image" src="https://github.com/user-attachments/assets/f7bf432a-eb5b-4f12-b1e0-52f2bf344e59" />

## ğŸ“„ è®¸å¯è¯

LGPLv3

## è‡´è°¢

- æ„Ÿè°¢ [nonebot-plugin-easy-blacklist](https://github.com/bingqiu456/nonebot-plugin-easy-blacklist) æä¾›é»‘åå•éƒ¨åˆ†é€»è¾‘å®ç°
