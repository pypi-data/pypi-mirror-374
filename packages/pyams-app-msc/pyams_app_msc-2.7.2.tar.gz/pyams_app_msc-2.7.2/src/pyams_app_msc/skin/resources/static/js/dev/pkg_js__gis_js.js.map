{"version":3,"file":"pkg_js__gis_js.js","mappings":"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","sources":["webpack://pyams_app_msc/./pkg/js/_gis.js"],"sourcesContent":["import MyAMS from \"./_utils\";\n\n\nconst createMap = (map, config, options, callback) => {\n\n\treturn new Promise((resolve, reject) => {\n\n\t\tconst data = map.data();\n\t\tlet settings = {\n\t\t\tpreferCanvas: data.mapLeafletPreferCanvas || false,\n\t\t\tattributionControl: data.mapLeafletAttributionControl === undefined ?\n\t\t\t\tconfig.attributionControl : data.mapLeafletAttributionControl,\n\t\t\tzoomControl: data.mapLeafletZoomControl === undefined ?\n\t\t\t\tconfig.zoomControl : data.mapLeafletZoomControl,\n\t\t\tfullscreenControl: data.mapLeafletFullscreen === undefined ?\n\t\t\t\tconfig.fullscreenControl && {\n\t\t\t\t\tpseudoFullscreen: true\n\t\t\t\t} || null :\n\t\t\t\tdata.mapLeafletFullscreen,\n\t\t\tcrs: data.mapLeafletCrs || MyAMS.getObject(config.crs) || L.CRS.EPSG3857,\n\t\t\tcenter: data.mapLeafletCenter || config.center,\n\t\t\tzoom: data.mapLeafletZoom || config.zoom,\n\t\t\tgestureHandling: data.mapLeafletWheelZoom === undefined ?\n\t\t\t\t!config.scrollWheelZoom : data.mapLeafletWheelZoom,\n\t\t\tkeyboard: data.mapLeafletKeyboard === undefined ?\n\t\t\t\tconfig.keyboard && !L.Browser.mobile : data.amsLeafletKeyboard\n\t\t};\n\t\tsettings = $.extend({}, settings, options);\n\t\tmap.trigger('map.init', [map, settings, config]);\n\t\tconst\n\t\t\tleafmap = L.map(map.attr('id'), settings),\n\t\t\tlayersConfig = [],\n\t\t\tbaseLayers = {},\n\t\t\toverlayLayers = {};\n\t\tif (config.layers) {\n\t\t\tfor (const layerConfig of config.layers) {\n\t\t\t\tmap.trigger('map.layer.init', [map, layerConfig]);\n\t\t\t\tlayersConfig.push(PyAMS_GIS.getLayer(map, leafmap, layerConfig));\n\t\t\t}\n\t\t} else {\n\t\t\tlayersConfig.push(L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n\t\t\t\tname: 'osm',\n\t\t\t\ttitle: 'OpenStreetMap',\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tattribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n\t\t\t}));\n\t\t}\n\t\t$.when.apply($, layersConfig).then((...layers) => {\n\t\t\tfor (const [idx, layer] of Object.entries(layers)) {\n\t\t\t\tif (config.layers) {\n\t\t\t\t\tif (config.layers[idx].isVisible) {\n\t\t\t\t\t\tlayer.addTo(leafmap);\n\t\t\t\t\t}\n\t\t\t\t\tif (config.layers[idx].isOverlay) {\n\t\t\t\t\t\toverlayLayers[config.layers[idx].title] = layer;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbaseLayers[config.layers[idx].title] = layer;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlayer.addTo(leafmap);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (config.zoomControl && (data.mapLeafletHideZoomControl !== true)) {\n\t\t\t\tL.control.scale().addTo(leafmap);\n\t\t\t}\n\t\t\tif (config.layerControl) {\n\t\t\t\tL.control.layers(baseLayers, overlayLayers).addTo(leafmap);\n\t\t\t}\n\t\t\tif (config.center) {\n\t\t\t\tleafmap.setView(new L.LatLng(config.center.lat, config.center.lon),\n\t\t\t\t\tconfig.zoom || 13);\n\t\t\t} else if (config.bounds) {\n\t\t\t\tleafmap.fitBounds(config.bounds);\n\t\t\t}\n\t\t\tif (config.marker) {\n\t\t\t\tconst icon = L.icon({\n\t\t\t\t\ticonUrl: '/--static--/pyams_gis/img/marker-icon.png',\n\t\t\t\t\ticonSize: [25, 41],\n\t\t\t\t\ticonAnchor: [12, 39]\n\t\t\t\t});\n\t\t\t\tconst marker = L.marker();\n\t\t\t\tmarker.setIcon(icon);\n\t\t\t\tmarker.setLatLng({\n\t\t\t\t\tlon: config.marker.lon,\n\t\t\t\t\tlat: config.marker.lat\n\t\t\t\t});\n\t\t\t\tmarker.addTo(leafmap);\n\t\t\t}\n\t\t\tmap.data('leafmap', leafmap);\n\t\t\tmap.data('leafmap.config', config);\n\t\t\tmap.data('leafmap.layers', layers.reduce((res, layer) => ({\n\t\t\t\t...res,\n\t\t\t\t[layer.options.name]: layer\n\t\t\t}), {}));\n\t\t\tmap.trigger('map.finishing', [map, leafmap, config]);\n\t\t\tif (callback) {\n\t\t\t\tcallback(leafmap, config);\n\t\t\t}\n\t\t\tmap.trigger('map.finished', [map, leafmap, config]);\n\t\t\tresolve(leafmap);\n\t\t});\n\t});\n};\n\n\nconst PyAMS_GIS = {\n\n\t/**\n\t * Map initialization\n\t *\n\t * @param maps: maps elements\n\t * @param options: optional maps configuration settings\n\t * @param callback: maps initialization callback\n\t */\n\tinit: (maps, options, callback) => {\n\n\t\twindow.PyAMS_GIS = PyAMS_GIS;\n\t\tPromise.all([\n\t\t\timport('leaflet'),\n\t\t\timport(\"leaflet/dist/leaflet.css\")\n\t\t]).then(() => {\n\t\t\tPromise.all([\n\t\t\t\timport('leaflet-gesture-handling'),\n\t\t\t\timport(\"leaflet-gesture-handling/dist/leaflet-gesture-handling.css\"),\n\t\t\t\timport('leaflet-fullscreen'),\n\t\t\t\timport('leaflet-fullscreen/dist/leaflet.fullscreen.css')\n\t\t\t]).then(() => {\n\t\t\t\tconst $maps = $.map(maps, (elt) => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tconst\n\t\t\t\t\t\t\tmap = $(elt),\n\t\t\t\t\t\t\tdata = map.data(),\n\t\t\t\t\t\t\tconfig = data.mapConfiguration;\n\t\t\t\t\t\tif (config) {\n\t\t\t\t\t\t\tresolve(createMap(map, config, options, callback));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$.get(data.mapConfigurationUrl || 'get-map-configuration.json').then((config) => {\n\t\t\t\t\t\t\t\tcreateMap(map, config, options, callback).then((leafmap) => {\n\t\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\t\t'leafmap': leafmap,\n\t\t\t\t\t\t\t\t\t\t'config': config\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t$.when.apply($, $maps).then();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Get layer definition\n\t *\n\t * @param map: source map element\n\t * @param leafmap: current Leaflet map\n\t * @param layer: current layer definition\n\t */\n\tgetLayer: (map, leafmap, layer) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst factory = MyAMS.getObject(layer.factory);\n\t\t\tif (factory !== undefined) {\n\t\t\t\tdelete layer.factory;\n\t\t\t\tconst deferred = [];\n\t\t\t\tif (layer.dependsOn) {\n\t\t\t\t\tfor (const name in layer.dependsOn) {\n\t\t\t\t\t\tif (!layer.dependsOn.hasOwnProperty(name)) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (MyAMS.getObject(name) === undefined) {\n\t\t\t\t\t\t\tdeferred.push(MyAMS.getScript(layer.dependsOn[name]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdelete layer.dependsOn;\n\t\t\t\t}\n\t\t\t\t$.when.apply($, deferred).then(() => {\n\t\t\t\t\tresolve(factory(map, leafmap, layer));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Layers factories\n\t */\n\tfactory: {\n\n\t\tGeoJSON: (map, leafmap, layer) => {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\tconst result = L.geoJSON(null, layer);\n\t\t\tmap.on('map.finished', (evt, map, leafmap, config) => {\n\t\t\t\t$.get(url, (data) => {\n\t\t\t\t\tresult.addData(data.geometry, {\n\t\t\t\t\t\tstyle: layer.style\n\t\t\t\t\t});\n\t\t\t\t\tif (config.fitLayer === layer.name) {\n\t\t\t\t\t\tleafmap.fitBounds(result.getBounds());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn result;\n\t\t},\n\n\t\tTileLayer: (map, leafmap, layer) => {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\treturn L.tileLayer(url, layer);\n\t\t},\n\n\t\tWMS: function(map, leafmap, layer) {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\treturn L.tileLayer.wms(url, layer);\n\t\t},\n\n\t\tGeoportal: {\n\t\t\tWMS: (map, leafmap, layer) => {\n\t\t\t\tMyAMS.getCSS('/--static--/pyams_gis/css/GpPluginLeaflet.min.css', 'geoportal');\n\t\t\t\treturn L.geoportalLayer.WMS(layer);\n\t\t\t}\n\t\t},\n\n\t\tESRI: {\n\t\t\tFeature: (map, leafmap, layer) => {\n\t\t\t\treturn L.esri.featureLayer(layer);\n\t\t\t}\n\t\t},\n\n\t\tGoogle: (map, leafmap, layer) => {\n\t\t\tconst apiKey = layer.apiKey;\n\t\t\tdelete layer.apiKey;\n\t\t\tif (MyAMS.getObject('window.google.maps') === undefined) {\n\t\t\t\tconst script = MyAMS.getScript('https://maps.googleapis.com/maps/api/js?key=' + apiKey);\n\t\t\t\t$.when.apply($, [script]);\n\t\t\t}\n\t\t\treturn L.gridLayer.googleMutant(layer);\n\t\t}\n\t}\n};\n\nexport default PyAMS_GIS;\n"],"names":["MyAMS","createMap","map","config","options","callback","Promise","resolve","reject","data","settings","preferCanvas","mapLeafletPreferCanvas","attributionControl","mapLeafletAttributionControl","undefined","zoomControl","mapLeafletZoomControl","fullscreenControl","mapLeafletFullscreen","pseudoFullscreen","crs","mapLeafletCrs","getObject","L","CRS","EPSG3857","center","mapLeafletCenter","zoom","mapLeafletZoom","gestureHandling","mapLeafletWheelZoom","scrollWheelZoom","keyboard","mapLeafletKeyboard","Browser","mobile","amsLeafletKeyboard","$","extend","trigger","leafmap","attr","layersConfig","baseLayers","overlayLayers","layers","_iterator","_createForOfIteratorHelper","_step","s","n","done","layerConfig","value","push","PyAMS_GIS","getLayer","err","e","f","tileLayer","name","title","maxZoom","attribution","when","apply","then","_len","arguments","length","Array","_key","_i","_Object$entries","Object","entries","_Object$entries$_i","_slicedToArray","idx","layer","isVisible","addTo","isOverlay","mapLeafletHideZoomControl","control","scale","layerControl","setView","LatLng","lat","lon","bounds","fitBounds","marker","icon","iconUrl","iconSize","iconAnchor","setIcon","setLatLng","reduce","res","_objectSpread","_defineProperty","init","maps","window","all","$maps","elt","mapConfiguration","get","mapConfigurationUrl","factory","deferred","dependsOn","hasOwnProperty","getScript","GeoJSON","url","result","geoJSON","on","evt","addData","geometry","style","fitLayer","getBounds","TileLayer","WMS","wms","Geoportal","getCSS","geoportalLayer","ESRI","Feature","esri","featureLayer","Google","apiKey","script","gridLayer","googleMutant"],"sourceRoot":""}