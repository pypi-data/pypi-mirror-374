<div i18n:domain="pyams_app_msc"
	 tal:define="settings view.settings;
				 renderer_settings view.renderer_settings;
				 start int(request.params.get('start', 0));
				 limit (start + renderer_settings.page_size) if renderer_settings.paginate else settings.limit;
				 items settings.get_items(request, start, renderer_settings.page_size, limit);
				 total_count next(items);
				 aggregations next(items);
				 (has_items, results) tales:boolean_iter(items);
				 audience request.params.get('audience');
				 identity request.identity or {};
				 authenticated 'system.Authenticated' in identity.get('principals', ());">
	<h3 tal:define="title i18n:settings.title"
		tal:condition="title"
		class="position-relative border-bottom pb-2 mt-4">
		${title}
		<span class="position-absolute underline"></span>
	</h3>
	<div class="row"
		 tal:define="visible_filters renderer_settings.get_visible_filters();
					 (has_filters, filters) tales:boolean_iter(visible_filters);
					 global count 0;">
		<div tal:condition="has_filters"
			 class="${renderer_settings.filters_css_class}">
			${structure:provider:filters_default(renderer_settings=renderer_settings, aggregations=aggregations)}
			<tal:if condition="authenticated">
				<a tal:define="url view.get_session_request_url(context)"
				   tal:condition="url"
				   class="btn btn-primary w-100 my-3"
				   href="${url}"
				   i18n:translate="">
					Ask for new session
				</a>
			</tal:if>
		</div>
		<div tal:omit-tag="not:has_filters"
			 class="${renderer_settings.results_css_class}">
			<div tal:repeat="item results"
				 class="${renderer_settings.first_panel_css_class if repeat.item.start() else '{} {}'.format(renderer_settings.panels_css_class, renderer_settings.get_css_class())}">
				<tal:var define="global count count+1">
					${structure:view.render_item(item, 'catalog-item-panel')}
				</tal:var>
			</div>
			<nav class="col-12"
			     aria-label="Pagination" i18n:attributes="aria-label"
				 tal:condition="renderer_settings.paginate">
				<ul class="pagination w-100 justify-content-between"
					tal:define="audience request.params.get('audience')">
					<li class="page-item">
						<a tal:condition="start > 0"
						   class="page-link"
						   data-ams-search-params='{
								"start": ${start - renderer_settings.page_size},
								"audience": "${audience}"
						   }'
						   href="PyAMS_search.changePage">
							<span aria-hidden="true">&larr;</span>
							<i18n:var translate="">Previous page</i18n:var>
						</a>
					</li>
					<li class="page-item">
						<a tal:condition="start + count < total_count"
						   class="page-link"
						   data-ams-search-params='{
								"start": ${start + count},
								"audience": "${audience}"
						   }'
						   href="PyAMS_search.changePage">
							<i18n:var translate="">Next page</i18n:var>
							<span aria-hidden="true">&rarr;</span>
						</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
