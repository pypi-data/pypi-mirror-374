{"version":3,"file":"pkg_js__gis_js.js","mappings":"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","sources":["webpack://pyams_content_themes/./pkg/js/_gis.js"],"sourcesContent":["import MyAMS from \"./_utils\";\n\n\nconst createMap = (map, config, options, callback) => {\n\n\treturn new Promise((resolve, reject) => {\n\n\t\tconst data = map.data();\n\t\tlet settings = {\n\t\t\tpreferCanvas: data.mapLeafletPreferCanvas || false,\n\t\t\tattributionControl: data.mapLeafletAttributionControl === undefined ?\n\t\t\t\tconfig.attributionControl : data.mapLeafletAttributionControl,\n\t\t\tzoomControl: data.mapLeafletZoomControl === undefined ?\n\t\t\t\tconfig.zoomControl : data.mapLeafletZoomControl,\n\t\t\tfullscreenControl: data.mapLeafletFullscreen === undefined ?\n\t\t\t\tconfig.fullscreenControl && {\n\t\t\t\t\tpseudoFullscreen: true\n\t\t\t\t} || null :\n\t\t\t\tdata.mapLeafletFullscreen,\n\t\t\tcrs: data.mapLeafletCrs || MyAMS.getObject(config.crs) || L.CRS.EPSG3857,\n\t\t\tcenter: data.mapLeafletCenter || config.center,\n\t\t\tzoom: data.mapLeafletZoom || config.zoom,\n\t\t\tgestureHandling: data.mapLeafletWheelZoom === undefined ?\n\t\t\t\t!config.scrollWheelZoom : data.mapLeafletWheelZoom,\n\t\t\tkeyboard: data.mapLeafletKeyboard === undefined ?\n\t\t\t\tconfig.keyboard && !L.Browser.mobile : data.amsLeafletKeyboard\n\t\t};\n\t\tsettings = $.extend({}, settings, options);\n\t\tmap.trigger('map.init', [map, settings, config]);\n\t\tconst\n\t\t\tleafmap = L.map(map.attr('id'), settings),\n\t\t\tlayersConfig = [];\n\t\tif (config.layers) {\n\t\t\tfor (const layerConfig of config.layers) {\n\t\t\t\tmap.trigger('map.layer.init', [map, layerConfig]);\n\t\t\t\tlayersConfig.push(PyAMS_GIS.getLayer(map, leafmap, layerConfig));\n\t\t\t}\n\t\t} else {\n\t\t\tlayersConfig.push(L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n\t\t\t\tname: 'osm',\n\t\t\t\ttitle: 'OpenStreetMap',\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tattribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n\t\t\t}));\n\t\t}\n\t\t$.when.apply($, layersConfig).then((...layers) => {\n\t\t\tfor (const layer of layers) {\n\t\t\t\tlayer.addTo(leafmap);\n\t\t\t}\n\t\t\tif (config.zoomControl && (data.mapLeafletHideZoomControl !== true)) {\n\t\t\t\tL.control.scale().addTo(leafmap);\n\t\t\t}\n\t\t\tif (config.center) {\n\t\t\t\tleafmap.setView(new L.LatLng(config.center.lat, config.center.lon),\n\t\t\t\t\tconfig.zoom || 13);\n\t\t\t} else if (config.bounds) {\n\t\t\t\tleafmap.fitBounds(config.bounds);\n\t\t\t}\n\t\t\tif (config.marker) {\n\t\t\t\tconst icon = L.icon({\n\t\t\t\t\ticonUrl: '/--static--/pyams_gis/img/marker-icon.png',\n\t\t\t\t\ticonSize: [25, 41],\n\t\t\t\t\ticonAnchor: [12, 39]\n\t\t\t\t});\n\t\t\t\tconst marker = L.marker();\n\t\t\t\tmarker.setIcon(icon);\n\t\t\t\tmarker.setLatLng({\n\t\t\t\t\tlon: config.marker.lon,\n\t\t\t\t\tlat: config.marker.lat\n\t\t\t\t});\n\t\t\t\tmarker.addTo(leafmap);\n\t\t\t}\n\t\t\tmap.data('leafmap', leafmap);\n\t\t\tmap.data('leafmap.config', config);\n\t\t\tmap.data('leafmap.layers', layers.reduce((res, layer) => ({\n\t\t\t\t...res,\n\t\t\t\t[layer.options.name]: layer\n\t\t\t}), {}));\n\t\t\tmap.trigger('map.finishing', [map, leafmap, config]);\n\t\t\tif (callback) {\n\t\t\t\tcallback(leafmap, config);\n\t\t\t}\n\t\t\tmap.trigger('map.finished', [map, leafmap, config]);\n\t\t\tresolve(leafmap);\n\t\t});\n\t});\n};\n\n\nconst PyAMS_GIS = {\n\n\t/**\n\t * Map initialization\n\t *\n\t * @param maps: maps elements\n\t * @param options: optional maps configuration settings\n\t * @param callback: maps initialization callback\n\t */\n\tinit: (maps, options, callback) => {\n\n\t\twindow.PyAMS_GIS = PyAMS_GIS;\n\t\tPromise.all([\n\t\t\timport('leaflet'),\n\t\t\timport(\"leaflet/dist/leaflet.css\")\n\t\t]).then(() => {\n\t\t\tPromise.all([\n\t\t\t\timport('leaflet-gesture-handling'),\n\t\t\t\timport(\"leaflet-gesture-handling/dist/leaflet-gesture-handling.css\"),\n\t\t\t\timport('leaflet-fullscreen'),\n\t\t\t\timport('leaflet-fullscreen/dist/leaflet.fullscreen.css')\n\t\t\t]).then(() => {\n\t\t\t\tconst $maps = $.map(maps, (elt) => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tconst\n\t\t\t\t\t\t\tmap = $(elt),\n\t\t\t\t\t\t\tdata = map.data(),\n\t\t\t\t\t\t\tconfig = data.mapConfiguration;\n\t\t\t\t\t\tif (config) {\n\t\t\t\t\t\t\tresolve(createMap(map, config, options, callback));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$.get(data.mapConfigurationUrl || 'get-map-configuration.json').then((config) => {\n\t\t\t\t\t\t\t\tcreateMap(map, config, options, callback).then((leafmap) => {\n\t\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\t\t'leafmap': leafmap,\n\t\t\t\t\t\t\t\t\t\t'config': config\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t$.when.apply($, $maps).then();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Get layer definition\n\t *\n\t * @param map: source map element\n\t * @param leafmap: current Leaflet map\n\t * @param layer: current layer definition\n\t */\n\tgetLayer: (map, leafmap, layer) => {\n\t\tconst factory = MyAMS.getObject(layer.factory);\n\t\tif (factory !== undefined) {\n\t\t\tdelete layer.factory;\n\t\t\tconst deferred = [];\n\t\t\tif (layer.dependsOn) {\n\t\t\t\tfor (const name in layer.dependsOn) {\n\t\t\t\t\tif (!layer.dependsOn.hasOwnProperty(name)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (MyAMS.getObject(name) === undefined) {\n\t\t\t\t\t\tdeferred.push(MyAMS.getScript(layer.dependsOn[name]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdelete layer.dependsOn;\n\t\t\t}\n\t\t\tif (deferred.length > 0) {\n\t\t\t\t$.when.apply($, deferred);\n\t\t\t}\n\t\t\treturn factory(map, leafmap, layer);\n\t\t}\n\t},\n\n\t/**\n\t * Layers factories\n\t */\n\tfactory: {\n\n\t\tGeoJSON: (map, leafmap, layer) => {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\tconst result = L.geoJSON(null, layer);\n\t\t\tmap.on('map.finished', (evt, map, leafmap, config) => {\n\t\t\t\t$.get(url, (data) => {\n\t\t\t\t\tresult.addData(data.geometry, {\n\t\t\t\t\t\tstyle: layer.style\n\t\t\t\t\t});\n\t\t\t\t\tif (config.fitLayer === layer.name) {\n\t\t\t\t\t\tleafmap.fitBounds(result.getBounds());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn result;\n\t\t},\n\n\t\tTileLayer: (map, leafmap, layer) => {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\treturn L.tileLayer(url, layer);\n\t\t},\n\n\t\tWMS: function(map, leafmap, layer) {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\treturn L.tileLayer.wms(url, layer);\n\t\t},\n\n\t\tGeoportal: {\n\t\t\tWMS: (map, leafmap, layer) => {\n\t\t\t\tMyAMS.getCSS('/--static--/pyams_gis/css/leaflet-gp-3.0.2.min.css', 'geoportal');\n\t\t\t\treturn L.geoportalLayer.WMS(layer);\n\t\t\t}\n\t\t},\n\n\t\tESRI: {\n\t\t\tFeature: (map, leafmap, layer) => {\n\t\t\t\treturn L.esri.featureLayer(layer);\n\t\t\t}\n\t\t},\n\n\t\tGoogle: (map, leafmap, layer) => {\n\t\t\tconst apiKey = layer.apiKey;\n\t\t\tdelete layer.apiKey;\n\t\t\tif (MyAMS.getObject('window.google.maps') === undefined) {\n\t\t\t\tconst script = MyAMS.getScript('https://maps.googleapis.com/maps/api/js?key=' + apiKey);\n\t\t\t\t$.when.apply($, [script]);\n\t\t\t}\n\t\t\treturn L.gridLayer.googleMutant(layer);\n\t\t}\n\t}\n};\n\nexport default PyAMS_GIS;\n"],"names":["MyAMS","createMap","map","config","options","callback","Promise","resolve","reject","data","settings","preferCanvas","mapLeafletPreferCanvas","attributionControl","mapLeafletAttributionControl","undefined","zoomControl","mapLeafletZoomControl","fullscreenControl","mapLeafletFullscreen","pseudoFullscreen","crs","mapLeafletCrs","getObject","L","CRS","EPSG3857","center","mapLeafletCenter","zoom","mapLeafletZoom","gestureHandling","mapLeafletWheelZoom","scrollWheelZoom","keyboard","mapLeafletKeyboard","Browser","mobile","amsLeafletKeyboard","$","extend","trigger","leafmap","attr","layersConfig","layers","_iterator","_createForOfIteratorHelper","_step","s","n","done","layerConfig","value","push","PyAMS_GIS","getLayer","err","e","f","tileLayer","name","title","maxZoom","attribution","when","apply","then","_len","arguments","length","Array","_key","_i","_layers","layer","addTo","mapLeafletHideZoomControl","control","scale","setView","LatLng","lat","lon","bounds","fitBounds","marker","icon","iconUrl","iconSize","iconAnchor","setIcon","setLatLng","reduce","res","_objectSpread","_defineProperty","init","maps","window","all","$maps","elt","mapConfiguration","get","mapConfigurationUrl","factory","deferred","dependsOn","hasOwnProperty","getScript","GeoJSON","url","result","geoJSON","on","evt","addData","geometry","style","fitLayer","getBounds","TileLayer","WMS","wms","Geoportal","getCSS","geoportalLayer","ESRI","Feature","esri","featureLayer","Google","apiKey","script","gridLayer","googleMutant"],"sourceRoot":""}