import{d as C,a as R,r as f,x as I,e as N,F as j,j as e,H as P,w as n,h as a,f as b,k as E,N as z,B as S,m as $,t as T,n as A,I as w,b as F,v as G,J as H,K as J,L as K,y as O,M as Q,O as W,Q as X,R as Y}from"./index-Bl6WO0OO.js";import{c as Z,g as ee}from"./task-6IoNe2py.js";import{u as te}from"./useInterval-Dhzkz295.js";import{u as ae}from"./groupDetail-CzfcrXL1.js";import{_ as se,a as oe}from"./FormItem-m3CyvpHh.js";import{A as ne}from"./Add-BgTSZRmz.js";const le={class:"flex justify-end"},ie=C({__name:"CreateTask",emits:["success"],setup(q,{expose:l,emit:x}){const L=x,{t:i}=R(),h=ae(),_=f(!1),y=f(),s=f({title:void 0,description:void 0,space_name:void 0}),D={title:{required:!0,message:"groupDetail.taskList.taskTitleErrMsg"},description:{required:!0,message:"groupDetail.taskList.descErrMsg"},space_name:{required:!0,message:"groupDetail.taskList.idErrMsg"}},r=f(!1),v=()=>{r.value=!1,s.value={title:void 0,description:void 0,space_name:void 0}},u=t=>{t||v()},c=()=>{var t;_.value||(_.value=!0,(t=y.value)==null||t.validate(async o=>{var k;if(o){_.value=!1;return}const[g,p]=await Z({...s.value,device_group_name:(k=h.groupInfo)==null?void 0:k.device_group_name});_.value=!1,!g&&p&&p.status===0&&(v(),L("success"))}))},d=t=>w("div",{class:"flex gap-3 items-baseline"},[w("div",{class:"text-base"},`${t.label}`),w("div",{class:"text-xs opacity-50"},`[${new Date(t.create_time).toLocaleString()}] ${t.description}`)]);return l({open:()=>r.value=!0,close:v}),(t,o)=>{const g=E,p=oe,k=z,M=S,U=se,B=A,V=j;return N(),I(V,{show:e(r),"onUpdate:show":o[3]||(o[3]=m=>P(r)?r.value=m:null),"on-update:show":u},{default:n(()=>[a(B,{style:{width:"600px"},size:"huge",bordered:!1,role:"dialog","aria-modal":"true"},{default:n(()=>[a(U,{ref_key:"formRef",ref:y,model:e(s),rules:D},{default:n(()=>[a(p,{label:e(i)("groupDetail.taskList.taskTitleLabel"),path:"title"},{default:n(()=>[a(g,{value:e(s).title,"onUpdate:value":o[0]||(o[0]=m=>e(s).title=m),placeholder:e(i)("groupDetail.taskList.taskTitlePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(i)("groupDetail.taskList.descLabel"),path:"description"},{default:n(()=>[a(g,{value:e(s).description,"onUpdate:value":o[1]||(o[1]=m=>e(s).description=m),placeholder:e(i)("groupDetail.taskList.descPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(p,{label:e(i)("groupDetail.taskList.spaceLabel"),path:"space_name"},{default:n(()=>[a(k,{value:e(s).space_name,"onUpdate:value":o[2]||(o[2]=m=>e(s).space_name=m),placeholder:e(i)("groupDetail.taskList.spacePlaceholder"),options:e(h).spaceList,"render-label":d},null,8,["value","placeholder","options"])]),_:1},8,["label"]),b("div",le,[a(M,{type:"primary",loading:e(_),onClick:c},{default:n(()=>[$(T(e(i)("groupDetail.taskList.createTask")),1)]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),re={class:"flex justify-between items-center gap-5 mb-5"},ue={class:"text-xl"},ge=C({__name:"TaskList",setup(q){const{t:l}=R(),x=F(),L=G(),i=f(),h=f(),_=[{title:l("groupDetail.taskList.id"),key:"task_id",width:100},{title:l("groupDetail.taskList.title"),key:"title"},{title:l("groupDetail.taskList.description"),key:"description"},{title:l("groupDetail.taskList.spaceName"),key:"space_name"},{title:l("groupDetail.taskList.source"),key:"source",width:100},{title:l("groupDetail.taskList.createTime"),key:"create_time",width:180},{title:l("groupDetail.taskList.progress"),key:"progress"}],y=({task_id:u,title:c,space_id:d})=>({class:"cursor-pointer",onClick:()=>{x.push({name:"experimentList",query:{task_id:u,task_title:c,space_id:d,...L.query}})}}),s=H({page:1,per_page:J,total:0}),D=f(),r=async(u={})=>{var o;const c=L.query.device_group_name;if(!c)return;const[d,t]=await ee({...((o=h.value)==null?void 0:o.searchParasm)||{},...u,...Y(s),device_group_name:c});!d&&t&&t.status===0&&(D.value=t.data.list,s.total=t.data.total)},v=()=>{var u;(u=i.value)==null||u.open()};return te(r),(u,c)=>{const d=O,t=S,o=Q,g=K,p=X;return N(),I(p,{"has-sider":""},{default:n(()=>[a(g,null,{default:n(()=>[b("div",re,[b("div",ue,T(e(l)("groupDetail.taskList.tabName")),1),b("div",null,[a(t,{type:"primary",onClick:v},{icon:n(()=>[a(d,null,{default:n(()=>[a(e(ne))]),_:1})]),default:n(()=>[$(" "+T(e(l)("groupDetail.taskList.createTask")),1)]),_:1})])]),a(o,{columns:_,data:e(D),pagination:!1,"row-props":y,"max-height":"calc(100vh - 400px)"},null,8,["data"]),a(W,{"page-info":e(s),"onUpdate:pageInfo":c[0]||(c[0]=k=>P(s)?s.value=k:null),onUpdateList:r},null,8,["page-info"]),a(ie,{ref_key:"createTaskRef",ref:i,onSuccess:r},null,512)]),_:1})]),_:1})}}});export{ge as default};
