import{d as q,x as v,p as L,j as e,$,e as s,V as oe,v as J,a as le,r as _,C as ue,c as E,f as T,h as i,Z as ie,w as o,a0 as re,a1 as z,a2 as O,m as ce,t as _e,Y as K,aJ as de,a3 as pe,H as W,a7 as fe,aN as me,aW as D,a9 as U,o as ve,b3 as ge}from"./index-Bl6WO0OO.js";import{d as ye,e as he,f as be}from"./autoCali-CP7mpU2f.js";import{_ as ke}from"./LogView.vue_vue_type_script_setup_true_lang-CiL3EA4x.js";import{u as M}from"./useInterval-Dhzkz295.js";import{u as xe}from"./autoCali-Cf8Lkmb3.js";import{a as Y,b as Z}from"./Tabs-D-7ozXuv.js";import"./dayjs.min-D4yLqGxV.js";import"./Add-y13jjKgY.js";import"./debounce-Bqv2dJIe.js";const F=q({__name:"EntityLog",props:{logs:{}},setup(B){return(r,d)=>e($)(r.logs)?L("",!0):(s(),v(ke,{key:0,logs:r.logs},null,8,["logs"]))}}),Ce={class:"flex ml-5"},H=120,Ne=q({__name:"EntitiesView",props:{entities:{}},setup(B){const r=xe(),d=oe(),N=J(),{t:R}=le(),p=_(),g=_(),a=_(0),b=_(),w=_(0),l=_(!1),u=_(),A=B,P=ue(()=>{const n=A.entities.length;return Array(n<H?H:n).fill(0).map((t,f)=>A.entities[f])}),Q=n=>{n&&(u.value||(u.value=!0,p.value=n,g.value=[],b.value=[],a.value=0,w.value=0,l.value=!0,I.value==0?S():V()))},V=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await ye({session_id:+N.query.session_id,entity:p.value});u.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(w.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(b.value=[...b.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(w.value=(y=t.data)==null?void 0:y.last_record_id),D(()=>{var h,x;!G.value&&((h=r.sessionInfo)==null?void 0:h.status)===U.RUNNING&&X(),((x=r.sessionInfo)==null?void 0:x.status)!==U.RUNNING&&(ee(),G.value&&V())}))},{start:X,stop:ee,runing:G}=M(V,{isManual:!0,duration:3e3}),S=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await he({session_id:+N.query.session_id,entity:p.value,last_record_id:a.value});u.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(a.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(g.value=[...g.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(a.value=(y=t.data)==null?void 0:y.last_record_id),D(()=>{var h,x;!j.value&&((h=r.sessionInfo)==null?void 0:h.status)===U.RUNNING&&te(),((x=r.sessionInfo)==null?void 0:x.status)!==U.RUNNING&&(ae(),j.value&&S())}))},{start:te,stop:ae,runing:j}=M(S,{isManual:!0,duration:3e3}),I=_(0),se=n=>{I.value=n,p.value&&(n===0?S():V())};return(n,t)=>{const f=pe,k=re,m=ie,c=fe,y=me,h=Z,x=Y;return s(),E("div",Ce,[T("div",null,[i(m,{style:{height:"calc(100vh - 310px)"}},{default:o(()=>[i(k,{cols:10,style:{width:"560px"}},{default:o(()=>[(s(!0),E(z,null,O(e(P),(C,ne)=>(s(),v(f,{key:ne,class:de(["border min-w-14 min-h-14 flex items-center justify-center p-1",[C?"cursor-pointer":""]]),style:K({borderColor:e(d).dividerColor,backgroundColor:e(p)===C&&e(p)?"#00B42A":"inherit",color:e(p)===C?"#fff":"inherit"}),onClick:()=>Q(C)},{default:o(()=>[ce(_e(C),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),i(x,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:e(I),"onUpdate:value":t[0]||(t[0]=C=>W(I)?I.value=C:null),onUpdateValue:se},{default:o(()=>[i(h,{name:0,key:"0",tab:e(R)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[i(m,{style:K({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(u)?(s(),v(c,{key:0})):(s(),E(z,{key:1},[i(F,{logs:e(g)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):L("",!0),e($)(e(g))?(s(),v(y,{key:1,class:"mt-32"})):L("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"]),i(h,{name:1,key:"1",tab:e(R)("groupDetail.autoCali.caliRecord"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[i(m,{style:K({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(u)?(s(),v(c,{key:0})):(s(),E(z,{key:1},[i(F,{logs:e(b)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):L("",!0),e($)(e(b))?(s(),v(y,{key:1,class:"mt-32"})):L("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),$e=q({__name:"AutoCaliEntity",setup(B){const r=J(),d=_(),N=_(),R=async()=>{const[g,a]=await be({device_group_name:r.query.device_group_name,space_id:+r.query.space_id});!g&&(a==null?void 0:a.status)===0&&(N.value=a.data,d.value=Object.keys(a.data)[0])},p=()=>{};return ve(()=>{R()}),(g,a)=>{const b=Z,w=Y;return s(),E("div",null,[i(w,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:e(d),"onUpdate:value":a[0]||(a[0]=l=>W(d)?d.value=l:null),onUpdateValue:p,"tab-class":"w-[128px]"},ge({suffix:o(()=>[a[2]||(a[2]=T("div",null,null,-1))]),default:o(()=>[(s(!0),E(z,null,O(e(N),(l,u)=>(s(),v(b,{name:u,key:u,tab:u},{default:o(()=>[i(Ne,{"active-key":u,entities:l},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[e($)(e(N))?void 0:{name:"prefix",fn:o(()=>[a[1]||(a[1]=T("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{$e as default};
