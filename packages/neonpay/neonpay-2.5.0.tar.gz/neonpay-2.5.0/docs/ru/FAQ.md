# –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã (FAQ) - NEONPAY

–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –æ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ NEONPAY.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã](#–æ–±—â–∏–µ-–≤–æ–ø—Ä–æ—Å—ã)
2. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
3. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–ø–ª–∞—Ç–µ–∂–µ–π)
4. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
5. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
6. [–ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#–ø—Ä–æ–¥–∞–∫—à–Ω-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
7. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

## –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

### –ß—Ç–æ —Ç–∞–∫–æ–µ NEONPAY?

NEONPAY - —ç—Ç–æ Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–æ—â–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –ø–ª–∞—Ç–µ–∂–µ–π Telegram Stars –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±–æ—Ç–æ–≤. –û–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π API –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ –±–æ—Ç–æ–≤ (Aiogram, Pyrogram, pyTelegramBotAPI –∏ –¥—Ä.) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏.

### –ö–∞–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –±–æ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?

NEONPAY –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- **Aiogram** (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) - –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **Pyrogram** - –ü–æ–ø—É–ª—è—Ä–Ω–∞—è MTProto –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **pyTelegramBotAPI** - –ü—Ä–æ—Å—Ç–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **python-telegram-bot** - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **Raw Telegram Bot API** - –ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã

### –ß—Ç–æ —Ç–∞–∫–æ–µ Telegram Stars?

Telegram Stars - —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞ Telegram, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–∫—É–ø–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–ø–ª–∞—Ç—ã —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥ –≤ –±–æ—Ç–∞—Ö. –û–Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Telegram –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ—Å—à–æ–≤–Ω—ã–π –æ–ø—ã—Ç –ø–ª–∞—Ç–µ–∂–µ–π.

### –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NEONPAY?

–î–∞, NEONPAY –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–∞ –∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º. –í—ã –ø–ª–∞—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–º–∏—Å—Å–∏—é Telegram –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞—Ç–µ–∂–µ–π Stars (–æ–±—ã—á–Ω–æ 5% –æ—Ç —Å—É–º–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏).

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å NEONPAY?

```bash
# –ë–∞–∑–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
pip install neonpay

# –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –±–æ—Ç–∞
pip install neonpay aiogram  # –î–ª—è Aiogram
pip install neonpay pyrogram  # –î–ª—è Pyrogram
```

### –ö–∞–∫ –±—ã—Å—Ç—Ä–æ –Ω–∞—á–∞—Ç—å?

```python
from neonpay.factory import create_neonpay
from neonpay.core import PaymentStage, PaymentStatus

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
neonpay = create_neonpay(bot_instance=–≤–∞—à_–±–æ—Ç)

# –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ç–∞–ø–∞ –ø–ª–∞—Ç–µ–∂–∞
stage = PaymentStage(
    title="–ü—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø",
    description="–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏",
    price=25,  # 25 Telegram Stars
)
neonpay.create_payment_stage("premium", stage)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
@neonpay.on_payment
async def handle_payment(result):
    if result.status == PaymentStatus.COMPLETED:
        print(f"–ü–ª–∞—Ç–µ–∂ –ø–æ–ª—É—á–µ–Ω: {result.amount} –∑–≤–µ–∑–¥")
```

### –ù—É–∂–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å webhook?

–ù–µ—Ç, NEONPAY –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é webhook –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫. –î–ª—è Raw API –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤—Ä—É—á–Ω—É—é.

### –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –±–æ—Ç–∞?

**–î–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Aiogram** - –æ–Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è, —Ö–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –∏–º–µ–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É async.

**–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ. NEONPAY —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π?

```python
# –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–Ω–∞—Ç–æ–≤
donation_stages = [
    PaymentStage("–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 1‚≠ê", "–ü–æ–º–æ—á—å –±–æ—Ç—É —Ä–∞–±–æ—Ç–∞—Ç—å", 1),
    PaymentStage("–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 10‚≠ê", "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É", 10),
    PaymentStage("–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 50‚≠ê", "–ë–æ–ª—å—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞", 50),
]

# –¶–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
product_stages = [
    PaymentStage("–ü—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø", "30 –¥–Ω–µ–π –ø—Ä–µ–º–∏—É–º", 25),
    PaymentStage("–ö–∞—Å—Ç–æ–º–Ω–∞—è —Ç–µ–º–∞", "–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–∞", 15),
]

# –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ —ç—Ç–∞–ø—ã
for i, stage in enumerate(donation_stages):
    neonpay.create_payment_stage(f"donate_{i}", stage)

for i, stage in enumerate(product_stages):
    neonpay.create_payment_stage(f"product_{i}", stage)
```

### –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π?

```python
@neonpay.on_payment
async def handle_payment(result):
    if result.status == PaymentStatus.COMPLETED:
        if result.stage_id.startswith("donate_"):
            # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–Ω–∞—Ç
            await handle_donation(result)
        elif result.stage_id.startswith("product_"):
            # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–∫—É–ø–∫—É –ø—Ä–æ–¥—É–∫—Ç–∞
            await handle_product_purchase(result)
        else:
            # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–ª–∞—Ç–µ–∂–∏
            await handle_other_payment(result)
```

### –ú–æ–∂–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö?

–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏:

```python
neonpay = create_neonpay(
    bot_instance=bot,
    thank_you_message="üéâ –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É! –í–∞—à –ø—Ä–æ–¥—É–∫—Ç —Ç–µ–ø–µ—Ä—å –∞–∫—Ç–∏–≤–µ–Ω."
)
```

### –ö–∞–∫ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–µ–π?

```python
@neonpay.on_payment
async def handle_payment(result):
    # –ü–æ–ª—É—á–∏—Ç—å –æ–∂–∏–¥–∞–µ–º—É—é —Å—É–º–º—É –¥–ª—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞
    stage = neonpay.get_payment_stage(result.stage_id)
    expected_amount = stage.price
    
    if result.amount != expected_amount:
        logger.warning(f"–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º—ã: –æ–∂–∏–¥–∞–ª–æ—Å—å {expected_amount}, –ø–æ–ª—É—á–µ–Ω–æ {result.amount}")
        return
    
    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂
    await process_payment(result)
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –ø–ª–∞—Ç–µ–∂ –Ω–µ —É–¥–∞–ª—Å—è?

NEONPAY –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö:

```python
@neonpay.on_payment
async def handle_payment(result):
    if result.status == PaymentStatus.COMPLETED:
        # –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–µ–Ω
        await process_successful_payment(result)
    elif result.status == PaymentStatus.FAILED:
        # –ü–ª–∞—Ç–µ–∂ –Ω–µ —É–¥–∞–ª—Å—è
        await handle_payment_failure(result)
    elif result.status == PaymentStatus.PENDING:
        # –ü–ª–∞—Ç–µ–∂ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
        await handle_pending_payment(result)
```

### –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏?

```python
async def safe_send_payment(user_id: int, stage_id: str):
    try:
        await neonpay.send_payment(user_id, stage_id)
    except PaymentError as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞: {e}")
        await bot.send_message(user_id, "–ü–ª–∞—Ç–µ–∂ –Ω–µ —É–¥–∞–ª—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")
    except Exception as e:
        logger.error(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
        await bot.send_message(user_id, "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
```

### –ß—Ç–æ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω?

NEONPAY –≤—ã–∑–æ–≤–µ—Ç `ConfigurationError`, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω:

```python
try:
    neonpay = create_neonpay(bot_instance=bot)
except ConfigurationError as e:
    print(f"–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
    # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞?

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ:

```python
# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
BOT_TOKEN = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"

# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
import os
BOT_TOKEN = os.getenv("BOT_TOKEN")
```

### –ö–∞–∫ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?

```python
async def safe_send_payment(user_id: int, stage_id: str):
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏
    if not await user_can_pay(user_id):
        await bot.send_message(user_id, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π.")
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç–∏–≥ –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–∏–º–∏—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π
    if await user_payment_limit_reached(user_id):
        await bot.send_message(user_id, "–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π.")
        return
    
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂
    await neonpay.send_payment(user_id, stage_id)
```

### –ö–∞–∫ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏?

```python
class PaymentValidator:
    def __init__(self):
        self.user_payments = defaultdict(list)
        self.max_payments_per_hour = 5
    
    async def validate_payment(self, user_id: int, stage_id: str) -> bool:
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –ø–ª–∞—Ç–µ–∂–µ–π
        now = time.time()
        recent_payments = [
            t for t in self.user_payments[user_id] 
            if now - t < 3600  # –ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
        ]
        
        if len(recent_payments) >= self.max_payments_per_hour:
            return False
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
        if await self.is_suspicious_user(user_id):
            return False
        
        return True
    
    async def record_payment(self, user_id: int):
        self.user_payments[user_id].append(time.time())
```

## –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ö–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω?

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```python
import os
BOT_TOKEN = os.getenv("BOT_TOKEN")
DATABASE_URL = os.getenv("DATABASE_URL")
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
import logging
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
)
```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–¥–∞–∫—à–Ω –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
```python
# –ó–∞–º–µ–Ω–∏—Ç–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –ø–∞–º—è—Ç–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
import asyncpg

async def store_payment(payment_data):
    conn = await asyncpg.connect(DATABASE_URL)
    await conn.execute(
        "INSERT INTO payments (user_id, amount, stage_id, created_at) VALUES ($1, $2, $3, NOW())",
        payment_data['user_id'], payment_data['amount'], payment_data['stage_id']
    )
    await conn.close()
```

### –ö–∞–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏?

```python
class PaymentMonitor:
    def __init__(self):
        self.payment_stats = defaultdict(int)
    
    async def log_payment(self, result):
        self.payment_stats['total_payments'] += 1
        self.payment_stats['total_amount'] += result.amount
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        await self.store_payment_log(result)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º –æ–±—ä–µ–º–µ
        if self.payment_stats['total_payments'] % 100 == 0:
            await self.send_volume_alert()
    
    async def get_stats(self):
        return dict(self.payment_stats)
```

### –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—ã—Å–æ–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫?

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
import asyncpg

class DatabasePool:
    def __init__(self, database_url: str):
        self.pool = None
        self.database_url = database_url
    
    async def initialize(self):
        self.pool = await asyncpg.create_pool(
            self.database_url,
            min_size=10,
            max_size=20
        )
    
    async def execute(self, query, *args):
        async with self.pool.acquire() as conn:
            return await conn.execute(query, *args)
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü–ª–∞—Ç–µ–∂ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞
3. –≠—Ç–∞–ø –ø–ª–∞—Ç–µ–∂–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
4. ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

```python
# –û—Ç–ª–∞–¥–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
async def debug_send_payment(user_id: int, stage_id: str):
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —ç—Ç–∞–ø
    stage = neonpay.get_payment_stage(stage_id)
    if not stage:
        print(f"–≠—Ç–∞–ø {stage_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    try:
        user = await bot.get_chat(user_id)
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: {user.first_name}")
    except Exception as e:
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω: {e}")
        return
    
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂
    try:
        await neonpay.send_payment(user_id, stage_id)
        print("–ü–ª–∞—Ç–µ–∂ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ")
    except Exception as e:
        print(f"–ü–ª–∞—Ç–µ–∂ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
```

### Callback –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@neonpay.on_payment` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω
2. –§—É–Ω–∫—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è
3. –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```python
# –¢–µ—Å—Ç callback –ø–ª–∞—Ç–µ–∂–∞
@neonpay.on_payment
async def test_payment_handler(result):
    print(f"Callback –ø–ª–∞—Ç–µ–∂–∞ —Å—Ä–∞–±–æ—Ç–∞–ª: {result}")
    # –î–æ–±–∞–≤—å—Ç–µ —Ç–æ—á–∫—É –æ—Å—Ç–∞–Ω–æ–≤–∞ –∑–¥–µ—Å—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω
3. –ö–æ–º–∞–Ω–¥—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
4. –°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```python
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–æ—Ç–∞
async def test_bot():
    try:
        me = await bot.get_me()
        print(f"–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç: {me.first_name}")
    except Exception as e:
        print(f"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É –Ω–µ —É–¥–∞–ª–æ—Å—å: {e}")
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```python
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
async def test_database():
    try:
        conn = await asyncpg.connect(DATABASE_URL)
        result = await conn.fetchval("SELECT 1")
        print(f"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞: {result}")
        await conn.close()
    except Exception as e:
        print(f"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É–¥–∞–ª–æ—Å—å: {e}")
```

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "–≠—Ç–∞–ø –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω"

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞:

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —ç—Ç–∞–ø—ã
stages = neonpay.list_payment_stages()
print(f"–î–æ—Å—Ç—É–ø–Ω—ã–µ —ç—Ç–∞–ø—ã: {list(stages.keys())}")

# –°–æ–∑–¥–∞—Ç—å —ç—Ç–∞–ø, –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
if "premium" not in stages:
    stage = PaymentStage("–ü—Ä–µ–º–∏—É–º", "–ü—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø", 25)
    neonpay.create_payment_stage("premium", stage)
```

### "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–≤–æ–π—Å"

–≠—Ç–æ –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
1. –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞
3. ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

```python
# –û—Ç–ª–∞–¥–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–Ω–≤–æ–π—Å–∞
async def debug_invoice(user_id: int, stage_id: str):
    try:
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
        me = await bot.get_me()
        print(f"–ë–æ—Ç: {me.first_name} (@{me.username})")
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user = await bot.get_chat(user_id)
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user.first_name} (@{user.username})")
        
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂
        await neonpay.send_payment(user_id, stage_id)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
```

### "Callback –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. –§—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞ `@neonpay.on_payment`
2. –§—É–Ω–∫—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è
3. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```python
# –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ callback
stats = neonpay.get_stats()
print(f"Callbacks –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã: {stats['registered_callbacks']}")
```

## –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

### –ì–¥–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å?

1. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É [examples](../../examples/)
2. **–°–æ–æ–±—â–µ—Å—Ç–≤–æ**: –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É [Telegram —Å–æ–æ–±—â–µ—Å—Ç–≤—É](https://t.me/neonpay_community)
3. **–ü—Ä–æ–±–ª–µ–º—ã**: –û—Ç–∫—Ä–æ–π—Ç–µ issue –Ω–∞ [GitHub](https://github.com/Abbasxan/neonpay/issues)
4. **Email**: –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ [support@neonpay.com](mailto:support@neonpay.com)

### –ö–∞–∫ —Å–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–∞—Ö?

–ü—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ–± –æ—à–∏–±–∫–∞—Ö, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–∫–ª—é—á–∏—Ç–µ:
1. –í–µ—Ä—Å–∏—é Python
2. –í–µ—Ä—Å–∏—é NEONPAY
3. –ë–∏–±–ª–∏–æ—Ç–µ–∫—É –±–æ—Ç–∞ –∏ –≤–µ—Ä—Å–∏—é
4. –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∏ —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
5. –®–∞–≥–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

### –ö–∞–∫ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏?

–ó–∞–ø—Ä–æ—Å—ã —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —É–∂–µ
2. –û–ø–∏—à–∏—Ç–µ —Å–ª—É—á–∞–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
3. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
4. –û—Ç–∫—Ä–æ–π—Ç–µ issue –Ω–∞ GitHub

---

**–í—Å–µ –µ—â–µ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É [examples](../../examples/) –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π!**
